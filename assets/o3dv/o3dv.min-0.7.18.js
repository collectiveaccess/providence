var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var g=0;g<e.length-1;g++){var f=e[g];if(!(f in d))return;d=d[f]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):
$jscomp.POLYFILL_PREFIX+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};
$jscomp.getConstructImplementation=function(){function a(){function c(){}new c;Reflect.construct(c,[],function(){});return new c instanceof c}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(a())return Reflect.construct;var b=Reflect.construct;return function(c,d,e){c=b(c,d);e&&Reflect.setPrototypeOf(c,e.prototype);return c}}return function(c,d,e){void 0===e&&(e=c);e=$jscomp.objectCreate(e.prototype||Object.prototype);return Function.prototype.apply.call(c,e,d)||
e}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var c=$jscomp.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};$jscomp.polyfill("Reflect",function(a){return a?a:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(a){return $jscomp.construct},"es6","es3");
$jscomp.polyfill("Reflect.setPrototypeOf",function(a){if(a)return a;if($jscomp.setPrototypeOf){var b=$jscomp.setPrototypeOf;return function(c,d){try{return b(c,d),!0}catch(e){return!1}}}return null},"es6","es5");$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var e=d.length,g=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var f=0;f<g&&c<e;)if(d[c++]!=b[f++])return!1;return f>=g}},"es6","es3");
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(f){return f instanceof e?f:new e(function(h,k){h(f)})}if(a&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return a;b.prototype.asyncExecute=function(f){if(null==this.batch_){this.batch_=[];var h=this;this.asyncExecuteFunction(function(){h.executeBatch_()})}this.batch_.push(f)};
var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(f){d(f,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var f=this.batch_;this.batch_=[];for(var h=0;h<f.length;++h){var k=f[h];f[h]=null;try{k()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};b.prototype.asyncThrow_=function(f){this.asyncExecuteFunction(function(){throw f;})};var e=function(f){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=!1;var h=this.createResolveAndReject_();
try{f(h.resolve,h.reject)}catch(k){h.reject(k)}};e.prototype.createResolveAndReject_=function(){function f(l){return function(m){k||(k=!0,l.call(h,m))}}var h=this,k=!1;return{resolve:f(this.resolveTo_),reject:f(this.reject_)}};e.prototype.resolveTo_=function(f){if(f===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(f instanceof e)this.settleSameAsPromise_(f);else{a:switch(typeof f){case "object":var h=null!=f;break a;case "function":h=!0;break a;default:h=!1}h?this.resolveToNonPromiseObj_(f):
this.fulfill_(f)}};e.prototype.resolveToNonPromiseObj_=function(f){var h=void 0;try{h=f.then}catch(k){this.reject_(k);return}"function"==typeof h?this.settleSameAsThenable_(h,f):this.fulfill_(f)};e.prototype.reject_=function(f){this.settle_(2,f)};e.prototype.fulfill_=function(f){this.settle_(1,f)};e.prototype.settle_=function(f,h){if(0!=this.state_)throw Error("Cannot settle("+f+", "+h+"): Promise already settled in state"+this.state_);this.state_=f;this.result_=h;2===this.state_&&this.scheduleUnhandledRejectionCheck_();
this.executeOnSettledCallbacks_()};e.prototype.scheduleUnhandledRejectionCheck_=function(){var f=this;d(function(){if(f.notifyUnhandledRejection_()){var h=$jscomp.global.console;"undefined"!==typeof h&&h.error(f.result_)}},1)};e.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var f=$jscomp.global.CustomEvent,h=$jscomp.global.Event,k=$jscomp.global.dispatchEvent;if("undefined"===typeof k)return!0;"function"===typeof f?f=new f("unhandledrejection",{cancelable:!0}):
"function"===typeof h?f=new h("unhandledrejection",{cancelable:!0}):(f=$jscomp.global.document.createEvent("CustomEvent"),f.initCustomEvent("unhandledrejection",!1,!0,f));f.promise=this;f.reason=this.result_;return k(f)};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var f=0;f<this.onSettledCallbacks_.length;++f)g.asyncExecute(this.onSettledCallbacks_[f]);this.onSettledCallbacks_=null}};var g=new b;e.prototype.settleSameAsPromise_=function(f){var h=this.createResolveAndReject_();
f.callWhenSettled_(h.resolve,h.reject)};e.prototype.settleSameAsThenable_=function(f,h){var k=this.createResolveAndReject_();try{f.call(h,k.resolve,k.reject)}catch(l){k.reject(l)}};e.prototype.then=function(f,h){function k(q,p){return"function"==typeof q?function(t){try{l(q(t))}catch(r){m(r)}}:p}var l,m,n=new e(function(q,p){l=q;m=p});this.callWhenSettled_(k(f,l),k(h,m));return n};e.prototype.catch=function(f){return this.then(void 0,f)};e.prototype.callWhenSettled_=function(f,h){function k(){switch(l.state_){case 1:f(l.result_);
break;case 2:h(l.result_);break;default:throw Error("Unexpected state: "+l.state_);}}var l=this;null==this.onSettledCallbacks_?g.asyncExecute(k):this.onSettledCallbacks_.push(k);this.isRejectionHandled_=!0};e.resolve=c;e.reject=function(f){return new e(function(h,k){k(f)})};e.race=function(f){return new e(function(h,k){for(var l=$jscomp.makeIterator(f),m=l.next();!m.done;m=l.next())c(m.value).callWhenSettled_(h,k)})};e.all=function(f){var h=$jscomp.makeIterator(f),k=h.next();return k.done?c([]):new e(function(l,
m){function n(t){return function(r){q[t]=r;p--;0==p&&l(q)}}var q=[],p=0;do q.push(void 0),p++,c(k.value).callWhenSettled_(n(q.length-1),m),k=h.next();while(!k.done)})};return e},"es6","es3");$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===c&&(c=d.length);c=Math.max(0,Math.min(c|0,d.length));for(var e=b.length;0<e&&0<c;)if(d[--c]!=b[--e])return!1;return 0>=e}},"es6","es3");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(e,g){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:g})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c=0,d=function(e){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(e||"")+"_"+c++,e)};return d},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var g=c++;return{value:b(g,a[g]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b,c){return c})}},"es8","es3");$jscomp.polyfill("Promise.prototype.finally",function(a){return a?a:function(b){return this.then(function(c){return Promise.resolve(b()).then(function(){return c})},function(c){return Promise.resolve(b()).then(function(){throw c;})})}},"es9","es3");
$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var g=a[e];if(b.call(c,g,e,a))return{i:e,v:g}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).i}},"es6","es3");
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(b){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var d="";b;)if(b&1&&(d+=c),b>>>=1)c+=c;return d}},"es6","es3");OV={ValueOrDefault:function(a,b){return void 0===a||null===a?b:a}};OV.TaskRunner=function(){this.callbacks=this.current=this.count=null};OV.TaskRunner.prototype.Run=function(a,b){this.count=a;this.current=0;this.callbacks=b;0===a?this.TaskReady():this.RunOnce()};OV.TaskRunner.prototype.RunBatch=function(a,b,c){var d=0;0<a&&(d=parseInt((a-1)/b,10)+1);this.Run(d,{runTask:function(e,g){c.runTask(e*b,Math.min((e+1)*b,a)-1,g)},onReady:c.onReady})};
OV.TaskRunner.prototype.RunOnce=function(){var a=this;setTimeout(function(){a.callbacks.runTask(a.current,a.TaskReady.bind(a))},0)};OV.TaskRunner.prototype.TaskReady=function(){this.current+=1;if(this.current<this.count)this.RunOnce();else if(this.callbacks.onReady)this.callbacks.onReady()};OV.RunTaskAsync=function(a){setTimeout(function(){a()},0)};OV.Eps=1E-8;OV.RadDeg=57.29577951308232;OV.DegRad=.017453292519943;OV.IsZero=function(a){return Math.abs(a)<OV.Eps};OV.IsLower=function(a,b){return b-a>OV.Eps};OV.IsGreater=function(a,b){return a-b>OV.Eps};OV.IsLowerOrEqual=function(a,b){return b-a>-OV.Eps};OV.IsGreaterOrEqual=function(a,b){return a-b>-OV.Eps};OV.IsEqual=function(a,b){return Math.abs(b-a)<OV.Eps};OV.IsEqualEps=function(a,b,c){return Math.abs(b-a)<c};OV.IsPositive=function(a){return a>OV.Eps};OV.IsNegative=function(a){return a<-OV.Eps};
OV.Direction={X:1,Y:2,Z:3};OV.Coord2D=function(a,b){this.x=a;this.y=b};OV.Coord2D.prototype.Clone=function(){return new OV.Coord2D(this.x,this.y)};OV.CoordIsEqual2D=function(a,b){return OV.IsEqual(a.x,b.x)&&OV.IsEqual(a.y,b.y)};OV.AddCoord2D=function(a,b){return new OV.Coord2D(a.x+b.x,a.y+b.y)};OV.SubCoord2D=function(a,b){return new OV.Coord2D(a.x-b.x,a.y-b.y)};OV.CoordDistance2D=function(a,b){return Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))};OV.Coord3D=function(a,b,c){this.x=a;this.y=b;this.z=c};OV.Coord3D.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};OV.Coord3D.prototype.MultiplyScalar=function(a){this.x*=a;this.y*=a;this.z*=a;return this};OV.Coord3D.prototype.Normalize=function(){var a=this.Length();0<a&&this.MultiplyScalar(1/a);return this};OV.Coord3D.prototype.Offset=function(a,b){a=a.Clone().Normalize();this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this};
OV.Coord3D.prototype.Rotate=function(a,b,c){var d=a.Clone().Normalize();a=d.x;var e=d.y;d=d.z;var g=this.x-c.x,f=this.y-c.y,h=this.z-c.z,k=Math.sin(b);b=Math.cos(b);this.x=-a*(-a*g-e*f-d*h)*(1-b)+g*b+(-d*f+e*h)*k;this.y=-e*(-a*g-e*f-d*h)*(1-b)+f*b+(d*g-a*h)*k;this.z=-d*(-a*g-e*f-d*h)*(1-b)+h*b+(-e*g+a*f)*k;this.x+=c.x;this.y+=c.y;this.z+=c.z;return this};OV.Coord3D.prototype.Clone=function(){return new OV.Coord3D(this.x,this.y,this.z)};
OV.CoordIsEqual3D=function(a,b){return OV.IsEqual(a.x,b.x)&&OV.IsEqual(a.y,b.y)&&OV.IsEqual(a.z,b.z)};OV.AddCoord3D=function(a,b){return new OV.Coord3D(a.x+b.x,a.y+b.y,a.z+b.z)};OV.SubCoord3D=function(a,b){return new OV.Coord3D(a.x-b.x,a.y-b.y,a.z-b.z)};OV.CoordDistance3D=function(a,b){return Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y)+(a.z-b.z)*(a.z-b.z))};
OV.VectorAngle3D=function(a,b){a=a.Clone().Normalize();b=b.Clone().Normalize();if(OV.CoordIsEqual3D(a,b))return 0;b=OV.DotVector3D(a,b);return Math.acos(b)};OV.DotVector3D=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};OV.CrossVector3D=function(a,b){var c=new OV.Coord3D(0,0,0);c.x=a.y*b.z-a.z*b.y;c.y=a.z*b.x-a.x*b.z;c.z=a.x*b.y-a.y*b.x;return c};OV.VectorLength3D=function(a,b,c){return Math.sqrt(a*a+b*b+c*c)};OV.ArrayToCoord3D=function(a){return new OV.Coord3D(a[0],a[1],a[2])};OV.Quaternion=function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d};OV.ArrayToQuaternion=function(a){return new OV.Quaternion(a[0],a[1],a[2],a[3])};OV.Box3D=function(a,b){this.min=a;this.max=b};OV.Box3D.prototype.GetMin=function(){return this.min};OV.Box3D.prototype.GetMax=function(){return this.max};OV.Box3D.prototype.GetCenter=function(){return new OV.Coord3D((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,(this.min.z+this.max.z)/2)};OV.BoundingBoxCalculator3D=function(){this.box=new OV.Box3D(new OV.Coord3D(Infinity,Infinity,Infinity),new OV.Coord3D(-Infinity,-Infinity,-Infinity))};OV.BoundingBoxCalculator3D.prototype.GetBox=function(){return this.box};
OV.BoundingBoxCalculator3D.prototype.AddPoint=function(a){this.box.min.x=Math.min(this.box.min.x,a.x);this.box.min.y=Math.min(this.box.min.y,a.y);this.box.min.z=Math.min(this.box.min.z,a.z);this.box.max.x=Math.max(this.box.max.x,a.x);this.box.max.y=Math.max(this.box.max.y,a.y);this.box.max.z=Math.max(this.box.max.z,a.z)};OV.OctreeNode=function(a,b){this.boundingBox=a;this.level=b;this.pointItems=[];this.childNodes=[]};OV.OctreeNode.prototype.AddPoint=function(a,b,c){var d=this.FindNodeForPoint(a);if(null===d||null!==d.FindPointDirectly(a))return!1;if(d.pointItems.length<c.maxPointsPerNode||d.level>=c.maxTreeDepth)return d.AddPointDirectly(a,b),!0;d.CreateChildNodes();var e=d.pointItems;d.pointItems=[];for(var g=0;g<e.length;g++){var f=e[g];if(!d.AddPoint(f.point,f.data,c))return!1}return d.AddPoint(a,b,c)};
OV.OctreeNode.prototype.FindPoint=function(a){var b=this.FindNodeForPoint(a);return null===b?null:b.FindPointDirectly(a)};OV.OctreeNode.prototype.AddPointDirectly=function(a,b){this.pointItems.push({point:a,data:b})};OV.OctreeNode.prototype.FindPointDirectly=function(a){for(var b=0;b<this.pointItems.length;b++){var c=this.pointItems[b];if(OV.CoordIsEqual3D(a,c.point))return c.data}return null};
OV.OctreeNode.prototype.FindNodeForPoint=function(a){if(!this.IsPointInBounds(a))return null;if(0===this.childNodes.length)return this;for(var b=0;b<this.childNodes.length;b++){var c=this.childNodes[b].FindNodeForPoint(a);if(null!==c)return c}return null};
OV.OctreeNode.prototype.CreateChildNodes=function(){function a(f,h,k,l,m,n,q){h=new OV.Box3D(new OV.Coord3D(h,k,l),new OV.Coord3D(h+m,k+n,l+q));f.childNodes.push(new OV.OctreeNode(h,f.level+1,f.options))}var b=this.boundingBox.min,c=this.boundingBox.GetCenter(),d=(this.boundingBox.max.x-this.boundingBox.min.x)/2,e=(this.boundingBox.max.y-this.boundingBox.min.y)/2,g=(this.boundingBox.max.z-this.boundingBox.min.z)/2;a(this,b.x,b.y,b.z,d,e,g);a(this,c.x,b.y,b.z,d,e,g);a(this,b.x,c.y,b.z,d,e,g);a(this,
c.x,c.y,b.z,d,e,g);a(this,b.x,b.y,c.z,d,e,g);a(this,c.x,b.y,c.z,d,e,g);a(this,b.x,c.y,c.z,d,e,g);a(this,c.x,c.y,c.z,d,e,g)};OV.OctreeNode.prototype.IsPointInBounds=function(a){return OV.IsGreaterOrEqual(a.x,this.boundingBox.min.x)&&OV.IsGreaterOrEqual(a.y,this.boundingBox.min.y)&&OV.IsGreaterOrEqual(a.z,this.boundingBox.min.z)&&OV.IsLowerOrEqual(a.x,this.boundingBox.max.x)&&OV.IsLowerOrEqual(a.y,this.boundingBox.max.y)&&OV.IsLowerOrEqual(a.z,this.boundingBox.max.z)};
OV.Octree=function(a,b){this.options={maxPointsPerNode:10,maxTreeDepth:10};void 0!==b&&(void 0!==b.maxPointsPerNode&&(this.options.maxPointsPerNode=b.maxPointsPerNode),void 0!==b.maxTreeDepth&&(this.options.maxTreeDepth=b.maxTreeDepth));this.rootNode=new OV.OctreeNode(a,0,this.options)};OV.Octree.prototype.AddPoint=function(a,b){return this.rootNode.AddPoint(a,b,this.options)};OV.Octree.prototype.FindPoint=function(a){return this.rootNode.FindPoint(a)};OV.Matrix=function(a){this.matrix=null;void 0!==a&&null!==a&&(this.matrix=a)};OV.Matrix.prototype.IsValid=function(){return null!==this.matrix};OV.Matrix.prototype.Set=function(a){this.matrix=a;return this};OV.Matrix.prototype.Get=function(){return this.matrix};
OV.Matrix.prototype.Clone=function(){return new OV.Matrix([this.matrix[0],this.matrix[1],this.matrix[2],this.matrix[3],this.matrix[4],this.matrix[5],this.matrix[6],this.matrix[7],this.matrix[8],this.matrix[9],this.matrix[10],this.matrix[11],this.matrix[12],this.matrix[13],this.matrix[14],this.matrix[15]])};OV.Matrix.prototype.CreateIdentity=function(){this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return this};
OV.Matrix.prototype.IsIdentity=function(){for(var a=(new OV.Matrix).CreateIdentity().Get(),b=0;16>b;b++)if(!OV.IsEqual(this.matrix[b],a[b]))return!1;return!0};OV.Matrix.prototype.CreateTranslation=function(a,b,c){this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,a,b,c,1];return this};OV.Matrix.prototype.CreateRotation=function(a,b,c,d){var e=a+a,g=b+b,f=c+c,h=a*e,k=a*g;a*=f;var l=b*g;b*=f;c*=f;e*=d;g*=d;d*=f;this.matrix=[1-(l+c),k+d,a-g,0,k-d,1-(h+c),b+e,0,a+g,b-e,1-(h+l),0,0,0,0,1];return this};
OV.Matrix.prototype.CreateScale=function(a,b,c){this.matrix=[a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1];return this};OV.Matrix.prototype.ComposeTRS=function(a,b,c){var d=b.x,e=b.y,g=b.z,f=b.w;b=c.x;var h=c.y;c=c.z;var k=d+d,l=e+e,m=g+g,n=d*k,q=d*l;d*=m;var p=e*l;e*=m;g*=m;k*=f;l*=f;f*=m;this.matrix=[(1-(p+g))*b,(q+f)*b,(d-l)*b,0,(q-f)*h,(1-(n+g))*h,(e+k)*h,0,(d+l)*c,(e-k)*c,(1-(n+p))*c,0,a.x,a.y,a.z,1];return this};
OV.Matrix.prototype.DecomposeTRS=function(){var a=new OV.Coord3D(this.matrix[12],this.matrix[13],this.matrix[14]),b=OV.VectorLength3D(this.matrix[0],this.matrix[1],this.matrix[2]),c=OV.VectorLength3D(this.matrix[4],this.matrix[5],this.matrix[6]),d=OV.VectorLength3D(this.matrix[8],this.matrix[9],this.matrix[10]),e=this.Determinant();OV.IsNegative(e)&&(b*=-1);e=new OV.Coord3D(b,c,d);var g=this.matrix[0]/b,f=this.matrix[4]/c,h=this.matrix[8]/d,k=this.matrix[1]/b,l=this.matrix[5]/c,m=this.matrix[9]/d;
b=this.matrix[2]/b;c=this.matrix[6]/c;d=this.matrix[10]/d;var n=g+l+d;0<n?(g=2*Math.sqrt(n+1),f=new OV.Quaternion((c-m)/g,(h-b)/g,(k-f)/g,.25*g)):g>l&&g>d?(g=2*Math.sqrt(1+g-l-d),f=new OV.Quaternion(.25*g,(f+k)/g,(h+b)/g,(c-m)/g)):l>d?(g=2*Math.sqrt(1+l-g-d),f=new OV.Quaternion((f+k)/g,.25*g,(m+c)/g,(h-b)/g)):(g=2*Math.sqrt(1+d-g-l),f=new OV.Quaternion((h+b)/g,(m+c)/g,.25*g,(k-f)/g));return{translation:a,rotation:f,scale:e}};
OV.Matrix.prototype.Determinant=function(){var a=this.matrix[0],b=this.matrix[1],c=this.matrix[2],d=this.matrix[3],e=this.matrix[4],g=this.matrix[5],f=this.matrix[6],h=this.matrix[7],k=this.matrix[8],l=this.matrix[9],m=this.matrix[10],n=this.matrix[11],q=this.matrix[12],p=this.matrix[13],t=this.matrix[14],r=this.matrix[15];return(a*g-b*e)*(m*r-n*t)-(a*f-c*e)*(l*r-n*p)+(a*h-d*e)*(l*t-m*p)+(b*f-c*g)*(k*r-n*q)-(b*h-d*g)*(k*t-m*q)+(c*h-d*f)*(k*p-l*q)};
OV.Matrix.prototype.Invert=function(){var a=this.matrix[0],b=this.matrix[1],c=this.matrix[2],d=this.matrix[3],e=this.matrix[4],g=this.matrix[5],f=this.matrix[6],h=this.matrix[7],k=this.matrix[8],l=this.matrix[9],m=this.matrix[10],n=this.matrix[11],q=this.matrix[12],p=this.matrix[13],t=this.matrix[14],r=this.matrix[15],u=a*g-b*e,v=a*f-c*e,w=a*h-d*e,y=b*f-c*g,x=b*h-d*g,z=c*h-d*f,A=k*p-l*q,E=k*t-m*q,F=k*r-n*q,B=l*t-m*p,C=l*r-n*p,G=m*r-n*t,D=u*G-v*C+w*B+y*F-x*E+z*A;return OV.IsEqual(D,0)?null:new OV.Matrix([(g*
G-f*C+h*B)/D,(c*C-b*G-d*B)/D,(p*z-t*x+r*y)/D,(m*x-l*z-n*y)/D,(f*F-e*G-h*E)/D,(a*G-c*F+d*E)/D,(t*w-q*z-r*v)/D,(k*z-m*w+n*v)/D,(e*C-g*F+h*A)/D,(b*F-a*C-d*A)/D,(q*x-p*w+r*u)/D,(l*w-k*x-n*u)/D,(g*E-e*B-f*A)/D,(a*B-b*E+c*A)/D,(p*v-q*y-t*u)/D,(k*y-l*v+m*u)/D])};
OV.Matrix.prototype.MultiplyVector=function(a){var b=a[0],c=a[1],d=a[2];a=a[3];return[b*this.matrix[0]+c*this.matrix[4]+d*this.matrix[8]+a*this.matrix[12],b*this.matrix[1]+c*this.matrix[5]+d*this.matrix[9]+a*this.matrix[13],b*this.matrix[2]+c*this.matrix[6]+d*this.matrix[10]+a*this.matrix[14],b*this.matrix[3]+c*this.matrix[7]+d*this.matrix[11]+a*this.matrix[15]]};
OV.Matrix.prototype.MultiplyMatrix=function(a){var b=this.matrix[0],c=this.matrix[1],d=this.matrix[2],e=this.matrix[3],g=this.matrix[4],f=this.matrix[5],h=this.matrix[6],k=this.matrix[7],l=this.matrix[8],m=this.matrix[9],n=this.matrix[10],q=this.matrix[11],p=this.matrix[12],t=this.matrix[13],r=this.matrix[14],u=this.matrix[15],v=a.matrix[0],w=a.matrix[1],y=a.matrix[2],x=a.matrix[3],z=a.matrix[4],A=a.matrix[5],E=a.matrix[6],F=a.matrix[7],B=a.matrix[8],C=a.matrix[9],G=a.matrix[10],D=a.matrix[11],H=
a.matrix[12],I=a.matrix[13],J=a.matrix[14];a=a.matrix[15];return new OV.Matrix([b*v+c*z+d*B+e*H,b*w+c*A+d*C+e*I,b*y+c*E+d*G+e*J,b*x+c*F+d*D+e*a,g*v+f*z+h*B+k*H,g*w+f*A+h*C+k*I,g*y+f*E+h*G+k*J,g*x+f*F+h*D+k*a,l*v+m*z+n*B+q*H,l*w+m*A+n*C+q*I,l*y+m*E+n*G+q*J,l*x+m*F+n*D+q*a,p*v+t*z+r*B+u*H,p*w+t*A+r*C+u*I,p*y+t*E+r*G+u*J,p*x+t*F+r*D+u*a])};OV.Transformation=function(a){void 0!==a&&null!==a?this.matrix=a:(this.matrix=new OV.Matrix,this.matrix.CreateIdentity())};OV.Transformation.prototype.SetMatrix=function(a){this.matrix=a;return this};OV.Transformation.prototype.GetMatrix=function(){return this.matrix};OV.Transformation.prototype.IsIdentity=function(){return this.matrix.IsIdentity()};OV.Transformation.prototype.AppendMatrix=function(a){this.matrix=this.matrix.MultiplyMatrix(a);return this};
OV.Transformation.prototype.TransformCoord3D=function(a){a=this.matrix.MultiplyVector([a.x,a.y,a.z,1]);return new OV.Coord3D(a[0],a[1],a[2])};OV.BezierTweenFunction=function(a,b,c){b/=c;return a*b*b*(3-2*b)};OV.LinearTweenFunction=function(a,b,c){return b*a/c};OV.ParabolicTweenFunction=function(a,b,c){b/=c;c=b*b;return c/(2*(c-b)+1)*a};OV.TweenCoord3D=function(a,b,c,d){var e=OV.SubCoord3D(b,a).Normalize();b=OV.CoordDistance3D(a,b);for(var g=[],f=0;f<c;f++){var h=d(b,f,c-1);g.push(a.Clone().Offset(e,h))}return g};OV.BinaryReader=function(a,b){this.arrayBuffer=a;this.dataView=new DataView(a);this.isLittleEndian=b;this.position=0};OV.BinaryReader.prototype.GetPosition=function(){return this.position};OV.BinaryReader.prototype.SetPosition=function(a){this.position=a};OV.BinaryReader.prototype.GetByteLength=function(){return this.arrayBuffer.byteLength};OV.BinaryReader.prototype.Skip=function(a){this.position+=a};OV.BinaryReader.prototype.End=function(){return this.position>=this.arrayBuffer.byteLength};
OV.BinaryReader.prototype.ReadArrayBuffer=function(a){var b=new Uint8Array(this.arrayBuffer),c=new ArrayBuffer(a),d=new Uint8Array(c);b=b.subarray(this.position,this.position+a);d.set(b,0);this.position+=a;return c};OV.BinaryReader.prototype.ReadBoolean8=function(){var a=this.dataView.getInt8(this.position);this.position+=1;return a?!0:!1};OV.BinaryReader.prototype.ReadCharacter8=function(){var a=this.dataView.getInt8(this.position);this.position+=1;return a};
OV.BinaryReader.prototype.ReadUnsignedCharacter8=function(){var a=this.dataView.getUint8(this.position);this.position+=1;return a};OV.BinaryReader.prototype.ReadInteger16=function(){var a=this.dataView.getInt16(this.position,this.isLittleEndian);this.position+=2;return a};OV.BinaryReader.prototype.ReadUnsignedInteger16=function(){var a=this.dataView.getUint16(this.position,this.isLittleEndian);this.position+=2;return a};
OV.BinaryReader.prototype.ReadInteger32=function(){var a=this.dataView.getInt32(this.position,this.isLittleEndian);this.position+=4;return a};OV.BinaryReader.prototype.ReadUnsignedInteger32=function(){var a=this.dataView.getUint32(this.position,this.isLittleEndian);this.position+=4;return a};OV.BinaryReader.prototype.ReadFloat32=function(){var a=this.dataView.getFloat32(this.position,this.isLittleEndian);this.position+=4;return a};
OV.BinaryReader.prototype.ReadDouble64=function(){var a=this.dataView.getFloat64(this.position,this.isLittleEndian);this.position+=8;return a};OV.BinaryWriter=function(a,b){this.arrayBuffer=new ArrayBuffer(a);this.dataView=new DataView(this.arrayBuffer);this.isLittleEndian=b;this.position=0};OV.BinaryWriter.prototype.GetPosition=function(){return this.position};OV.BinaryWriter.prototype.SetPosition=function(a){this.position=a};OV.BinaryWriter.prototype.End=function(){return this.position>=this.arrayBuffer.byteLength};OV.BinaryWriter.prototype.GetBuffer=function(){return this.arrayBuffer};
OV.BinaryWriter.prototype.WriteArrayBuffer=function(a){var b=new Uint8Array(a);(new Uint8Array(this.arrayBuffer)).set(b,this.position);this.position+=a.byteLength};OV.BinaryWriter.prototype.WriteBoolean8=function(a){this.dataView.setInt8(this.position,a?1:0);this.position+=1};OV.BinaryWriter.prototype.WriteCharacter8=function(a){this.dataView.setInt8(this.position,a);this.position+=1};
OV.BinaryWriter.prototype.WriteUnsignedCharacter8=function(a){this.dataView.setUint8(this.position,a);this.position+=1};OV.BinaryWriter.prototype.WriteInteger16=function(a){this.dataView.setInt16(this.position,a,this.isLittleEndian);this.position+=2};OV.BinaryWriter.prototype.WriteUnsignedInteger16=function(a){this.dataView.setUint16(this.position,a,this.isLittleEndian);this.position+=2};
OV.BinaryWriter.prototype.WriteInteger32=function(a){this.dataView.setInt32(this.position,a,this.isLittleEndian);this.position+=4};OV.BinaryWriter.prototype.WriteUnsignedInteger32=function(a){this.dataView.setUint32(this.position,a,this.isLittleEndian);this.position+=4};OV.BinaryWriter.prototype.WriteFloat32=function(a){this.dataView.setFloat32(this.position,a,this.isLittleEndian);this.position+=4};
OV.BinaryWriter.prototype.WriteDouble64=function(a){this.dataView.setFloat64(this.position,a,this.isLittleEndian);this.position+=8};OV.TextWriter=function(){this.text="";this.indentation=0};OV.TextWriter.prototype.GetText=function(){return this.text};OV.TextWriter.prototype.Indent=function(a){this.indentation+=a};OV.TextWriter.prototype.WriteArrayLine=function(a){this.WriteLine(a.join(" "))};OV.TextWriter.prototype.WriteLine=function(a){this.WriteIndentation();this.Write(a+"\n")};OV.TextWriter.prototype.WriteIndentation=function(){for(var a=0;a<this.indentation;a++)this.Write("  ")};
OV.TextWriter.prototype.Write=function(a){this.text+=a};OV.ArrayBufferToUtf8String=function(a){return(new TextDecoder("utf-8")).decode(a)};OV.ArrayBufferToAsciiString=function(a){var b="";a=new Uint8Array(a);for(var c=0;c<a.byteLength;c++)b+=String.fromCharCode(a[c]);return b};OV.AsciiStringToArrayBuffer=function(a){for(var b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0;d<a.length;d++)c[d]=a.charCodeAt(d);return b};OV.Utf8StringToArrayBuffer=function(a){return(new TextEncoder).encode(a)};
OV.Base64DataURIToArrayBuffer=function(a){if(!a.startsWith("data:"))return null;var b=a.indexOf(";");if(-1===b)return null;var c=a.indexOf(",");if(-1===c)return null;b=a.substr(5,b-5);a=atob(a.substr(c+1));c=new ArrayBuffer(a.length);for(var d=new Uint8Array(c),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);return{mimeType:b,buffer:c}};OV.CreateObjectUrl=function(a){a=new Blob([a]);return URL.createObjectURL(a)};OV.CreateObjectUrlWithMimeType=function(a,b){a=new Blob([a],{type:b});return URL.createObjectURL(a)};
OV.RevokeObjectUrl=function(a){URL.revokeObjectURL(a)};OV.FileSource={Url:1,File:2};OV.FileFormat={Text:1,Binary:2};OV.GetFileName=function(a){var b=a.lastIndexOf("/");-1===b&&(b=a.lastIndexOf("\\"));var c=a;-1!==b&&(c=a.substr(b+1));a=c.indexOf("?");-1!==a&&(c=c.substr(0,a));return decodeURI(c)};OV.GetFileExtension=function(a){a=OV.GetFileName(a);var b=a.lastIndexOf(".");return-1===b?"":a.substr(b+1)};
OV.RequestUrl=function(a,b){return new Promise(function(c,d){var e=new XMLHttpRequest;e.open("GET",a,!0);if(b===OV.FileFormat.Text)e.responseType="text";else if(b===OV.FileFormat.Binary)e.responseType="arraybuffer";else{d();return}e.onload=function(){200===e.status?c(e.response):d()};e.onerror=function(){d()};e.send(null)})};
OV.ReadFile=function(a,b){return new Promise(function(c,d){var e=new FileReader;e.onloadend=function(g){g.target.readyState===FileReader.DONE&&c(g.target.result)};e.onerror=function(){d()};b===OV.FileFormat.Text?e.readAsText(a):b===OV.FileFormat.Binary?e.readAsArrayBuffer(a):d()})};OV.ExternalLibLocation=null;OV.LoadedExternalLibs={};OV.LoadExternalLibrary=function(a){return new Promise(function(b,c){if(null===OV.ExternalLibLocation)c();else if(void 0!==OV.LoadedExternalLibs[a])b();else{var d=document.createElement("script");d.type="text/javascript";d.src=OV.ExternalLibLocation+"/"+a;d.onload=function(){OV.LoadedExternalLibs[a]=!0;b()};d.onerror=function(){c()};document.head.appendChild(d)}})};OV.Color=function(a,b,c){this.r=a;this.g=b;this.b=c};OV.Color.prototype.Set=function(a,b,c){this.r=a;this.g=b;this.b=c};OV.Color.prototype.Clone=function(){return new OV.Color(this.r,this.g,this.b)};OV.TextureMap=function(){this.buffer=this.url=this.name=null;this.offset=new OV.Coord2D(0,0);this.scale=new OV.Coord2D(1,1);this.rotation=0};OV.TextureMap.prototype.IsValid=function(){return null!==this.name&&null!==this.url&&null!==this.buffer};
OV.TextureMap.prototype.HasTransformation=function(){return OV.CoordIsEqual2D(this.offset,new OV.Coord2D(0,0))&&OV.CoordIsEqual2D(this.scale,new OV.Coord2D(1,1))&&OV.IsEqual(this.rotation,0)?!1:!0};OV.TextureMap.prototype.Clone=function(){var a=new OV.TextureMap;a.name=this.name;a.url=this.url;a.buffer=this.buffer;a.offset=this.offset.Clone();a.scale=this.scale.Clone();a.rotation=this.rotation;return a};OV.MaterialType={Phong:1,Physical:2};
OV.Material=function(a){this.type=a;this.name="";this.color=new OV.Color(0,0,0);this.ambient=new OV.Color(0,0,0);this.specular=new OV.Color(0,0,0);this.emissive=new OV.Color(0,0,0);this.metalness=0;this.roughness=1;this.shininess=0;this.opacity=1;this.metalnessMap=this.emissiveMap=this.normalMap=this.bumpMap=this.specularMap=this.diffuseMap=null;this.alphaTest=0;this.isDefault=this.multiplyMetallicMap=this.multiplyDiffuseMap=this.transparent=!1};
OV.Material.prototype.Clone=function(){var a=new OV.Material(this.type);a.name=this.name;a.color=this.color.Clone();a.ambient=this.ambient.Clone();a.specular=this.specular.Clone();a.emissive=this.emissive.Clone();a.metalness=this.metalness;a.roughness=this.roughness;a.shininess=this.shininess;a.opacity=this.opacity;a.diffuseMap=this.CloneTextureMap(this.diffuseMap);a.specularMap=this.CloneTextureMap(this.specularMap);a.bumpMap=this.CloneTextureMap(this.bumpMap);a.normalMap=this.CloneTextureMap(this.normalMap);
a.emissiveMap=this.CloneTextureMap(this.emissiveMap);a.metalnessMap=this.CloneTextureMap(this.metalnessMap);a.alphaTest=this.alphaTest;a.transparent=this.transparent;a.multiplyDiffuseMap=this.multiplyDiffuseMap;return a};OV.Material.prototype.CloneTextureMap=function(a){return null===a?null:a.Clone()};OV.SRGBToLinear=function(a){return.04045>a?.0773993808*a:Math.pow(.9478672986*a+.0521327014,2.4)};OV.LinearToSRGB=function(a){return.0031308>a?12.92*a:1.055*Math.pow(a,.41666)-.055};
OV.IntegerToHexString=function(a){for(a=parseInt(a,10).toString(16);2>a.length;)a="0"+a;return a};OV.ColorToHexString=function(a){var b=OV.IntegerToHexString(a.r),c=OV.IntegerToHexString(a.g);a=OV.IntegerToHexString(a.b);return b+c+a};OV.HexStringToColor=function(a){if(6!==a.length)return null;var b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16);a=parseInt(a.substr(4,2),16);return new OV.Color(b,c,a)};OV.ColorIsEqual=function(a,b){return a.r===b.r&&a.g===b.g&&a.b===b.b};
OV.ArrayToColor=function(a){return new OV.Color(a[0],a[1],a[2])};OV.EnumerateMaterialTextureMaps=function(a,b){null!==a.diffuseMap&&b(a.diffuseMap);null!==a.specularMap&&b(a.specularMap);null!==a.bumpMap&&b(a.bumpMap);null!==a.normalMap&&b(a.normalMap);null!==a.emissiveMap&&b(a.emissiveMap);null!==a.metalnessMap&&b(a.metalnessMap)};OV.Triangle=function(a,b,c){this.v0=a;this.v1=b;this.v2=c;this.curve=this.mat=this.u2=this.u1=this.u0=this.n2=this.n1=this.n0=null};OV.Triangle.prototype.HasVertices=function(){return null!==this.v0&&null!==this.v1&&null!==this.v2};OV.Triangle.prototype.HasNormals=function(){return null!==this.n0&&null!==this.n1&&null!==this.n2};OV.Triangle.prototype.HasTextureUVs=function(){return null!==this.u0&&null!==this.u1&&null!==this.u2};
OV.Triangle.prototype.SetVertices=function(a,b,c){this.v0=a;this.v1=b;this.v2=c;return this};OV.Triangle.prototype.SetNormals=function(a,b,c){this.n0=a;this.n1=b;this.n2=c;return this};OV.Triangle.prototype.SetTextureUVs=function(a,b,c){this.u0=a;this.u1=b;this.u2=c;return this};OV.Triangle.prototype.SetMaterial=function(a){this.mat=a;return this};OV.Triangle.prototype.SetCurve=function(a){this.curve=a;return this};
OV.Triangle.prototype.Clone=function(){var a=new OV.Triangle(this.v0,this.v1,this.v2);a.SetNormals(this.n0,this.n1,this.n2);a.SetTextureUVs(this.u0,this.u1,this.u2);a.SetMaterial(this.mat);a.SetCurve(this.curve);return a};OV.PropertyType={Text:1,Integer:2,Number:3,Boolean:4,Percent:5,Color:6};OV.Property=function(a,b,c){this.type=a;this.name=b;this.value=c};OV.PropertyGroup=function(a){this.name=a;this.properties=[]};OV.PropertyGroup.prototype.PropertyCount=function(){return this.properties.length};OV.PropertyGroup.prototype.AddProperty=function(a){this.properties.push(a)};OV.PropertyGroup.prototype.GetProperty=function(a){return this.properties[a]};OV.Element=function(){this.name="";this.propertyGroups=[]};OV.Element.prototype.GetName=function(){return this.name};OV.Element.prototype.SetName=function(a){this.name=a};OV.Element.prototype.VertexCount=function(){return 0};OV.Element.prototype.NormalCount=function(){return 0};OV.Element.prototype.TextureUVCount=function(){return 0};OV.Element.prototype.TriangleCount=function(){return 0};OV.Element.prototype.PropertyGroupCount=function(){return this.propertyGroups.length};
OV.Element.prototype.AddPropertyGroup=function(a){this.propertyGroups.push(a);return this.propertyGroups.length-1};OV.Element.prototype.GetPropertyGroup=function(a){return this.propertyGroups[a]};OV.Element.prototype.EnumerateVertices=function(a){};OV.Element.prototype.EnumerateTriangles=function(a){};OV.Mesh=function(){OV.Element.call(this);this.vertices=[];this.normals=[];this.uvs=[];this.triangles=[]};$jscomp.inherits(OV.Mesh,OV.Element);OV.Mesh.prototype.VertexCount=function(){return this.vertices.length};OV.Mesh.prototype.NormalCount=function(){return this.normals.length};OV.Mesh.prototype.TextureUVCount=function(){return this.uvs.length};OV.Mesh.prototype.TriangleCount=function(){return this.triangles.length};
OV.Mesh.prototype.AddVertex=function(a){this.vertices.push(a);return this.vertices.length-1};OV.Mesh.prototype.SetVertex=function(a,b){this.vertices[a]=b};OV.Mesh.prototype.GetVertex=function(a){return this.vertices[a]};OV.Mesh.prototype.AddNormal=function(a){this.normals.push(a);return this.normals.length-1};OV.Mesh.prototype.SetNormal=function(a,b){this.normals[a]=b};OV.Mesh.prototype.GetNormal=function(a){return this.normals[a]};
OV.Mesh.prototype.AddTextureUV=function(a){this.uvs.push(a);return this.uvs.length-1};OV.Mesh.prototype.SetTextureUV=function(a,b){this.uvs[a]=b};OV.Mesh.prototype.GetTextureUV=function(a){return this.uvs[a]};OV.Mesh.prototype.AddTriangle=function(a){this.triangles.push(a);return this.triangles.length-1};OV.Mesh.prototype.GetTriangle=function(a){return this.triangles[a]};OV.Mesh.prototype.EnumerateVertices=function(a){for(var b=0;b<this.vertices.length;b++)a(this.vertices[b])};
OV.Mesh.prototype.EnumerateTriangles=function(a){for(var b=0;b<this.triangles.length;b++){var c=this.triangles[b];a(this.vertices[c.v0],this.vertices[c.v1],this.vertices[c.v2])}};OV.MeshPrimitiveBuffer=function(){this.indices=[];this.vertices=[];this.normals=[];this.uvs=[];this.material=null};OV.MeshPrimitiveBuffer.prototype.GetBounds=function(){for(var a=[Infinity,Infinity,Infinity],b=[-Infinity,-Infinity,-Infinity],c=0;c<this.vertices.length/3;c++)for(var d=0;3>d;d++)a[d]=Math.min(a[d],this.vertices[3*c+d]),b[d]=Math.max(b[d],this.vertices[3*c+d]);return{min:a,max:b}};
OV.MeshPrimitiveBuffer.prototype.GetByteLength=function(a,b){return this.indices.length*a+(this.vertices.length+this.normals.length+this.uvs.length)*b};OV.MeshBuffer=function(){this.primitives=[]};OV.MeshBuffer.prototype.PrimitiveCount=function(){return this.primitives.length};OV.MeshBuffer.prototype.GetPrimitive=function(a){return this.primitives[a]};OV.MeshBuffer.prototype.GetByteLength=function(a,b){for(var c=0,d=0;d<this.primitives.length;d++)c+=this.primitives[d].GetByteLength(a,b);return c};
OV.ConvertMeshToMeshBuffer=function(a){function b(k,l,m,n,q,p){function t(v,w,y,x,z){var A=0<v.TextureUVCount();w=v.GetVertex(w);y=v.GetNormal(y);var E=z.vertices.length/3;z.indices.push(E);z.vertices.push(w.x,w.y,w.z);z.normals.push(y.x,y.y,y.z);v=null!==x?v.GetTextureUV(x):A?new OV.Coord2D(0,0):null;null!==v&&z.uvs.push(v.x,v.y);return{index:E,normal:y,uv:v}}function r(v,w,y,x){for(var z=0;z<w.length;z++){var A=w[z],E=v.GetNormal(y);E=OV.CoordIsEqual3D(A.normal,E);if(null===A.uv&&null===x)var F=
!0;else F=null!==x?v.GetTextureUV(x):new OV.Coord2D(0,0),F=OV.CoordIsEqual2D(A.uv,F);if(E&&F)return A}return null}var u=p[l];void 0===u?(u=t(k,l,m,n,q),p[l]=[u]):(p=r(k,u,m,n),null!==p?q.indices.push(p.index):(l=t(k,l,m,n,q),u.push(l)))}var c=new OV.MeshBuffer,d=a.TriangleCount();if(0===d)return null;for(var e=[],g=0;g<d;g++)e.push(g);e.sort(function(k,l){k=a.GetTriangle(k);l=a.GetTriangle(l);return k.mat-l.mat});g=d=null;for(var f=0;f<e.length;f++){var h=a.GetTriangle(e[f]);if(null===d||d.material!==
h.mat)d=new OV.MeshPrimitiveBuffer,d.material=h.mat,g={},c.primitives.push(d);b(a,h.v0,h.n0,h.u0,d,g);b(a,h.v1,h.n1,h.u1,d,g);b(a,h.v2,h.n2,h.u2,d,g)}return c};OV.Model=function(){OV.Element.call(this);this.materials=[];this.meshes=[]};$jscomp.inherits(OV.Model,OV.Element);OV.Model.prototype.MaterialCount=function(){return this.materials.length};OV.Model.prototype.MeshCount=function(){return this.meshes.length};OV.Model.prototype.VertexCount=function(){for(var a=0,b=0;b<this.meshes.length;b++)a+=this.meshes[b].VertexCount();return a};OV.Model.prototype.NormalCount=function(){for(var a=0,b=0;b<this.meshes.length;b++)a+=this.meshes[b].NormalCount();return a};
OV.Model.prototype.TextureUVCount=function(){for(var a=0,b=0;b<this.meshes.length;b++)a+=this.meshes[b].TextureUVCount();return a};OV.Model.prototype.TriangleCount=function(){for(var a=0,b=0;b<this.meshes.length;b++)a+=this.meshes[b].TriangleCount();return a};OV.Model.prototype.AddMaterial=function(a){this.materials.push(a);return this.materials.length-1};OV.Model.prototype.GetMaterial=function(a){return this.materials[a]};
OV.Model.prototype.AddMesh=function(a){this.meshes.push(a);return this.meshes.length-1};OV.Model.prototype.AddMeshToIndex=function(a,b){this.meshes.splice(b,0,a);return b};OV.Model.prototype.RemoveMesh=function(a){this.meshes.splice(a,1)};OV.Model.prototype.GetMesh=function(a){return this.meshes[a]};OV.Model.prototype.EnumerateVertices=function(a){for(var b=0;b<this.meshes.length;b++)this.meshes[b].EnumerateVertices(a)};OV.Model.prototype.EnumerateTriangles=function(a){for(var b=0;b<this.meshes.length;b++)this.meshes[b].EnumerateTriangles(a)};OV.TopologyVertex=function(){this.edges=[];this.triangles=[]};OV.TopologyEdge=function(a,b){this.vertex1=a;this.vertex2=b;this.triangles=[]};OV.TopologyTriangleEdge=function(a,b){this.edge=a;this.reversed=b};OV.TopologyTriangle=function(){this.triEdge3=this.triEdge2=this.triEdge1=null};OV.Topology=function(){this.vertices=[];this.edges=[];this.triangleEdges=[];this.triangles=[];this.edgeStartToEndVertexMap={}};
OV.Topology.prototype.AddVertex=function(){this.vertices.push(new OV.TopologyVertex);return this.vertices.length-1};
OV.Topology.prototype.AddTriangle=function(a,b,c){var d=this.triangles.length,e=new OV.TopologyTriangle;e.triEdge1=this.AddTriangleEdge(a,b);e.triEdge2=this.AddTriangleEdge(b,c);e.triEdge3=this.AddTriangleEdge(c,a);this.vertices[a].triangles.push(d);this.vertices[b].triangles.push(d);this.vertices[c].triangles.push(d);this.vertices[a].edges.push(this.triangleEdges[e.triEdge1].edge);this.vertices[b].edges.push(this.triangleEdges[e.triEdge2].edge);this.vertices[c].edges.push(this.triangleEdges[e.triEdge3].edge);
this.edges[this.triangleEdges[e.triEdge1].edge].triangles.push(d);this.edges[this.triangleEdges[e.triEdge2].edge].triangles.push(d);this.edges[this.triangleEdges[e.triEdge3].edge].triangles.push(d);this.triangles.push(e)};OV.Topology.prototype.AddTriangleEdge=function(a,b){var c=a,d=b,e=!1;b<a&&(c=b,d=a,e=!0);a=this.AddEdge(c,d);this.triangleEdges.push(new OV.TopologyTriangleEdge(a,e));return this.triangleEdges.length-1};
OV.Topology.prototype.AddEdge=function(a,b){void 0===this.edgeStartToEndVertexMap[a]&&(this.edgeStartToEndVertexMap[a]=[]);for(var c=this.edgeStartToEndVertexMap[a],d=0;d<c.length;d++){var e=c[d];if(e.endVertex===b)return e.edgeIndex}d=this.edges.length;c.push({endVertex:b,edgeIndex:d});this.edges.push(new OV.TopologyEdge(a,b));return d};OV.CalculateTriangleNormal=function(a,b,c){b=OV.SubCoord3D(b,a);a=OV.SubCoord3D(c,a);a=OV.CrossVector3D(b,a);a.Normalize();return a};
OV.TransformMesh=function(a,b){if(!b.IsIdentity()){for(var c=0;c<a.VertexCount();c++){var d=a.GetVertex(c),e=b.TransformCoord3D(d);d.x=e.x;d.y=e.y;d.z=e.z}if(0<a.NormalCount())for(b=b.GetMatrix().DecomposeTRS(),b=(new OV.Matrix).ComposeTRS(new OV.Coord3D(0,0,0),b.rotation,new OV.Coord3D(1,1,1)),b=new OV.Transformation(b),c=0;c<a.NormalCount();c++)d=a.GetNormal(c),e=b.TransformCoord3D(d),d.x=e.x,d.y=e.y,d.z=e.z}};
OV.FlipMeshTrianglesOrientation=function(a){for(var b=0;b<a.TriangleCount();b++){var c=a.GetTriangle(b),d=c.v1;c.v1=c.v2;c.v2=d}};OV.IsModelEmpty=function(a){for(var b=0;b<a.MeshCount();b++)if(0<a.GetMesh(b).TriangleCount())return!1;return!0};
OV.CloneMesh=function(a){var b=new OV.Mesh;b.SetName(a.GetName());for(var c=0;c<a.VertexCount();c++){var d=a.GetVertex(c);b.AddVertex(d.Clone())}for(c=0;c<a.NormalCount();c++)d=a.GetNormal(c),b.AddNormal(d.Clone());for(c=0;c<a.TextureUVCount();c++)d=a.GetTextureUV(c),b.AddTextureUV(d.Clone());for(c=0;c<a.TriangleCount();c++)d=a.GetTriangle(c),b.AddTriangle(d.Clone());return b};
OV.CreateMergedModel=function(a){var b=new OV.Model;b.SetName(a.GetName());for(var c=0;c<a.MaterialCount();c++){var d=a.GetMaterial(c);b.AddMaterial(d.Clone())}c=new OV.Mesh;for(d=0;d<a.MeshCount();d++){for(var e=a.GetMesh(d),g=c,f=g.VertexCount(),h=g.NormalCount(),k=g.TextureUVCount(),l=0;l<e.VertexCount();l++){var m=e.GetVertex(l);g.AddVertex(m.Clone())}for(l=0;l<e.NormalCount();l++)m=e.GetNormal(l),g.AddNormal(m.Clone());for(l=0;l<e.TextureUVCount();l++)m=e.GetTextureUV(l),g.AddTextureUV(m.Clone());
for(l=0;l<e.TriangleCount();l++){m=e.GetTriangle(l);var n=m.Clone();n.SetVertices(m.v0+f,m.v1+f,m.v2+f);n.SetNormals(m.n0+h,m.n1+h,m.n2+h);n.HasTextureUVs()&&n.SetTextureUVs(m.u0+k,m.u1+k,m.u2+k);g.AddTriangle(n)}}b.AddMesh(c);return b};
OV.EnumerateModelVerticesAndTriangles=function(a,b){for(var c=0;c<a.MeshCount();c++)for(var d=a.GetMesh(c),e=0;e<d.VertexCount();e++){var g=d.GetVertex(e);b.onVertex(g.x,g.y,g.z)}for(d=c=0;d<a.MeshCount();d++){e=a.GetMesh(d);for(g=0;g<e.TriangleCount();g++){var f=e.GetTriangle(g);b.onTriangle(f.v0+c,f.v1+c,f.v2+c)}c+=e.VertexCount()}};OV.EnumerateTrianglesWithNormals=function(a,b){a.EnumerateTriangles(function(c,d,e){var g=OV.CalculateTriangleNormal(c,d,e);b(c,d,e,g)})};
OV.GetBoundingBox=function(a){var b=new OV.BoundingBoxCalculator3D;a.EnumerateVertices(function(c){b.AddPoint(c)});return b.GetBox()};OV.GetTopology=function(a){function b(g,f,h){var k=f.FindPoint(g);null===k&&(k=h.AddVertex(),f.AddPoint(g,k));return k}var c=OV.GetBoundingBox(a),d=new OV.Octree(c),e=new OV.Topology;a.EnumerateTriangles(function(g,f,h){g=b(g,d,e);f=b(f,d,e);h=b(h,d,e);e.AddTriangle(g,f,h)});return e};
OV.IsSolid=function(a){a=OV.GetTopology(a);for(var b=0;b<a.edges.length;b++){var c=a.edges[b],d=c.triangles.length;if(0===d||0!==d%2)return!1;for(var e=d=0;e<c.triangles.length;e++){var g=a.triangles[c.triangles[e]];var f=a.triangleEdges[g.triEdge1];var h=a.triangleEdges[g.triEdge2];g=a.triangleEdges[g.triEdge3];f=f.edge===b?f.reversed:h.edge===b?h.reversed:g.edge===b?g.reversed:null;d=f?d+1:d-1}if(0!==d)return!1}return!0};
OV.ReplaceDefaultMaterialColor=function(a,b){for(var c=0;c<a.MaterialCount();c++){var d=a.GetMaterial(c);d.isDefault&&(d.color=b)}};OV.FinalizeModel=function(a,b){function c(h,k){function l(p){function t(A,E,F,B,C){var G=[];F=C[F];for(C=0;C<F.length;C++){var D=F[C],H=A.GetTriangle(D);if(E.curve===H.curve){D=B[D];a:{H=G;for(var I=D,J=0;J<H.length;J++)if(OV.CoordIsEqual3D(H[J],I)){H=!0;break a}H=!1}H||G.push(D)}}E=new OV.Coord3D(0,0,0);for(B=0;B<G.length;B++)E=OV.AddCoord3D(E,G[B]);E.MultiplyScalar(1/G.length);E.Normalize();return A.AddNormal(E)}for(var r=[],u={},v=0;v<p.VertexCount();v++)u[v]=[];for(v=0;v<p.TriangleCount();v++){var w=
p.GetTriangle(v),y=p.GetVertex(w.v0),x=p.GetVertex(w.v1),z=p.GetVertex(w.v2);y=OV.CalculateTriangleNormal(y,x,z);r.push(y);u[w.v0].push(v);u[w.v1].push(v);u[w.v2].push(v)}for(v=0;v<p.TriangleCount();v++)w=p.GetTriangle(v),w.HasNormals()||(y=t(p,w,w.v0,r,u),x=t(p,w,w.v1,r,u),z=t(p,w,w.v2,r,u),w.SetNormals(y,x,z))}function m(p,t,r){if(!t.HasNormals())if(null===t.curve||0===t.curve){var u=p.GetVertex(t.v0),v=p.GetVertex(t.v1),w=p.GetVertex(t.v2);u=OV.CalculateTriangleNormal(u,v,w);p=p.AddNormal(u);t.SetNormals(p,
p,p)}else r.calculateCurveNormals=!0;null===t.mat&&(t.mat=r.getDefaultMaterialIndex());null===t.curve&&(t.curve=0)}k={getDefaultMaterialIndex:k,calculateCurveNormals:!1};for(var n=0;n<h.TriangleCount();n++){var q=h.GetTriangle(n);m(h,q,k)}k.calculateCurveNormals&&l(h)}for(var d=null,e=function(){if(null===d){var h=b();h.isDefault=!0;d=a.AddMaterial(h)}return d},g=0;g<a.MeshCount();g++){var f=a.GetMesh(g);0===f.TriangleCount()?(a.RemoveMesh(g),--g):c(f,e)}};
OV.CheckModel=function(a){function b(f){return void 0===f||null===f||isNaN(f)?!1:!0}function c(f,h){return!b(f)||0>f||f>=h?!1:!0}function d(f,h){for(var k=0;k<h.VertexCount();k++){var l=h.GetVertex(k);if(!b(l.x)||!b(l.y)||!b(l.z))return!1}for(k=0;k<h.NormalCount();k++)if(l=h.GetNormal(k),!b(l.x)||!b(l.y)||!b(l.z))return!1;for(k=0;k<h.TextureUVCount();k++)if(l=h.GetTextureUV(k),!b(l.x)||!b(l.y))return!1;for(k=0;k<h.TriangleCount();k++){var m=h.GetTriangle(k);l=f;var n=h;if(!(c(m.v0,n.VertexCount())&&
c(m.v1,n.VertexCount())&&c(m.v2,n.VertexCount())&&c(m.n0,n.NormalCount())&&c(m.n1,n.NormalCount())&&c(m.n2,n.NormalCount())&&(!m.HasTextureUVs()||c(m.u0,n.TextureUVCount())&&c(m.u1,n.TextureUVCount())&&c(m.u2,n.TextureUVCount()))&&c(m.mat,l.MaterialCount())&&b(m.curve)))return!1}return!0}for(var e=0;e<a.MeshCount();e++){var g=a.GetMesh(e);if(!d(a,g))return!1}return!0};OV.GetTriangleArea=function(a,b,c){var d=OV.CoordDistance3D(a,b);b=OV.CoordDistance3D(b,c);a=OV.CoordDistance3D(a,c);c=(d+b+a)/2;d=c*(c-d)*(c-b)*(c-a);return 0>d?0:Math.sqrt(d)};OV.GetTetrahedronSignedVolume=function(a,b,c){return OV.DotVector3D(a,OV.CrossVector3D(b,c))/6};OV.CalculateVolume=function(a){if(!OV.IsSolid(a))return null;var b=0;a.EnumerateTriangles(function(c,d,e){b+=OV.GetTetrahedronSignedVolume(c,d,e)});return b};
OV.CalculateSurfaceArea=function(a){var b=0;a.EnumerateTriangles(function(c,d,e){b+=OV.GetTriangleArea(c,d,e)});return b};OV.GeneratorParams=function(){this.transformation=this.material=this.name=null};OV.GeneratorParams.prototype.SetName=function(a){this.name=a;return this};OV.GeneratorParams.prototype.SetMaterial=function(a){this.material=a;return this};OV.GeneratorParams.prototype.SetTransformation=function(a,b,c){a=(new OV.Matrix).ComposeTRS(a,b,c);return this.SetTransformationMatrix(a)};OV.GeneratorParams.prototype.SetTransformationMatrix=function(a){this.transformation=new OV.Transformation(a);return this};
OV.Generator=function(a){this.params=a||new OV.GeneratorParams;this.mesh=new OV.Mesh;null!==this.params.name&&this.mesh.SetName(this.params.name);this.curve=null};OV.Generator.prototype.GetMesh=function(){return this.mesh};OV.Generator.prototype.AddVertex=function(a,b,c){a=new OV.Coord3D(a,b,c);null!==this.params.transformation&&(a=this.params.transformation.TransformCoord3D(a));return this.mesh.AddVertex(a)};
OV.Generator.prototype.AddVertices=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];b.push(this.AddVertex(d.x,d.y,d.z))}return b};OV.Generator.prototype.SetCurve=function(a){this.curve=a};OV.Generator.prototype.ResetCurve=function(){this.curve=null};OV.Generator.prototype.AddTriangle=function(a,b,c){a=new OV.Triangle(a,b,c);null!==this.params.material&&a.SetMaterial(this.params.material);null!==this.curve&&a.SetCurve(this.curve);return this.mesh.AddTriangle(a)};
OV.Generator.prototype.AddTriangleInverted=function(a,b,c){this.AddTriangle(a,c,b)};OV.Generator.prototype.AddConvexPolygon=function(a){for(var b=0;b<a.length-2;b++)this.AddTriangle(a[0],a[b+1],a[b+2])};OV.Generator.prototype.AddConvexPolygonInverted=function(a){for(var b=0;b<a.length-2;b++)this.AddTriangleInverted(a[0],a[b+1],a[b+2])};OV.GeneratorHelper=function(a){this.generator=a};
OV.GeneratorHelper.prototype.GenerateExtrude=function(a,b,c){for(var d=[],e=[],g=0;g<a.length;g++){var f=a[g];e.push(this.generator.AddVertex(f.x,f.y,0));d.push(this.generator.AddVertex(f.x,f.y,b))}this.generator.SetCurve(c);this.GenerateSurfaceBetweenPolygons(e,d);this.generator.ResetCurve();this.generator.AddConvexPolygonInverted(e);this.generator.AddConvexPolygon(d)};
OV.GeneratorHelper.prototype.GenerateSurfaceBetweenPolygons=function(a,b){if(a.length===b.length)for(var c=a.length,d=0;d<c;d++){var e=d,g=d<c-1?e+1:0;this.generator.AddConvexPolygon([a[e],a[g],b[g],b[e]])}};OV.GeneratorHelper.prototype.GenerateTriangleFan=function(a,b){for(var c=a.length,d=0;d<c;d++){var e=d;this.generator.AddTriangle(b,a[e],a[d<c-1?e+1:0])}};
OV.GenerateCuboid=function(a,b,c,d){a=new OV.Generator(a);b=[new OV.Coord2D(0,0),new OV.Coord2D(b,0),new OV.Coord2D(b,c),new OV.Coord2D(0,c)];(new OV.GeneratorHelper(a)).GenerateExtrude(b,d,null);return a.GetMesh()};OV.GenerateCylinder=function(a,b,c,d,e){if(3>d)return null;a=new OV.Generator(a);for(var g=[],f=2*Math.PI/d,h=0;h<d;h++){var k=h*f;k=new OV.Coord2D(b*Math.cos(k),b*Math.sin(k));g.push(k)}(new OV.GeneratorHelper(a)).GenerateExtrude(g,c,e?1:null);return a.GetMesh()};
OV.GenerateSphere=function(a,b,c,d){if(3>c)return null;a=new OV.Generator(a);var e=new OV.GeneratorHelper(a);a.SetCurve(d?1:null);d=[];for(var g=c+1,f=Math.PI/c,h=2*Math.PI/c,k=1;k<g-1;k++){for(var l=[],m=k*f,n=0;n<c;n++){var q=-(n*h);q=new OV.Coord3D(b*Math.sin(m)*Math.cos(q),b*Math.sin(m)*Math.sin(q),b*Math.cos(m));l.push(a.AddVertex(q.x,q.y,q.z))}1<k&&e.GenerateSurfaceBetweenPolygons(d[d.length-1],l);d.push(l)}c=a.AddVertex(0,0,b);b=a.AddVertex(0,0,-b);e.GenerateTriangleFan(d[0].slice().reverse(),
c);e.GenerateTriangleFan(d[d.length-1],b);a.ResetCurve();return a.GetMesh()};OV.NameFromLine=function(a,b,c){a=a.substr(b);c=a.indexOf(c);-1!==c&&(a=a.substr(0,c));return a.trim()};OV.ParametersFromLine=function(a,b){null!==b&&(b=a.indexOf(b),-1!==b&&(a=a.substr(0,b).trim()));return a.split(/\s+/u)};OV.ReadLines=function(a,b){for(var c=0,d=a.indexOf("\n",c);-1!==d;){var e=a.substr(c,d-c);c=b;e=e.trim();0<e.length&&c(e);c=d+1;d=a.indexOf("\n",c)}a=a.substr(c).trim();0<a.length&&b(a)};OV.IsPowerOfTwo=function(a){return 0===(a&a-1)};
OV.NextPowerOfTwo=function(a){return OV.IsPowerOfTwo(a)?a:parseInt(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2))),10)};OV.UpdateMaterialTransparency=function(a){a.transparent=!1;OV.IsLower(a.opacity,1)&&(a.transparent=!0)};OV.ImporterBase=function(){};OV.ImporterBase.prototype.Import=function(a,b,c){var d=this;this.Clear();this.extension=b;this.callbacks=c;this.model=new OV.Model;this.error=!1;this.message=null;this.ResetContent();this.ImportContent(a,function(){d.CreateResult(c)})};OV.ImporterBase.prototype.Clear=function(){this.message=this.error=this.model=this.callbacks=this.extension=null;this.ClearContent()};
OV.ImporterBase.prototype.CreateResult=function(a){if(this.error)a.onError();else OV.IsModelEmpty(this.model)?(this.error=!0,a.onError()):(OV.FinalizeModel(this.model,this.callbacks.getDefaultMaterial),a.onSuccess());a.onComplete()};OV.ImporterBase.prototype.CanImportExtension=function(a){return!1};OV.ImporterBase.prototype.GetKnownFileFormats=function(){return{}};OV.ImporterBase.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.ImporterBase.prototype.ClearContent=function(){};
OV.ImporterBase.prototype.ResetContent=function(){};OV.ImporterBase.prototype.ImportContent=function(a,b){};OV.ImporterBase.prototype.GetModel=function(){return this.model};OV.ImporterBase.prototype.SetError=function(){this.error=!0};OV.ImporterBase.prototype.IsError=function(){return this.error};OV.ImporterBase.prototype.SetMessage=function(a){this.message=a};OV.ImporterBase.prototype.GetMessage=function(){return this.message};OV.ImporterObj=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.ImporterObj,OV.ImporterBase);OV.ImporterObj.prototype.CanImportExtension=function(a){return"obj"===a};OV.ImporterObj.prototype.GetKnownFileFormats=function(){return{obj:OV.FileFormat.Text,mtl:OV.FileFormat.Text}};OV.ImporterObj.prototype.GetUpDirection=function(){return OV.Direction.Y};
OV.ImporterObj.prototype.ClearContent=function(){this.materialNameToIndex=this.meshNameToMeshData=this.currentMaterialIndex=this.currentMaterial=this.currentMeshData=this.currentMesh=this.globalUvs=this.globalNormals=this.globalVertices=null};OV.ImporterObj.prototype.ResetContent=function(){this.globalVertices=[];this.globalNormals=[];this.globalUvs=[];this.currentMaterialIndex=this.currentMaterial=this.currentMeshData=this.currentMesh=null;this.meshNameToMeshData={};this.materialNameToIndex={}};
OV.ImporterObj.prototype.ImportContent=function(a,b){var c=this;OV.ReadLines(a,function(d){c.IsError()||c.ProcessLine(d)});b()};OV.ImporterObj.prototype.ProcessLine=function(a){if("#"!==a[0]){var b=OV.ParametersFromLine(a,"#");if(0!==b.length){var c=b[0].toLowerCase();b.shift();this.ProcessMeshParameter(c,b,a)||this.ProcessMaterialParameter(c,b,a)}}};
OV.ImporterObj.prototype.AddNewMesh=function(a){var b=this.meshNameToMeshData[a];void 0===b&&(b=new OV.Mesh,null!==a&&b.SetName(a),this.model.AddMesh(b),b={mesh:b,data:{globalToCurrentVertices:{},globalToCurrentNormals:{},globalToCurrentUvs:{}}},this.meshNameToMeshData[a]=b);this.currentMesh=b.mesh;this.currentMeshData=b.data};
OV.ImporterObj.prototype.ProcessMeshParameter=function(a,b,c){if("g"===a||"o"===a){if(0===b.length)return!0;a=OV.NameFromLine(c,a.length,"#");this.AddNewMesh(a);return!0}if("v"===a){if(3>b.length)return!0;this.globalVertices.push(new OV.Coord3D(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2])));return!0}if("vn"===a){if(3>b.length)return!0;this.globalNormals.push(new OV.Coord3D(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2])));return!0}if("vt"===a){if(2>b.length)return!0;this.globalUvs.push(new OV.Coord2D(parseFloat(b[0]),
parseFloat(b[1])));return!0}if("f"===a){if(3>b.length)return!0;this.ProcessFace(b);return!0}return!1};
OV.ImporterObj.prototype.ProcessMaterialParameter=function(a,b,c){function d(f){return new OV.Color(parseInt(parseFloat(255*f[0]),10),parseInt(parseFloat(255*f[1]),10),parseInt(parseFloat(255*f[2]),10))}function e(f,h,k){var l=new OV.TextureMap;f=OV.NameFromLine(h,f.length,"#");k=k.getTextureBuffer(f);l.name=f;null!==k&&(l.url=k.url,l.buffer=k.buffer);return l}var g=this;if("newmtl"===a){if(0===b.length)return!0;b=new OV.Material(OV.MaterialType.Phong);a=OV.NameFromLine(c,a.length,"#");c=this.model.AddMaterial(b);
b.name=a;this.currentMaterial=b;this.materialNameToIndex[a]=c;return!0}if("usemtl"===a){if(0===b.length)return!0;b=OV.NameFromLine(c,a.length,"#");b=this.materialNameToIndex[b];void 0!==b&&(this.currentMaterialIndex=b);return!0}if("mtllib"===a){if(0===b.length)return!0;b=OV.NameFromLine(c,a.length,"#");b=this.callbacks.getFileBuffer(b);null!==b&&OV.ReadLines(b,function(f){g.IsError()||g.ProcessLine(f)});return!0}if("map_kd"===a){if(null===this.currentMaterial||0===b.length)return!0;this.currentMaterial.diffuseMap=
e(a,c,this.callbacks);OV.UpdateMaterialTransparency(this.currentMaterial);return!0}if("map_ks"===a){if(null===this.currentMaterial||0===b.length)return!0;this.currentMaterial.specularMap=e(a,c,this.callbacks);return!0}if("map_bump"===a||"bump"===a){if(null===this.currentMaterial||0===b.length)return!0;this.currentMaterial.bumpMap=e(a,c,this.callbacks);return!0}if("ka"===a){if(null===this.currentMaterial||3>b.length)return!0;this.currentMaterial.ambient=d(b);return!0}if("kd"===a){if(null===this.currentMaterial||
3>b.length)return!0;this.currentMaterial.color=d(b);return!0}if("ks"===a){if(null===this.currentMaterial||3>b.length)return!0;this.currentMaterial.specular=d(b);return!0}if("ns"===a){if(null===this.currentMaterial||1>b.length)return!0;this.currentMaterial.shininess=parseFloat(b[0])/1E3;return!0}if("tr"===a){if(null===this.currentMaterial||1>b.length)return!0;this.currentMaterial.opacity=1-parseFloat(b[0]);OV.UpdateMaterialTransparency(this.currentMaterial);return!0}if("d"===a){if(null===this.currentMaterial||
1>b.length)return!0;this.currentMaterial.opacity=parseFloat(b[0]);OV.UpdateMaterialTransparency(this.currentMaterial);return!0}return!1};
OV.ImporterObj.prototype.ProcessFace=function(a){function b(p,t){return 0<p?p-1:t+p}function c(p,t,r,u){if(isNaN(r)||0>r||r>=p.length)return null;var v=t[r];if(void 0===v){p=p[r];if(void 0===p)return null;v=u(p);t[r]=v}return v}function d(p,t,r){return c(p.globalVertices,p.currentMeshData.globalToCurrentVertices,r,function(u){return t.AddVertex(new OV.Coord3D(u.x,u.y,u.z))})}function e(p,t,r){return c(p.globalNormals,p.currentMeshData.globalToCurrentNormals,r,function(u){return t.AddNormal(new OV.Coord3D(u.x,
u.y,u.z))})}function g(p,t,r){return c(p.globalUvs,p.currentMeshData.globalToCurrentUvs,r,function(u){return t.AddTextureUV(new OV.Coord2D(u.x,u.y))})}for(var f=[],h=[],k=[],l=0;l<a.length;l++){var m=a[l].split("/");f.push(b(parseInt(m[0],10),this.globalVertices.length));1<m.length&&0<m[1].length&&k.push(b(parseInt(m[1],10),this.globalUvs.length));2<m.length&&0<m[2].length&&h.push(b(parseInt(m[2],10),this.globalNormals.length))}null===this.currentMesh&&this.AddNewMesh("");for(a=0;a<f.length-2;a++){l=
d(this,this.currentMesh,f[0]);m=d(this,this.currentMesh,f[a+1]);var n=d(this,this.currentMesh,f[a+2]);if(null===l||null===m||null===n){this.SetError();this.SetMessage("Invalid vertex index.");break}l=new OV.Triangle(l,m,n);if(h.length===f.length){m=e(this,this.currentMesh,h[0]);n=e(this,this.currentMesh,h[a+1]);var q=e(this,this.currentMesh,h[a+2]);if(null===m||null===n||null===q){this.SetError();this.SetMessage("Invalid normal index.");break}l.SetNormals(m,n,q)}if(k.length===f.length){m=g(this,this.currentMesh,
k[0]);n=g(this,this.currentMesh,k[a+1]);q=g(this,this.currentMesh,k[a+2]);if(null===m||null===n||null===q){this.SetError();this.SetMessage("Invalid uv index.");break}l.SetTextureUVs(m,n,q)}null!==this.currentMaterialIndex&&(l.mat=this.currentMaterialIndex);this.currentMesh.AddTriangle(l)}};OV.ImporterStl=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.ImporterStl,OV.ImporterBase);OV.ImporterStl.prototype.CanImportExtension=function(a){return"stl"===a};OV.ImporterStl.prototype.GetKnownFileFormats=function(){return{stl:OV.FileFormat.Binary}};OV.ImporterStl.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.ImporterStl.prototype.ClearContent=function(){this.triangle=this.mesh=null};
OV.ImporterStl.prototype.ResetContent=function(){this.mesh=new OV.Mesh;this.model.AddMesh(this.mesh);this.triangle=null};OV.ImporterStl.prototype.ImportContent=function(a,b){var c=this;this.IsBinaryStlFile(a)?this.ProcessBinary(a):(a=OV.ArrayBufferToUtf8String(a),OV.ReadLines(a,function(d){c.IsError()||c.ProcessLine(d)}));b()};
OV.ImporterStl.prototype.IsBinaryStlFile=function(a){var b=a.byteLength;if(84>b)return!1;a=new OV.BinaryReader(a,!0);a.Skip(80);a=a.ReadUnsignedInteger32();return b!==50*a+84?!1:!0};
OV.ImporterStl.prototype.ProcessLine=function(a){if("#"!==a[0]){var b=OV.ParametersFromLine(a,"#");if(0!==b.length){var c=b[0];"solid"===c?1<b.length&&(a=OV.NameFromLine(a,c.length,"#"),this.mesh.SetName(a)):"facet"===c?(this.triangle=new OV.Triangle(-1,-1,-1),5<=b.length&&"normal"===b[1]&&(a=new OV.Coord3D(parseFloat(b[2]),parseFloat(b[3]),parseFloat(b[4])),OV.IsPositive(a.Length())&&(a=this.mesh.AddNormal(a),this.triangle.SetNormals(a,a,a)))):"vertex"===c&&null!==this.triangle?4<=b.length&&(a=this.mesh.AddVertex(new OV.Coord3D(parseFloat(b[1]),
parseFloat(b[2]),parseFloat(b[3]))),-1===this.triangle.v0?this.triangle.v0=a:-1===this.triangle.v1?this.triangle.v1=a:-1===this.triangle.v2&&(this.triangle.v2=a)):"endfacet"===c&&null!==this.triangle&&(-1!==this.triangle.v0&&-1!==this.triangle.v1&&null!==this.triangle.v2&&this.mesh.AddTriangle(this.triangle),this.triangle=null)}}};
OV.ImporterStl.prototype.ProcessBinary=function(a){function b(l){var m=new OV.Coord3D;m.x=l.ReadFloat32();m.y=l.ReadFloat32();m.z=l.ReadFloat32();return m}function c(l,m){m=b(m);return l.AddVertex(m)}a=new OV.BinaryReader(a,!0);a.Skip(80);for(var d=a.ReadUnsignedInteger32(),e=0;e<d;e++){var g=b(a),f=c(this.mesh,a),h=c(this.mesh,a),k=c(this.mesh,a);a.Skip(2);f=new OV.Triangle(f,h,k);OV.IsPositive(g.Length())&&(g=this.mesh.AddNormal(g),f.SetNormals(g,g,g));this.mesh.AddTriangle(f)}};OV.ImporterOff=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.ImporterOff,OV.ImporterBase);OV.ImporterOff.prototype.CanImportExtension=function(a){return"off"===a};OV.ImporterOff.prototype.GetKnownFileFormats=function(){return{off:OV.FileFormat.Text}};OV.ImporterOff.prototype.GetUpDirection=function(){return OV.Direction.Y};OV.ImporterOff.prototype.ClearContent=function(){this.status=this.mesh=null};
OV.ImporterOff.prototype.ResetContent=function(){this.mesh=new OV.Mesh;this.model.AddMesh(this.mesh);this.status={vertexCount:0,faceCount:0,foundVertex:0,foundFace:0}};OV.ImporterOff.prototype.ImportContent=function(a,b){var c=this;OV.ReadLines(a,function(d){c.IsError()||c.ProcessLine(d)});b()};
OV.ImporterOff.prototype.ProcessLine=function(a){if("#"!==a[0]&&(a=OV.ParametersFromLine(a,"#"),0!==a.length&&"OFF"!==a[0]))if(0===this.status.vertexCount&&0===this.status.faceCount)1<a.length&&(this.status.vertexCount=parseInt(a[0],10),this.status.faceCount=parseInt(a[1],10));else if(this.status.foundVertex<this.status.vertexCount)3<=a.length&&(this.mesh.AddVertex(new OV.Coord3D(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]))),this.status.foundVertex+=1);else if(this.status.foundFace<this.status.faceCount&&
4<=a.length){var b=parseInt(a[0],10);if(!(a.length<b+1)){for(var c=0;c<b-2;c++){var d=parseInt(a[1]),e=parseInt(a[c+2]),g=parseInt(a[c+3]);d=new OV.Triangle(d,e,g);this.mesh.AddTriangle(d)}this.status.foundFace+=1}}};OV.PlyHeader=function(){this.format=null;this.elements=[]};OV.PlyHeader.prototype.SetFormat=function(a){this.format=a};OV.PlyHeader.prototype.AddElement=function(a,b){this.elements.push({name:a,count:b,format:[]})};OV.PlyHeader.prototype.GetElements=function(){return this.elements};OV.PlyHeader.prototype.AddSingleFormat=function(a,b){this.elements[this.elements.length-1].format.push({name:b,isSingle:!0,elemType:a})};
OV.PlyHeader.prototype.AddListFormat=function(a,b,c){this.elements[this.elements.length-1].format.push({name:c,isSingle:!1,countType:a,elemType:b})};OV.PlyHeader.prototype.GetElement=function(a){for(var b=0;b<this.elements.length;b++){var c=this.elements[b];if(c.name===a)return c}return null};
OV.PlyHeader.prototype.Check=function(){var a=this.GetElement("vertex");if(null===a||0===a.length||3>a.format.length)return!1;a=this.GetElement("face");if("ascii"===this.format){if(null===a||0===a.count||0>a.format.length)return!1}else if("binary_little_endian"===this.format||"binary_big_endian"===this.format){var b=this.GetElement("tristrips");b=null!==b&&0<b.count&&0<b.format.length;if(!(null!==a&&0<a.count&&0<a.format.length||b))return!1}else return!1;return!0};OV.ImporterPly=function(){OV.ImporterBase.call(this)};
$jscomp.inherits(OV.ImporterPly,OV.ImporterBase);OV.ImporterPly.prototype.CanImportExtension=function(a){return"ply"===a};OV.ImporterPly.prototype.GetKnownFileFormats=function(){return{ply:OV.FileFormat.Binary}};OV.ImporterPly.prototype.GetUpDirection=function(){return OV.Direction.Y};OV.ImporterPly.prototype.ClearContent=function(){this.mesh=null};OV.ImporterPly.prototype.ResetContent=function(){this.mesh=new OV.Mesh;this.model.AddMesh(this.mesh)};
OV.ImporterPly.prototype.ImportContent=function(a,b){var c=this.GetHeaderContent(a),d=this.ReadHeader(c);d.Check()?"ascii"===d.format?(a=OV.ArrayBufferToUtf8String(a),a=a.substr(c.length),this.ReadAsciiContent(d,a)):"binary_little_endian"!==d.format&&"binary_big_endian"!==d.format||this.ReadBinaryContent(d,a,c.length):(this.SetError(),this.SetMessage("Invalid header information."));b()};
OV.ImporterPly.prototype.GetHeaderContent=function(a){var b="",c=new Uint8Array(a),d;for(d=0;d<a.byteLength&&(b+=String.fromCharCode(c[d]),!b.endsWith("end_header"));d++);for(d+=1;d<a.byteLength;){var e=String.fromCharCode(c[d]);b+=e;d+=1;if("\n"===e)break}return b};
OV.ImporterPly.prototype.ReadHeader=function(a){var b=new OV.PlyHeader;OV.ReadLines(a,function(c){c=OV.ParametersFromLine(c,null);0!==c.length&&"comment"!==c[0]&&"ply"!==c[0]&&("format"===c[0]&&2<=c.length?b.SetFormat(c[1]):"element"===c[0]&&3<=c.length?b.AddElement(c[1],parseInt(c[2],10)):"property"===c[0]&&3<=c.length&&("list"===c[1]&&5<=c.length?b.AddListFormat(c[2],c[3],c[4]):b.AddSingleFormat(c[1],c[2])))});return b};
OV.ImporterPly.prototype.ReadAsciiContent=function(a,b){var c=this,d=a.GetElement("vertex"),e=a.GetElement("face"),g=0,f=0;OV.ReadLines(b,function(h){if(!c.IsError()&&(h=OV.ParametersFromLine(h,null),0!==h.length&&"comment"!==h[0]))if(g<d.count)3<=h.length&&(c.mesh.AddVertex(new OV.Coord3D(parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2]))),g+=1);else if(f<e.count&&4<=h.length){var k=parseInt(h[0],10);if(!(h.length<k+1)){for(var l=0;l<k-2;l++){var m=parseInt(h[1]),n=parseInt(h[l+2]),q=parseInt(h[l+
3]);m=new OV.Triangle(m,n,q);c.mesh.AddTriangle(m)}f+=1}}})};
OV.ImporterPly.prototype.ReadBinaryContent=function(a,b,c){function d(v,w,y,x){for(var z=null,A=null,E=null,F=255;x<y.length;x++){var B=y[x],C=v.ReadByFormat(w,B);"red"===B.name?z=C:"green"===B.name?A=C:"blue"===B.name?E=C:"alpha"===B.name&&(F=C)}return null!==z&&null!==A&&null!==E?[z,A,E,F]:null}function e(v,w,y){if(null===w)return null;var x="Color "+OV.IntegerToHexString(w[0])+OV.IntegerToHexString(w[1])+OV.IntegerToHexString(w[2])+OV.IntegerToHexString(w[3]),z=y[x];void 0===z&&(z=new OV.Material(OV.MaterialType.Phong),
z.name=x,z.color=new OV.Color(w[0],w[1],w[2]),z.opacity=w[3]/255,OV.UpdateMaterialTransparency(z),z=v.model.AddMaterial(z),y[x]=z);return z}function g(v,w,y,x,z,A){w=z[w];y=z[y];x=z[x];z=Math.abs(y[0]-x[0])+Math.abs(y[1]-x[1])+Math.abs(y[2]-x[2]);var E=w;Math.min(Math.abs(w[0]-y[0])+Math.abs(w[1]-y[1])+Math.abs(w[2]-y[2]),z,Math.abs(w[0]-x[0])+Math.abs(w[1]-x[1])+Math.abs(w[2]-x[2]))===z&&(E=y);return e(v,E,A)}var f=null;if("binary_little_endian"===a.format)f=new OV.BinaryReader(b,!0);else if("binary_big_endian"===
a.format)f=new OV.BinaryReader(b,!1);else return;f.Skip(c);b=[];c={};a=a.GetElements();for(var h=0;h<a.length;h++){var k=a[h];if("vertex"===k.name)for(var l=0;l<k.count;l++){var m=this.ReadByFormat(f,k.format[0]),n=this.ReadByFormat(f,k.format[1]),q=this.ReadByFormat(f,k.format[2]),p=d(this,f,k.format,3);null!==p&&b.push(p);this.mesh.AddVertex(new OV.Coord3D(m,n,q))}else if("face"===k.name)for(l=0;l<k.count;l++)for(m=this.ReadByFormat(f,k.format[0]),n=d(this,f,k.format,1),q=0;q<m.length-2;q++){p=
m[0];var t=m[q+1],r=m[q+2],u=new OV.Triangle(p,t,r);null!==n?u.mat=e(this,n,c):b.length===this.model.VertexCount()&&(u.mat=g(this,p,t,r,b,c));this.mesh.AddTriangle(u)}else if("tristrips"===k.name)for(l=0;l<k.count;l++)for(m=this.ReadByFormat(f,k.format[0]),this.SkipFormat(f,k.format,1),n=!0,q=0;q<m.length-2;q++)p=m[q],t=m[q+1],r=m[q+2],-1===r?(q+=2,n=!0):(n||(u=t,t=r,r=u),n=!n,p=new OV.Triangle(p,t,r),this.mesh.AddTriangle(p));else this.SkipFormat(f,k.format,0)}};
OV.ImporterPly.prototype.SkipFormat=function(a,b,c){for(;c<b.length;c++)this.ReadByFormat(a,b[c])};
OV.ImporterPly.prototype.ReadByFormat=function(a,b){function c(f,h){return"char"===h||"int8"===h?f.ReadCharacter8():"uchar"===h||"uint8"===h?f.ReadUnsignedCharacter8():"short"===h||"int16"===h?f.ReadInteger16():"ushort"===h||"uint16"===h?f.ReadUnsignedInteger16():"int"===h||"int32"===h?f.ReadInteger32():"uint"===h||"uint32"===h?f.ReadUnsignedInteger32():"float"===h||"float32"===h?f.ReadFloat32():"double"===h||"double64"===h?f.ReadDouble64():null}if(b.isSingle)return c(a,b.elemType);for(var d=[],e=
c(a,b.countType),g=0;g<e;g++)d.push(c(a,b.elemType));return d};OV.CHUNK3DS={MAIN3DS:19789,EDIT3DS:15677,EDIT_MATERIAL:45055,MAT_NAME:40960,MAT_AMBIENT:40976,MAT_DIFFUSE:40992,MAT_SPECULAR:41008,MAT_SHININESS:41024,MAT_SHININESS_STRENGTH:41025,MAT_TRANSPARENCY:41040,MAT_COLOR_F:16,MAT_COLOR:17,MAT_LIN_COLOR:18,MAT_LIN_COLOR_F:19,MAT_TEXMAP:41472,MAT_TEXMAP_NAME:41728,MAT_TEXMAP_UOFFSET:41816,MAT_TEXMAP_VOFFSET:41818,MAT_TEXMAP_USCALE:41812,MAT_TEXMAP_VSCALE:41814,MAT_TEXMAP_ROTATION:41820,PERCENTAGE:48,PERCENTAGE_F:49,EDIT_OBJECT:16384,OBJ_TRIMESH:16640,OBJ_LIGHT:17920,
OBJ_CAMERA:18176,TRI_VERTEX:16656,TRI_TEXVERTEX:16704,TRI_FACE:16672,TRI_TRANSFORMATION:16736,TRI_MATERIAL:16688,TRI_SMOOTH:16720,KF3DS:45056,OBJECT_NODE:45058,OBJECT_HIERARCHY:45072,OBJECT_INSTANCE_NAME:45073,OBJECT_PIVOT:45075,OBJECT_POSITION:45088,OBJECT_ROTATION:45089,OBJECT_SCALE:45090,OBJECT_ID:45104};OV.Importer3ds=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.Importer3ds,OV.ImporterBase);OV.Importer3ds.prototype.CanImportExtension=function(a){return"3ds"===a};
OV.Importer3ds.prototype.GetKnownFileFormats=function(){return{"3ds":OV.FileFormat.Binary}};OV.Importer3ds.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.Importer3ds.prototype.ClearContent=function(){this.defaultMaterialIndex=this.meshTransformations=this.meshNameToIndex=this.materialNameToIndex=null};OV.Importer3ds.prototype.ResetContent=function(){this.materialNameToIndex={};this.meshNameToIndex={};this.meshTransformations=[];this.defaultMaterialIndex=null};
OV.Importer3ds.prototype.ImportContent=function(a,b){this.ProcessBinary(a);b()};OV.Importer3ds.prototype.ProcessBinary=function(a){var b=this,c=new OV.BinaryReader(a,!0);a=c.GetByteLength();this.ReadChunks(c,a,function(d,e){d===OV.CHUNK3DS.MAIN3DS?b.ReadMainChunk(c,e):b.SkipChunk(c,e)})};
OV.Importer3ds.prototype.ReadMainChunk=function(a,b){var c=this;b=this.GetChunkEnd(a,b);this.ReadChunks(a,b,function(d,e){d===OV.CHUNK3DS.EDIT3DS?c.ReadEditorChunk(a,e):d===OV.CHUNK3DS.KF3DS?c.ReadKeyFrameChunk(a,e):c.SkipChunk(a,e)})};OV.Importer3ds.prototype.ReadEditorChunk=function(a,b){var c=this;b=this.GetChunkEnd(a,b);this.ReadChunks(a,b,function(d,e){d===OV.CHUNK3DS.EDIT_MATERIAL?c.ReadMaterialChunk(a,e):d===OV.CHUNK3DS.EDIT_OBJECT?c.ReadObjectChunk(a,e):c.SkipChunk(a,e)})};
OV.Importer3ds.prototype.ReadMaterialChunk=function(a,b){var c=this,d=new OV.Material(OV.MaterialType.Phong);b=this.GetChunkEnd(a,b);var e=null,g=null;this.ReadChunks(a,b,function(f,h){f===OV.CHUNK3DS.MAT_NAME?d.name=c.ReadName(a):f===OV.CHUNK3DS.MAT_AMBIENT?d.ambient=c.ReadColorChunk(a,h):f===OV.CHUNK3DS.MAT_DIFFUSE?d.color=c.ReadColorChunk(a,h):f===OV.CHUNK3DS.MAT_SPECULAR?d.specular=c.ReadColorChunk(a,h):f===OV.CHUNK3DS.MAT_SHININESS?e=c.ReadPercentageChunk(a,h):f===OV.CHUNK3DS.MAT_SHININESS_STRENGTH?
g=c.ReadPercentageChunk(a,h):f===OV.CHUNK3DS.MAT_TRANSPARENCY?(d.opacity=1-c.ReadPercentageChunk(a,h),OV.UpdateMaterialTransparency(d)):f===OV.CHUNK3DS.MAT_TEXMAP?(d.diffuseMap=c.ReadTextureMapChunk(a,h),OV.UpdateMaterialTransparency(d)):c.SkipChunk(a,h)});null!==e&&null!==g&&(d.shininess=e*g/10);b=this.model.AddMaterial(d);this.materialNameToIndex[d.name]=b};
OV.Importer3ds.prototype.ReadTextureMapChunk=function(a,b){var c=this,d=new OV.TextureMap;b=this.GetChunkEnd(a,b);this.ReadChunks(a,b,function(e,g){e===OV.CHUNK3DS.MAT_TEXMAP_NAME?(e=c.ReadName(a),g=c.callbacks.getTextureBuffer(e),d.name=e,null!==g&&(d.url=g.url,d.buffer=g.buffer)):e===OV.CHUNK3DS.MAT_TEXMAP_UOFFSET?d.offset.x=a.ReadFloat32():e===OV.CHUNK3DS.MAT_TEXMAP_VOFFSET?d.offset.y=a.ReadFloat32():e===OV.CHUNK3DS.MAT_TEXMAP_USCALE?d.scale.x=a.ReadFloat32():e===OV.CHUNK3DS.MAT_TEXMAP_VSCALE?
d.scale.y=a.ReadFloat32():e===OV.CHUNK3DS.MAT_TEXMAP_ROTATION?d.rotation=a.ReadFloat32()*OV.DegRad:c.SkipChunk(a,g)});return d};
OV.Importer3ds.prototype.ReadColorChunk=function(a,b){var c=this,d=new OV.Color(0,0,0);b=this.GetChunkEnd(a,b);var e=!1;this.ReadChunks(a,b,function(g,f){g===OV.CHUNK3DS.MAT_COLOR?e||(d.r=a.ReadUnsignedCharacter8(),d.g=a.ReadUnsignedCharacter8(),d.b=a.ReadUnsignedCharacter8()):g===OV.CHUNK3DS.MAT_LIN_COLOR?(d.r=a.ReadUnsignedCharacter8(),d.g=a.ReadUnsignedCharacter8(),d.b=a.ReadUnsignedCharacter8(),e=!0):g===OV.CHUNK3DS.MAT_COLOR_F?e||(d.r=parseInt(255*a.ReadFloat32(),10),d.g=parseInt(255*a.ReadFloat32(),
10),d.b=parseInt(255*a.ReadFloat32(),10)):g===OV.CHUNK3DS.MAT_LIN_COLOR_F?(d.r=parseInt(255*a.ReadFloat32(),10),d.g=parseInt(255*a.ReadFloat32(),10),d.b=parseInt(255*a.ReadFloat32(),10),e=!0):c.SkipChunk(a,f)});return d};OV.Importer3ds.prototype.ReadPercentageChunk=function(a,b){var c=this,d=0;b=this.GetChunkEnd(a,b);this.ReadChunks(a,b,function(e,g){e===OV.CHUNK3DS.PERCENTAGE?d=a.ReadUnsignedInteger16()/100:e===OV.CHUNK3DS.PERCENTAGE_F?d=a.ReadFloat32():c.SkipChunk(a,g)});return d};
OV.Importer3ds.prototype.ReadObjectChunk=function(a,b){var c=this;b=this.GetChunkEnd(a,b);var d=this.ReadName(a);this.ReadChunks(a,b,function(e,g){e===OV.CHUNK3DS.OBJ_TRIMESH?c.ReadMeshChunk(a,g,d):c.SkipChunk(a,g)})};
OV.Importer3ds.prototype.ReadMeshChunk=function(a,b,c){var d=this,e=new OV.Mesh;e.SetName(c);b=this.GetChunkEnd(a,b);var g=null;this.ReadChunks(a,b,function(f,h){f===OV.CHUNK3DS.TRI_VERTEX?d.ReadVerticesChunk(e,a):f===OV.CHUNK3DS.TRI_TEXVERTEX?d.ReadTextureVerticesChunk(e,a):f===OV.CHUNK3DS.TRI_FACE?d.ReadFacesChunk(e,a,h):f===OV.CHUNK3DS.TRI_TRANSFORMATION?g=d.ReadTransformationChunk(a):d.SkipChunk(a,h)});if(e.VertexCount()===e.TextureUVCount())for(b=0;b<e.TriangleCount();b++)c=e.GetTriangle(b),
c.SetTextureUVs(c.v0,c.v1,c.v2);b=this.model.AddMesh(e);this.meshNameToIndex[e.GetName()]=b;this.meshTransformations.push(new OV.Matrix(g))};OV.Importer3ds.prototype.ReadVerticesChunk=function(a,b){for(var c=b.ReadUnsignedInteger16(),d=0;d<c;d++){var e=b.ReadFloat32(),g=b.ReadFloat32(),f=b.ReadFloat32();a.AddVertex(new OV.Coord3D(e,g,f))}};
OV.Importer3ds.prototype.ReadTextureVerticesChunk=function(a,b){for(var c=b.ReadUnsignedInteger16(),d=0;d<c;d++){var e=b.ReadFloat32(),g=b.ReadFloat32();a.AddTextureUV(new OV.Coord2D(e,g))}};
OV.Importer3ds.prototype.ReadFacesChunk=function(a,b,c){var d=this;c=this.GetChunkEnd(b,c);for(var e=b.ReadUnsignedInteger16(),g=0;g<e;g++){var f=b.ReadUnsignedInteger16(),h=b.ReadUnsignedInteger16(),k=b.ReadUnsignedInteger16();b.ReadUnsignedInteger16();a.AddTriangle(new OV.Triangle(f,h,k))}this.ReadChunks(b,c,function(l,m){l===OV.CHUNK3DS.TRI_MATERIAL?d.ReadFaceMaterialsChunk(a,b):l===OV.CHUNK3DS.TRI_SMOOTH?d.ReadFaceSmoothingGroupsChunk(a,e,b):d.SkipChunk(b,m)})};
OV.Importer3ds.prototype.ReadFaceMaterialsChunk=function(a,b){var c=this.ReadName(b);c=this.materialNameToIndex[c];for(var d=b.ReadUnsignedInteger16(),e=0;e<d;e++){var g=b.ReadUnsignedInteger16();g=a.GetTriangle(g);void 0!==c&&(g.mat=c)}};OV.Importer3ds.prototype.ReadFaceSmoothingGroupsChunk=function(a,b,c){for(var d=0;d<b;d++){var e=c.ReadUnsignedInteger32();a.GetTriangle(d).curve=e}};
OV.Importer3ds.prototype.ReadTransformationChunk=function(a){for(var b=[],c=0;4>c;c++){for(var d=0;3>d;d++)b.push(a.ReadFloat32());3>c?b.push(0):b.push(1)}return b};OV.Importer3ds.prototype.ReadKeyFrameChunk=function(a,b){var c=this,d={nodes:[],idToIndex:{},meshIndexToNodes:{}};b=this.GetChunkEnd(a,b);this.ReadChunks(a,b,function(e,g){e===OV.CHUNK3DS.OBJECT_NODE?c.ReadObjectNodeChunk(d,a,g):c.SkipChunk(a,g)});this.ApplyModelTransformations(d)};
OV.Importer3ds.prototype.ApplyModelTransformations=function(a){function b(q,p){if(null!==p.matrix)return p.matrix;var t=new OV.Matrix,r=t,u=r.ComposeTRS,v=OV,w=v.ArrayToCoord3D;var y=0===p.positions.length?[0,0,0]:p.positions[0];v=w.call(v,y);w=OV;y=w.ArrayToQuaternion;if(0===p.rotations.length)var x=[0,0,0,1];else{x=p.rotations[0];var z=[0,0,0,1],A=Math.sqrt(x[0]*x[0]+x[1]*x[1]+x[2]*x[2]);0<A&&(z=-.5*x[3],A=Math.sin(z)/A,z=[A*x[0],A*x[1],A*x[2],Math.cos(z)]);x=z}w=y.call(w,x);y=OV;x=y.ArrayToCoord3D;
A=0===p.scales.length?[1,1,1]:p.scales[0];u.call(r,v,w,x.call(y,A));65535!==p.userId&&(r=q.idToIndex[p.userId],void 0!==r&&(q=b(q,q.nodes[r]),t=t.MultiplyMatrix(q)));return p.matrix=t}function c(q,p,t,r,u){if(t.IsValid()){var v=t;null!==u&&(v=b(r,u));q=q.GetMesh(p);p=t.Determinant();(p=OV.IsNegative(p))&&(t=(new OV.Matrix).CreateScale(-1,1,1).MultiplyMatrix(t));t=t.Invert();null!==t&&(u=null===u?[0,0,0]:u.pivot,u=(new OV.Matrix).CreateTranslation(-u[0],-u[1],-u[2]),v=v.Clone(),v=u.MultiplyMatrix(v),
v=t.MultiplyMatrix(v),v=new OV.Transformation(v),p&&OV.FlipMeshTrianglesOrientation(q),OV.TransformMesh(q,v))}}function d(q,p,t){p=q.GetMesh(p);p=OV.CloneMesh(p);return q.AddMeshToIndex(p,t)}for(var e=0,g=0;g<this.model.MeshCount();g++){var f=g,h=f-e,k=this.meshTransformations[h];h=a.meshIndexToNodes[h];if(void 0===h)c(this.model,f,k,a,null);else for(var l=0;l<h.length;l++){var m=h[l],n=f;0<l&&(n=d(this.model,f,f+l),e+=1,g+=1);c(this.model,n,k,a,m)}}};
OV.Importer3ds.prototype.ReadObjectNodeChunk=function(a,b,c){function d(f,h,k){var l=[];h.Skip(10);for(var m=h.ReadInteger32(),n=0;n<m;n++){h.ReadInteger32();0!==h.ReadUnsignedInteger16()&&h.ReadFloat32();if(k===OV.CHUNK3DS.OBJECT_ROTATION){var q=h.ReadFloat32();var p=f.ReadVector(h);p[3]=q}else p=f.ReadVector(h);l.push(p)}return l}var e=this,g={name:"",instanceName:"",nodeId:-1,flags:-1,userId:-1,pivot:[0,0,0],positions:[],rotations:[],scales:[],matrix:null};c=this.GetChunkEnd(b,c);this.ReadChunks(b,
c,function(f,h){f===OV.CHUNK3DS.OBJECT_HIERARCHY?(g.name=e.ReadName(b),g.flags=b.ReadUnsignedInteger32(),g.userId=b.ReadUnsignedInteger16()):f===OV.CHUNK3DS.OBJECT_INSTANCE_NAME?g.instanceName=e.ReadName(b):f===OV.CHUNK3DS.OBJECT_PIVOT?g.pivot=e.ReadVector(b):f===OV.CHUNK3DS.OBJECT_POSITION?g.positions=d(e,b,OV.CHUNK3DS.OBJECT_POSITION):f===OV.CHUNK3DS.OBJECT_ROTATION?g.rotations=d(e,b,OV.CHUNK3DS.OBJECT_ROTATION):f===OV.CHUNK3DS.OBJECT_SCALE?g.scales=d(e,b,OV.CHUNK3DS.OBJECT_SCALE):f===OV.CHUNK3DS.OBJECT_ID?
g.nodeId=b.ReadUnsignedInteger16():e.SkipChunk(b,h)});c=a.nodes.length;a.nodes.push(g);a.idToIndex[g.nodeId]=c;c=this.meshNameToIndex[g.name];void 0!==c&&(void 0===a.meshIndexToNodes[c]&&(a.meshIndexToNodes[c]=[]),a.meshIndexToNodes[c].push(g))};OV.Importer3ds.prototype.ReadName=function(a){for(var b="",c,d=0;64>d;){c=a.ReadCharacter8();if(0===c)break;b+=String.fromCharCode(c);d+=1}return b};OV.Importer3ds.prototype.ReadVector=function(a){return[a.ReadFloat32(),a.ReadFloat32(),a.ReadFloat32()]};
OV.Importer3ds.prototype.ReadChunks=function(a,b,c){for(;a.GetPosition()<=b-6;){var d=a.ReadUnsignedInteger16(),e=a.ReadUnsignedInteger32();c(d,e)}};OV.Importer3ds.prototype.GetChunkEnd=function(a,b){return a.GetPosition()+b-6};OV.Importer3ds.prototype.SkipChunk=function(a,b){a.Skip(b-6)};OV.GltfComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};OV.GltfDataType={SCALAR:0,VEC2:1,VEC3:2,VEC4:3,MAT2:4,MAT3:5,MAT4:6};OV.GltfRenderMode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};OV.GltfConstants={GLTF_STRING:1179937895,JSON_CHUNK_TYPE:1313821514,BINARY_CHUNK_TYPE:5130562};OV.GltfNodeTree=function(){this.nodes=[];this.nodeToParent={};this.nodeMatrices={}};
OV.GltfNodeTree.prototype.AddMeshNode=function(a){this.nodes.push(a);return this.nodes.length-1};OV.GltfNodeTree.prototype.AddNodeParent=function(a,b){this.nodeToParent[a]=b};OV.GltfNodeTree.prototype.GetNodeParent=function(a){a=this.nodeToParent[a];return void 0===a||-1===a?null:a};OV.GltfNodeTree.prototype.AddNodeMatrix=function(a,b){this.nodeMatrices[a]=b};OV.GltfNodeTree.prototype.GetNodeMatrix=function(a){a=this.nodeMatrices[a];return void 0===a?null:a};
OV.GltfBufferReader=function(a){this.reader=new OV.BinaryReader(a,!0);this.sparseReader=this.dataCount=this.byteStride=this.dataType=this.componentType=null};OV.GltfBufferReader.prototype.SetComponentType=function(a){this.componentType=a};
OV.GltfBufferReader.prototype.SetDataType=function(a){"SCALAR"===a?this.dataType=OV.GltfDataType.SCALAR:"VEC2"===a?this.dataType=OV.GltfDataType.VEC2:"VEC3"===a?this.dataType=OV.GltfDataType.VEC3:"VEC4"===a?this.dataType=OV.GltfDataType.VEC4:"MAT2"===a?this.dataType=OV.GltfDataType.MAT2:"MAT3"===a?this.dataType=OV.GltfDataType.MAT3:"MAT4"===a&&(this.dataType=OV.GltfDataType.MAT4)};OV.GltfBufferReader.prototype.SetByteStride=function(a){this.byteStride=a};
OV.GltfBufferReader.prototype.SetDataCount=function(a){this.dataCount=a};OV.GltfBufferReader.prototype.SetSparseReader=function(a,b){this.sparseReader={indexReader:a,valueReader:b}};OV.GltfBufferReader.prototype.ReadArrayBuffer=function(a){return this.reader.ReadArrayBuffer(a)};OV.GltfBufferReader.prototype.GetDataCount=function(){return this.dataCount};
OV.GltfBufferReader.prototype.ReadData=function(){if(null===this.dataType)return null;if(this.dataType===OV.GltfDataType.SCALAR){var a=this.ReadComponent();this.SkipBytesByStride(1);return a}if(this.dataType===OV.GltfDataType.VEC2){a=this.ReadComponent();var b=this.ReadComponent();this.SkipBytesByStride(2);return new OV.Coord2D(a,b)}if(this.dataType===OV.GltfDataType.VEC3){a=this.ReadComponent();b=this.ReadComponent();var c=this.ReadComponent();this.SkipBytesByStride(3);return new OV.Coord3D(a,b,
c)}return null};OV.GltfBufferReader.prototype.EnumerateData=function(a){if(null===this.sparseReader)for(var b=0;b<this.dataCount;b++)a(this.ReadData());else{b=[];for(var c=0;c<this.sparseReader.indexReader.GetDataCount();c++){var d=this.sparseReader.indexReader.ReadData(),e=this.sparseReader.valueReader.ReadData();b.push({index:d,value:e})}for(d=c=0;d<this.dataCount;d++)e=this.ReadData(),c<b.length&&b[c].index===d?(a(b[c].value),c+=1):a(e)}};OV.GltfBufferReader.prototype.SkipBytes=function(a){this.reader.Skip(a)};
OV.GltfBufferReader.prototype.ReadComponent=function(){return null===this.componentType?null:this.componentType===OV.GltfComponentType.BYTE?this.reader.ReadCharacter8():this.componentType===OV.GltfComponentType.UNSIGNED_BYTE?this.reader.ReadUnsignedCharacter8():this.componentType===OV.GltfComponentType.SHORT?this.reader.ReadInteger16():this.componentType===OV.GltfComponentType.UNSIGNED_SHORT?this.reader.ReadUnsignedInteger16():this.componentType===OV.GltfComponentType.UNSIGNED_INT?this.reader.ReadInteger32():
this.componentType===OV.GltfComponentType.FLOAT?this.reader.ReadFloat32():null};OV.GltfBufferReader.prototype.SkipBytesByStride=function(a){null!==this.byteStride&&(a*=this.GetComponentSize(),this.reader.Skip(this.byteStride-a))};
OV.GltfBufferReader.prototype.GetComponentSize=function(){return this.componentType===OV.GltfComponentType.BYTE||this.componentType===OV.GltfComponentType.UNSIGNED_BYTE?1:this.componentType===OV.GltfComponentType.SHORT||this.componentType===OV.GltfComponentType.UNSIGNED_SHORT?2:this.componentType===OV.GltfComponentType.UNSIGNED_INT||this.componentType===OV.GltfComponentType.FLOAT?4:0};
OV.GltfExtensions=function(){this.supportedExtensions=["KHR_draco_mesh_compression","KHR_materials_pbrSpecularGlossiness","KHR_texture_transform"];this.draco=null};OV.GltfExtensions.prototype.LoadLibraries=function(a,b){var c=this;if(void 0===a)b.onSuccess();else if(null===this.draco&&-1!==a.indexOf("KHR_draco_mesh_compression"))OV.LoadExternalLibrary("draco_decoder.js").then(function(){DracoDecoderModule().then(function(d){c.draco=d;b.onSuccess()})}).catch(function(){b.onError()});else b.onSuccess()};
OV.GltfExtensions.prototype.GetUnsupportedExtensions=function(a){var b=[];if(void 0===a)return b;for(var c=0;c<a.length;c++){var d=a[c];-1===this.supportedExtensions.indexOf(d)&&b.push(d)}return b};
OV.GltfExtensions.prototype.ProcessMaterial=function(a,b,c){function d(g){return parseInt(Math.round(255*OV.LinearToSRGB(g)),10)}if(void 0!==a.extensions&&(a=a.extensions.KHR_materials_pbrSpecularGlossiness,void 0!==a)){b.type=OV.MaterialType.Phong;var e=a.diffuseFactor;void 0!==e&&(b.color=new OV.Color(d(e[0]),d(e[1]),d(e[2])),b.opacity=e[3]);e=a.diffuseTexture;void 0!==e&&(b.diffuseMap=c(e));e=a.specularFactor;void 0!==e&&(b.specular=new OV.Color(d(e[0]),d(e[1]),d(e[2])));e=a.specularGlossinessTexture;
void 0!==e&&(b.specularMap=c(e));c=a.glossinessFactor;void 0!==c&&(b.shininess=c)}};OV.GltfExtensions.prototype.ProcessTexture=function(a,b){void 0!==a.extensions&&(a=a.extensions.KHR_texture_transform,void 0!==a&&(void 0!==a.offset&&(b.offset.x=a.offset[0],b.offset.y=-a.offset[1]),void 0!==a.scale&&(b.scale.x=a.scale[0],b.scale.y=a.scale[1]),void 0!==a.rotation&&(b.rotation=-a.rotation)))};
OV.GltfExtensions.prototype.ProcessPrimitive=function(a,b,c,d){function e(t,r,u,v,w){var y=r.GetAttributeByUniqueId(u,v),x=y.num_components(),z=u.num_points()*x,A=4*z;v=t._malloc(A);r.GetAttributeDataArrayForAllPoints(u,y,t.DT_FLOAT32,A,v);r=(new Float32Array(t.HEAPF32.buffer,v,z)).slice();if(2===x)for(u=0;u<r.length;u+=2)w(new OV.Coord2D(r[u+0],r[u+1]));else if(3===x)for(u=0;u<r.length;u+=3)w(new OV.Coord3D(r[u+0],r[u+1],r[u+2]));t._free(v)}if(null===this.draco||void 0===c.extensions||void 0===c.extensions.KHR_draco_mesh_compression)return!1;
var g=new this.draco.Decoder,f=new this.draco.DecoderBuffer,h=c.extensions.KHR_draco_mesh_compression;b=b.bufferViews[h.bufferView];b=a.GetReaderFromBufferView(b).ReadArrayBuffer(b.byteLength);f.Init(new Int8Array(b),b.byteLength);if(g.GetEncodedGeometryType(f)!==this.draco.TRIANGULAR_MESH)return!0;var k=new this.draco.Mesh;if(!g.DecodeBufferToMesh(f,k).ok())return!0;f=void 0!==h.attributes.NORMAL;b=void 0!==h.attributes.TEXCOORD_0;if(void 0===h.attributes.POSITION)return!0;var l=d.VertexCount(),
m=d.NormalCount(),n=d.TextureUVCount();e(this.draco,g,k,h.attributes.POSITION,function(t){d.AddVertex(t)});f&&e(this.draco,g,k,h.attributes.NORMAL,function(t){d.AddNormal(t)});b&&e(this.draco,g,k,h.attributes.TEXCOORD_0,function(t){t.y=-t.y;d.AddTextureUV(t)});var q=3*k.num_faces(),p=4*q;h=this.draco._malloc(p);g.GetTrianglesUInt32Array(k,p,h);g=(new Uint32Array(this.draco.HEAPU32.buffer,h,q)).slice();for(k=0;k<g.length;k+=3)a.AddTriangle(c,d,g[k],g[k+1],g[k+2],f,b,l,m,n);this.draco._free(h);return!0};
OV.ImporterGltf=function(){OV.ImporterBase.call(this);this.gltfExtensions=new OV.GltfExtensions};$jscomp.inherits(OV.ImporterGltf,OV.ImporterBase);OV.ImporterGltf.prototype.CanImportExtension=function(a){return"gltf"===a||"glb"===a};OV.ImporterGltf.prototype.GetKnownFileFormats=function(){return{gltf:OV.FileFormat.Text,glb:OV.FileFormat.Binary,bin:OV.FileFormat.Binary}};OV.ImporterGltf.prototype.GetUpDirection=function(){return OV.Direction.Y};
OV.ImporterGltf.prototype.ClearContent=function(){this.imageIndexToTextureParams=this.bufferContents=null};OV.ImporterGltf.prototype.ResetContent=function(){this.bufferContents=[];this.imageIndexToTextureParams={}};OV.ImporterGltf.prototype.ImportContent=function(a,b){"gltf"===this.extension?this.ProcessGltf(a,b):"glb"===this.extension&&this.ProcessBinaryGltf(a,b)};
OV.ImporterGltf.prototype.ProcessGltf=function(a,b){a=JSON.parse(a);if("2.0"!==a.asset.version)this.SetError(),this.SetMessage("Invalid glTF version."),b();else{for(var c=0;c<a.buffers.length;c++){var d=null,e=a.buffers[c],g=OV.Base64DataURIToArrayBuffer(e.uri);null!==g?d=g.buffer:(e=this.callbacks.getFileBuffer(e.uri),null!==e&&(d=e));if(null===d){this.SetError();this.SetMessage("One  of the requested buffers is missing.");b();return}this.bufferContents.push(d)}this.ProcessMainFile(a,b)}};
OV.ImporterGltf.prototype.ProcessBinaryGltf=function(a,b){a=new OV.BinaryReader(a,!0);if(a.ReadUnsignedInteger32()!==OV.GltfConstants.GLTF_STRING)this.SetError(),this.SetMessage("Invalid glTF file."),b();else if(2!==a.ReadUnsignedInteger32())this.SetError(),this.SetMessage("Invalid glTF version."),b();else if(a.ReadUnsignedInteger32()!==a.GetByteLength())this.SetError(),this.SetMessage("Invalid glTF file."),b();else{for(var c=null;!a.End();){var d=a;var e=d.ReadUnsignedInteger32();var g=d.ReadUnsignedInteger32();
d=d.ReadArrayBuffer(e);g===OV.GltfConstants.JSON_CHUNK_TYPE?c=OV.ArrayBufferToUtf8String(d):g===OV.GltfConstants.BINARY_CHUNK_TYPE&&this.bufferContents.push(d)}null!==c&&(a=JSON.parse(c),this.ProcessMainFile(a,b))}};
OV.ImporterGltf.prototype.ProcessMainFile=function(a,b){var c=this,d=this.gltfExtensions.GetUnsupportedExtensions(a.extensionsRequired);0<d.length?(this.SetError(),this.SetMessage("Unsupported extension: "+d.join(", ")+"."),b()):this.gltfExtensions.LoadLibraries(a.extensionsRequired,{onSuccess:function(){c.ImportModel(a);b()},onError:function(){c.SetError();c.SetMessage("Failed to load draco decoder.");b()}})};
OV.ImporterGltf.prototype.ImportModel=function(a){var b=this.GetDefaultScene(a);if(null===b)this.SetError(),this.SetMessage("No default scene found.");else{this.ImportModelProperties(a);var c=a.materials;if(void 0!==c)for(var d=0;d<c.length;d++)this.ImportMaterial(a,d);b=this.CollectMeshNodesForScene(a,b);for(c=0;c<b.nodes.length;c++)this.ImportMeshNode(a,b.nodes[c],b)}};
OV.ImporterGltf.prototype.ImportModelProperties=function(a){var b=new OV.PropertyGroup("Asset properties"),c;for(c in a.asset)if(Object.prototype.hasOwnProperty.call(a.asset,c)&&"string"===typeof a.asset[c]){var d=new OV.Property(OV.PropertyType.Text,c,a.asset[c]);b.AddProperty(d)}0<b.PropertyCount()&&this.model.AddPropertyGroup(b)};OV.ImporterGltf.prototype.GetDefaultScene=function(a){var b=a.scene||0;return b>=a.scenes.length?null:a.scenes[b]};
OV.ImporterGltf.prototype.CollectMeshNodesForScene=function(a,b){function c(f,h,k,l,m){var n=f.nodes[k];void 0!==n.mesh&&(l.AddMeshNode(k),m.push(k));l.AddNodeParent(k,h);if(void 0!==n.children)for(h=0;h<n.children.length;h++)c(f,k,n.children[h],l,m)}for(var d=new OV.GltfNodeTree,e=[],g=0;g<b.nodes.length;g++)c(a,-1,b.nodes[g],d,e);return d};
OV.ImporterGltf.prototype.ImportMaterial=function(a,b){function c(f){return parseInt(Math.round(255*OV.LinearToSRGB(f)),10)}var d=this;b=a.materials[b];var e=new OV.Material(OV.MaterialType.Physical);void 0!==b.name&&(e.name=b.name);e.color=new OV.Color(c(1),c(1),c(1));if(void 0!==b.pbrMetallicRoughness){var g=b.pbrMetallicRoughness.baseColorFactor;void 0!==g&&(e.color=new OV.Color(c(g[0]),c(g[1]),c(g[2])),e.opacity=g[3]);g=b.pbrMetallicRoughness.metallicFactor;void 0!==g&&(e.metallic=g);g=b.pbrMetallicRoughness.roughnessFactor;
void 0!==g&&(e.roughness=g);g=b.emissiveFactor;void 0!==g&&(e.emissive=new OV.Color(c(g[0]),c(g[1]),c(g[2])));e.diffuseMap=this.ImportTexture(a,b.pbrMetallicRoughness.baseColorTexture);e.metalnessMap=this.ImportTexture(a,b.pbrMetallicRoughness.metallicRoughnessTexture);e.normalMap=this.ImportTexture(a,b.normalTexture);e.emissiveMap=this.ImportTexture(a,b.emissiveTexture);null!==e.diffuseMap&&(e.multiplyDiffuseMap=!0);g=b.alphaMode;void 0!==g&&("BLEND"===g?e.transparent=!0:"MASK"===g&&(e.transparent=
!0,e.alphaTest=b.alphaCutoff||.5))}this.gltfExtensions.ProcessMaterial(b,e,function(f){return d.ImportTexture(a,f)});this.model.AddMaterial(e)};
OV.ImporterGltf.prototype.ImportTexture=function(a,b){function c(l){if(void 0===l||null===l)return"";l=l.split("/");return 0===l.length?"":"."+l[l.length-1]}if(void 0===b||null===b)return null;var d=new OV.TextureMap,e=a.textures[b.index].source,g=a.images[e],f=this.imageIndexToTextureParams[e];if(void 0===f){f={name:null,url:null,buffer:null};var h=e.toString();if(void 0!==g.uri)a=OV.Base64DataURIToArrayBuffer(g.uri),null!==a?(f.name="Embedded_"+h+c(a.mimeType),f.url=OV.CreateObjectUrlWithMimeType(a.buffer,
a.mimeType),f.buffer=a.buffer):(h=this.callbacks.getTextureBuffer(g.uri),f.name=g.uri,null!==h&&(f.url=h.url,f.buffer=h.buffer));else if(void 0!==g.bufferView){a=a.bufferViews[g.bufferView];var k=this.GetReaderFromBufferView(a);null!==k&&(a=k.ReadArrayBuffer(a.byteLength),f.name="Binary_"+h+c(g.mimeType),f.url=OV.CreateObjectUrlWithMimeType(a,g.mimeType),f.buffer=a)}this.imageIndexToTextureParams[e]=f}d.name=f.name;d.url=f.url;d.buffer=f.buffer;this.gltfExtensions.ProcessTexture(b,d);return d};
OV.ImporterGltf.prototype.ImportMeshNode=function(a,b,c){function d(h,k,l){var m=h.nodes[k],n=l.GetNodeMatrix(k);if(null!==n)return n;n=(new OV.Matrix).CreateIdentity();if(void 0!==m.matrix)n.Set(m.matrix);else{var q=!1,p=[0,0,0],t=[0,0,0,1],r=[1,1,1];void 0!==m.translation&&(p=m.translation,q=!0);void 0!==m.rotation&&(t=m.rotation,q=!0);void 0!==m.scale&&(r=m.scale,q=!0);q&&n.ComposeTRS(OV.ArrayToCoord3D(p),OV.ArrayToQuaternion(t),OV.ArrayToCoord3D(r))}m=l.GetNodeParent(k);null!==m&&(h=d(h,m,l),
n=n.MultiplyMatrix(h));l.AddNodeMatrix(k,n);return n}var e=a.nodes[b],g=a.meshes[e.mesh],f=new OV.Mesh;this.model.AddMesh(f);void 0!==g.name?f.SetName(g.name):void 0!==e.name&&f.SetName(e.name);for(e=0;e<g.primitives.length;e++)this.ImportPrimitive(a,g.primitives[e],f);a=d(a,b,c);a=new OV.Transformation(a);OV.TransformMesh(f,a)};
OV.ImporterGltf.prototype.ImportPrimitive=function(a,b,c){if(!this.gltfExtensions.ProcessPrimitive(this,a,b,c)&&void 0!==b.attributes){var d=void 0!==b.attributes.POSITION,e=void 0!==b.attributes.NORMAL,g=void 0!==b.attributes.TEXCOORD_0,f=void 0!==b.indices,h=OV.GltfRenderMode.TRIANGLES;void 0!==b.mode&&(h=b.mode);if(h===OV.GltfRenderMode.TRIANGLES||h===OV.GltfRenderMode.TRIANGLE_STRIP||h===OV.GltfRenderMode.TRIANGLE_FAN){var k=c.VertexCount(),l=c.NormalCount(),m=c.TextureUVCount();if(d&&(d=this.GetReaderFromAccessor(a,
a.accessors[b.attributes.POSITION]),null!==d)){d.EnumerateData(function(p){c.AddVertex(p)});if(e){d=this.GetReaderFromAccessor(a,a.accessors[b.attributes.NORMAL]);if(null===d)return;d.EnumerateData(function(p){c.AddNormal(p)})}if(g){d=this.GetReaderFromAccessor(a,a.accessors[b.attributes.TEXCOORD_0]);if(null===d)return;d.EnumerateData(function(p){p.y=-p.y;c.AddTextureUV(p)})}var n=[];if(f){a=this.GetReaderFromAccessor(a,a.accessors[b.indices]);if(null===a)return;a.EnumerateData(function(p){n.push(p)})}else for(a=
0;a<c.VertexCount();a++)n.push(a);if(h===OV.GltfRenderMode.TRIANGLES)for(h=0;h<n.length;h+=3)this.AddTriangle(b,c,n[h],n[h+1],n[h+2],e,g,k,l,m);else if(h===OV.GltfRenderMode.TRIANGLE_STRIP)for(h=0;h<n.length-2;h++){a=n[h];f=n[h+1];d=n[h+2];if(1===h%2){var q=f;f=d;d=q}this.AddTriangle(b,c,a,f,d,e,g,k,l,m)}else if(h===OV.GltfRenderMode.TRIANGLE_FAN)for(h=1;h<n.length-1;h++)this.AddTriangle(b,c,n[0],n[h],n[h+1],e,g,k,l,m)}}}};
OV.ImporterGltf.prototype.AddTriangle=function(a,b,c,d,e,g,f,h,k,l){h=new OV.Triangle(h+c,h+d,h+e);g&&h.SetNormals(k+c,k+d,k+e);f&&h.SetTextureUVs(l+c,l+d,l+e);void 0!==a.material&&(h.mat=a.material);b.AddTriangle(h)};OV.ImporterGltf.prototype.GetReaderFromBufferView=function(a){var b=this.bufferContents[a.buffer||0];if(void 0===b||null===b)return null;b=new OV.GltfBufferReader(b);b.SkipBytes(a.byteOffset||0);a=a.byteStride;void 0!==a&&0!==a&&b.SetByteStride(a);return b};
OV.ImporterGltf.prototype.GetReaderFromAccessor=function(a,b){var c=this.GetReaderFromBufferView(a.bufferViews[b.bufferView||0]);if(null===c)return null;c.SetComponentType(b.componentType);c.SetDataType(b.type);c.SetDataCount(b.count);c.SkipBytes(b.byteOffset||0);if(void 0!==b.sparse){var d=this.GetReaderFromSparseAccessor(a,b.sparse.indices,b.sparse.indices.componentType,"SCALAR",b.sparse.count);a=this.GetReaderFromSparseAccessor(a,b.sparse.values,b.componentType,b.type,b.sparse.count);null!==d&&
null!==a&&c.SetSparseReader(d,a)}return c};OV.ImporterGltf.prototype.GetReaderFromSparseAccessor=function(a,b,c,d,e){if(void 0===b.bufferView)return null;a=this.GetReaderFromBufferView(a.bufferViews[b.bufferView]);if(null===a)return null;a.SetComponentType(c);a.SetDataType(d);a.SetDataCount(e);a.SkipBytes(b.byteOffset||0);return a};OV.ImporterO3dv=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.ImporterO3dv,OV.ImporterBase);OV.ImporterO3dv.prototype.CanImportExtension=function(a){return"o3dv"===a};OV.ImporterO3dv.prototype.GetKnownFileFormats=function(){return{o3dv:OV.FileFormat.Text}};OV.ImporterO3dv.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.ImporterO3dv.prototype.ClearContent=function(){};OV.ImporterO3dv.prototype.ResetContent=function(){};
OV.ImporterO3dv.prototype.ImportContent=function(a,b){a=JSON.parse(a);if(void 0!==a.materials)for(var c=0;c<a.materials.length;c++)this.ImportMaterial(a.materials[c]);if(void 0!==a.meshes)for(c=0;c<a.meshes.length;c++)this.ImportMesh(a.meshes[c]);b()};OV.ImporterO3dv.prototype.ImportMaterial=function(a){var b=new OV.Material(OV.MaterialType.Phong);b.color.Set(255,255,255);void 0!==a.name&&(b.name=a.name);void 0!==a.color&&(b.color=OV.ArrayToColor(a.color));this.model.AddMaterial(b)};
OV.ImporterO3dv.prototype.ImportMesh=function(a){var b=new OV.GeneratorParams;void 0!==a.name&&b.SetName(a.name);void 0!==a.material&&b.SetMaterial(a.material);if(void 0!==a.transformation){var c=new OV.Coord3D(0,0,0),d=new OV.Quaternion(0,0,0,1),e=new OV.Coord3D(1,1,1);void 0!==a.transformation.translation&&(c=OV.ArrayToCoord3D(a.transformation.translation));void 0!==a.transformation.rotation&&(d=OV.ArrayToQuaternion(a.transformation.rotation));void 0!==a.transformation.scale&&(e=OV.ArrayToCoord3D(a.transformation.scale));
b.SetTransformation(c,d,e)}c=a.parameters;void 0!==c&&("cuboid"===a.type?void 0!==c.size_x&&void 0!==c.size_y&&void 0!==c.size_z&&(b=OV.GenerateCuboid(b,c.size_x,c.size_y,c.size_z),this.model.AddMesh(b)):"cylinder"===a.type?void 0!==c.radius&&void 0!==c.height&&(a=OV.ValueOrDefault(c.segments,25),d=OV.ValueOrDefault(c.smooth,!0),b=OV.GenerateCylinder(b,c.radius,c.height,a,d),this.model.AddMesh(b)):"sphere"===a.type&&void 0!==c.radius&&(a=OV.ValueOrDefault(c.segments,20),d=OV.ValueOrDefault(c.smooth,
!0),b=OV.GenerateSphere(b,c.radius,a,d),this.model.AddMesh(b)))};OV.File=function(a,b){this.source=b;b===OV.FileSource.Url?(this.fileUrl=a,this.fileObject=null,this.name=OV.GetFileName(a),this.extension=OV.GetFileExtension(a)):b===OV.FileSource.File&&(this.fileUrl=null,this.fileObject=a,this.name=OV.GetFileName(a.name),this.extension=OV.GetFileExtension(a.name));this.content=this.format=null};OV.File.prototype.SetContent=function(a,b){this.format=a;this.content=b};OV.FileList=function(a){this.files=[];this.importers=a};
OV.FileList.prototype.FillFromFileUrls=function(a){this.Fill(a,OV.FileSource.Url)};OV.FileList.prototype.FillFromFileObjects=function(a){this.Fill(a,OV.FileSource.File)};OV.FileList.prototype.ExtendFromFileList=function(a){for(var b=0;b<a.length;b++){var c=a[b];this.ContainsFileByPath(c.name)||this.files.push(c)}};OV.FileList.prototype.GetFiles=function(){return this.files};
OV.FileList.prototype.GetContent=function(a){var b=this;(new OV.TaskRunner).Run(this.files.length,{runTask:function(c,d){b.GetFileContent(b.files[c],d)},onReady:a})};OV.FileList.prototype.ContainsFileByPath=function(a){return null!==this.FindFileByPath(a)};OV.FileList.prototype.FindFileByPath=function(a){a=OV.GetFileName(a).toLowerCase();for(var b=0;b<this.files.length;b++){var c=this.files[b];if(c.name.toLowerCase()===a)return c}return null};
OV.FileList.prototype.HasMainFile=function(){return null!==this.GetMainFile()};OV.FileList.prototype.GetMainFile=function(){for(var a=0;a<this.files.length;a++){var b=this.files[a],c=this.FindImporter(b);if(null!==c)return{file:b,importer:c}}return null};OV.FileList.prototype.IsOnlySource=function(a){if(0===this.files.length)return!1;for(var b=0;b<this.files.length;b++)if(this.files[b].source!==a)return!1;return!0};
OV.FileList.prototype.Fill=function(a,b){this.files=[];for(var c=0;c<a.length;c++){var d=new OV.File(a[c],b);this.AddFile(d)}};OV.FileList.prototype.AddFile=function(a){this.files.push(a)};OV.FileList.prototype.GetFileContent=function(a,b){if(null!==a.content)b();else{var c=this.GetFileFormat(a),d=null;if(a.source===OV.FileSource.Url)d=OV.RequestUrl(a.fileUrl,c);else if(a.source===OV.FileSource.File)d=OV.ReadFile(a.fileObject,c);else{b();return}d.then(function(e){a.SetContent(c,e)}).catch(function(){}).finally(function(){b()})}};
OV.FileList.prototype.GetFileFormat=function(a){for(var b=0;b<this.importers.length;b++){var c=this.importers[b],d=a.extension.toLowerCase();c=c.GetKnownFileFormats();if(void 0!==c[d])return c[d]}return OV.FileFormat.Binary};OV.FileList.prototype.FindImporter=function(a){for(var b=0;b<this.importers.length;b++){var c=this.importers[b];if(c.CanImportExtension(a.extension.toLowerCase()))return c}return null};OV.ImportSettings=function(){this.defaultColor=new OV.Color(200,200,200)};
OV.ImportErrorCode={NoImportableFile:1,ImportFailed:2,UnknownError:3};OV.ImportError=function(a,b){this.code=a;this.message=b};OV.ImportResult=function(){this.missingFiles=this.usedFiles=this.upVector=this.mainFile=this.model=null};OV.ImportBuffers=function(a){this.getBufferCallback=a;this.fileBuffers={};this.textureBuffers={}};OV.ImportBuffers.prototype.GetFileBuffer=function(a){a=OV.GetFileName(a);var b=this.fileBuffers[a];void 0===b&&(b=this.getBufferCallback(a),this.fileBuffers[a]=b);return b};
OV.ImportBuffers.prototype.GetTextureBuffer=function(a){a=OV.GetFileName(a);var b=this.textureBuffers[a];void 0===b&&(b=this.getBufferCallback(a),b=null!==b?{url:OV.CreateObjectUrl(b),buffer:b}:null,this.textureBuffers[a]=b);return b};
OV.Importer=function(){this.importers=[new OV.ImporterObj,new OV.ImporterStl,new OV.ImporterOff,new OV.ImporterPly,new OV.Importer3ds,new OV.ImporterGltf,new OV.ImporterO3dv,new OV.Importer3dm,new OV.ImporterIfc];this.fileList=new OV.FileList(this.importers);this.model=null;this.usedFiles=[];this.missingFiles=[]};OV.Importer.prototype.AddImporter=function(a){this.importers.push(a)};OV.Importer.prototype.LoadFilesFromUrls=function(a,b){this.LoadFiles(a,OV.FileSource.Url,b)};
OV.Importer.prototype.LoadFilesFromFileObjects=function(a,b){this.LoadFiles(a,OV.FileSource.File,b)};
OV.Importer.prototype.Import=function(a,b){var c=this,d=this.fileList.GetMainFile();if(null===d||null===d.file||null===d.file.content)b.onError(new OV.ImportError(OV.ImportErrorCode.NoImportableFile,null));else{this.RevokeModelUrls();this.model=null;this.usedFiles=[];this.missingFiles=[];this.usedFiles.push(d.file.name);var e=d.importer,g=new OV.ImportBuffers(function(f){var h=c.fileList.FindFileByPath(f);null===h||null===h.content?(c.missingFiles.push(f),h=null):(h=h.content,c.usedFiles.push(f));
return h});e.Import(d.file.content,d.file.extension,{getDefaultMaterial:function(){var f=new OV.Material(OV.MaterialType.Phong);f.color=a.defaultColor;return f},getFileBuffer:function(f){return g.GetFileBuffer(f)},getTextureBuffer:function(f){return g.GetTextureBuffer(f)},onSuccess:function(){c.model=e.GetModel();c.model.SetName(d.file.name);var f=new OV.ImportResult;f.mainFile=d.file.name;f.model=c.model;f.usedFiles=c.usedFiles;f.missingFiles=c.missingFiles;f.upVector=e.GetUpDirection();b.onSuccess(f)},
onError:function(){var f=e.GetMessage();b.onError(new OV.ImportError(OV.ImportErrorCode.ImportFailed,f))},onComplete:function(){e.Clear()}})}};
OV.Importer.prototype.LoadFiles=function(a,b,c){var d=new OV.FileList(this.importers);b===OV.FileSource.Url?d.FillFromFileUrls(a):b===OV.FileSource.File&&d.FillFromFileObjects(a);a=!1;if(d.HasMainFile())a=!0;else{a=!1;for(b=0;b<this.missingFiles.length;b++)d.ContainsFileByPath(this.missingFiles[b])&&(a=!0);a?(a=d.GetFiles(),this.fileList.ExtendFromFileList(a),a=!1):a=!0}a&&(this.fileList=d);this.fileList.GetContent(function(){c()})};OV.Importer.prototype.GetFileList=function(){return this.fileList};
OV.Importer.prototype.IsOnlyFileSource=function(a){return this.fileList.IsOnlySource(a)};OV.Importer.prototype.RevokeModelUrls=function(){if(null!==this.model)for(var a=0;a<this.model.MaterialCount();a++){var b=this.model.GetMaterial(a);OV.EnumerateMaterialTextureMaps(b,function(c){null!==c.url&&OV.RevokeObjectUrl(c.url)})}};OV.Importer3dm=function(){OV.ImporterBase.call(this);this.rhino=null};$jscomp.inherits(OV.Importer3dm,OV.ImporterBase);OV.Importer3dm.prototype.CanImportExtension=function(a){return"3dm"===a};OV.Importer3dm.prototype.GetKnownFileFormats=function(){return{"3dm":OV.FileFormat.Binary}};OV.Importer3dm.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.Importer3dm.prototype.ClearContent=function(){this.instanceDefinitions=this.instanceObjects=null};
OV.Importer3dm.prototype.ResetContent=function(){this.instanceObjects={};this.instanceDefinitions={}};OV.Importer3dm.prototype.ImportContent=function(a,b){var c=this;null===this.rhino?OV.LoadExternalLibrary("rhino3dm.min.js").then(function(){rhino3dm().then(function(d){c.rhino=d;c.ImportRhinoContent(a);b()})}).catch(function(){b()}):(this.ImportRhinoContent(a),b())};
OV.Importer3dm.prototype.ImportRhinoContent=function(a){a=this.rhino.File3dm.fromByteArray(a);null===a?(this.SetError(),this.SetMessage("Failed to read Rhino file.")):(this.ImportRhinoDocument(a),OV.IsModelEmpty(this.model)&&(this.SetError(),this.SetMessage("The model doesn't contain any 3D meshes. Try to save the model while you are in shaded view in Rhino.")))};OV.Importer3dm.prototype.ImportRhinoDocument=function(a){this.InitRhinoInstances(a);this.ImportRhinoUserStrings(a);this.ImportRhinoGeometry(a)};
OV.Importer3dm.prototype.InitRhinoInstances=function(a){for(var b=a.objects(),c=0;c<b.count;c++){var d=b.get(c),e=d.attributes();e.isInstanceDefinitionObject&&(this.instanceObjects[e.id]=d)}a=a.instanceDefinitions();for(b=0;b<a.count();b++)c=a.get(b),this.instanceDefinitions[c.id]=c};OV.Importer3dm.prototype.ImportRhinoUserStrings=function(a){};OV.Importer3dm.prototype.ImportRhinoGeometry=function(a){for(var b=a.objects(),c=0;c<b.count;c++){var d=b.get(c);this.ImportRhinoGeometryObject(a,d,[])}};
OV.Importer3dm.prototype.ImportRhinoGeometryObject=function(a,b,c){var d=b.geometry(),e=b.attributes(),g=d.objectType;if(!e.isInstanceDefinitionObject||0!==c.length){e=null;var f=!1;if(g===this.rhino.ObjectType.Mesh)e=d,f=!1;else if(g===this.rhino.ObjectType.Extrusion)e=d.getMesh(this.rhino.MeshType.Any),f=!0;else if(g===this.rhino.ObjectType.Brep){e=new this.rhino.Mesh;f=d.faces();for(d=0;d<f.count;d++){g=f.get(d);var h=g.getMesh(this.rhino.MeshType.Any);h&&(e.append(h),h.delete());g.delete()}f.delete();
e.compact();f=!0}else if(g===this.rhino.ObjectType.SubD)d.subdivide(3),e=this.rhino.Mesh.createFromSubDControlNet(d),f=!0;else if(g===this.rhino.ObjectType.InstanceReference&&(d=this.instanceDefinitions[d.parentIdefId],void 0!==d))for(d=d.getObjectIds(),g=0;g<d.length;g++)h=this.instanceObjects[d[g]],void 0!==h&&(c.push(b),this.ImportRhinoGeometryObject(a,h,c),c.pop());null!==e&&(this.ImportRhinoMesh(a,e,b,c),f&&e.delete())}};
OV.Importer3dm.prototype.ImportRhinoMesh=function(a,b,c,d){var e=c.attributes(),g=new OV.Mesh;g.SetName(e.name);e=e.getUserStrings();if(0<e.length){for(var f=new OV.PropertyGroup("User texts"),h=0;h<e.length;h++){var k=e[h];f.AddProperty(new OV.Property(OV.PropertyType.Text,k[0],k[1]))}g.AddPropertyGroup(f)}a=this.GetMaterialIndex(a,c,d);e=b.toThreejsJSON();b=e.data.attributes.position.array;for(c=0;c<b.length;c+=3)g.AddVertex(new OV.Coord3D(b[c],b[c+1],b[c+2]));if(b=void 0!==e.data.attributes.normal)for(c=
e.data.attributes.normal.array,f=0;f<c.length;f+=3)g.AddNormal(new OV.Coord3D(c[f],c[f+1],c[f+2]));if(c=void 0!==e.data.attributes.uv)for(f=e.data.attributes.uv.array,h=0;h<f.length;h+=2)g.AddTextureUV(new OV.Coord2D(f[h],f[h+1]));e=e.data.index.array;for(f=0;f<e.length;f+=3){h=e[f];k=e[f+1];var l=e[f+2],m=new OV.Triangle(h,k,l);b&&m.SetNormals(h,k,l);c&&m.SetTextureUVs(h,k,l);null!==a&&m.SetMaterial(a);g.AddTriangle(m)}if(0!==d.length){a=(new OV.Matrix).CreateIdentity();for(b=d.length-1;0<=b;b--)c=
d[b].geometry().xform.toFloatArray(!1),c=new OV.Matrix(c),a=a.MultiplyMatrix(c);d=new OV.Transformation(a);OV.TransformMesh(g,d)}this.model.AddMesh(g)};
OV.Importer3dm.prototype.GetMaterialIndex=function(a,b,c){function d(e,g,f){g=g.attributes();if(g.materialSource===e.ObjectMaterialSource.MaterialFromObject){if(e=g.materialIndex,-1<e)return a.materials().get(e)}else if(g.materialSource===e.ObjectMaterialSource.MaterialFromLayer){if(e=g.layerIndex,-1<e&&(e=a.layers().get(e).renderMaterialIndex,-1<e))return a.materials().get(e)}else if(g.materialSource===e.ObjectMaterialSource.MaterialFromParent&&0!==f.length)return d(e,f[0],[]);return null}b=d(this.rhino,
b,c);return function(e,g){function f(n,q){n.Set(q.r,q.g,q.b)}function h(n){return 0===n.r&&0===n.g&&0===n.b}function k(n){return 255===n.r&&255===n.g&&255===n.b}var l=new OV.Material(OV.MaterialType.Phong);null===g?l.color.Set(255,255,255):(l.name=g.name,f(l.ambient,g.ambientColor),f(l.color,g.diffuseColor),f(l.specular,g.specularColor),l.opacity=1-g.transparency,OV.UpdateMaterialTransparency(l),h(l.color)&&!k(g.reflectionColor)&&f(l.color,g.reflectionColor),h(l.color)&&!k(g.transparentColor)&&f(l.color,
g.transparentColor));for(g=0;g<e.MaterialCount();g++){var m=e.GetMaterial(g);if(m.name===l.name&&OV.ColorIsEqual(m.ambient,l.ambient)&&OV.ColorIsEqual(m.color,l.color)&&OV.ColorIsEqual(m.specular,l.specular)&&OV.IsEqual(m.opacity,l.opacity)&&m.transparent===l.transparent&&OV.IsEqual(m.shininess,l.shininess))return g}return e.AddMaterial(l)}(this.model,b)};OV.ImporterIfc=function(){OV.ImporterBase.call(this);this.ifc=null};$jscomp.inherits(OV.ImporterIfc,OV.ImporterBase);OV.ImporterIfc.prototype.CanImportExtension=function(a){return"ifc"===a};OV.ImporterIfc.prototype.GetKnownFileFormats=function(){return{ifc:OV.FileFormat.Binary}};OV.ImporterIfc.prototype.GetUpDirection=function(){return OV.Direction.Y};OV.ImporterIfc.prototype.ClearContent=function(){this.expressIDToMesh=this.materialNameToIndex=null};
OV.ImporterIfc.prototype.ResetContent=function(){this.materialNameToIndex={};this.expressIDToMesh={}};OV.ImporterIfc.prototype.ImportContent=function(a,b){var c=this;null===this.ifc?OV.LoadExternalLibrary("web-ifc-api.js").then(function(){c.ifc=new IfcAPI;c.ifc.Init().then(function(){c.ImportIfcContent(a);b()})}).catch(function(){b()}):(this.ImportIfcContent(a),b())};
OV.ImporterIfc.prototype.ImportIfcContent=function(a){a=new Uint8Array(a);a=this.ifc.OpenModel(a,{COORDINATE_TO_ORIGIN:!0});for(var b=this.ifc.LoadAllGeometry(a),c=0;c<b.size();c++){var d=b.get(c);this.ImportIfcMesh(a,d)}this.ImportProperties(a);this.ifc.CloseModel(a)};
OV.ImporterIfc.prototype.ImportIfcMesh=function(a,b){var c=new OV.Mesh;c.SetName("Mesh "+b.expressID.toString());for(var d=0,e=b.geometries,g=0;g<e.size();g++){var f=e.get(g),h=this.ifc.GetGeometry(a,f.geometryExpressID),k=this.ifc.GetVertexArray(h.GetVertexData(),h.GetVertexDataSize());h=this.ifc.GetIndexArray(h.GetIndexData(),h.GetIndexDataSize());var l=this.GetMaterialIndexByColor(f.color);f=new OV.Matrix(f.flatTransformation);f=new OV.Transformation(f);for(var m=0;m<k.length;m+=6){var n=new OV.Coord3D(k[m],
k[m+1],k[m+2]);n=f.TransformCoord3D(n);c.AddVertex(n)}for(f=0;f<h.length;f+=3)m=new OV.Triangle(d+h[f],d+h[f+1],d+h[f+2]),m.SetMaterial(l),c.AddTriangle(m);d+=k.length/6}this.expressIDToMesh[b.expressID]=c;this.model.AddMesh(c)};
OV.ImporterIfc.prototype.ImportProperties=function(a){for(var b=this,c=this.ifc.GetLineIDsWithType(a,4186316022),d={},e=0;e<c.size();d={$jscomp$loop$prop$rel$83:d.$jscomp$loop$prop$rel$83},e++){var g=c.get(e);d.$jscomp$loop$prop$rel$83=this.ifc.GetLine(a,g);d.$jscomp$loop$prop$rel$83.RelatedObjects.forEach(function(f){return function(h){var k=b.expressIDToMesh[h.value];if(void 0===k)if(4031249490===b.ifc.GetLine(a,h.value,!0).type)k=b.model;else return;if(!Array.isArray(f.$jscomp$loop$prop$rel$83.RelatingPropertyDefinition)&&
(h=b.ifc.GetLine(a,f.$jscomp$loop$prop$rel$83.RelatingPropertyDefinition.value,!0))&&h.HasProperties){var l=new OV.PropertyGroup(h.Name.value);h.HasProperties.forEach(function(m){if(m&&m.Name&&m.NominalValue){var n=null,q=b.GetIFCString(m.Name.value);switch(m.NominalValue.label){case "IFCTEXT":case "IFCLABEL":case "IFCIDENTIFIER":n=new OV.Property(OV.PropertyType.Text,q,b.GetIFCString(m.NominalValue.value));break;case "IFCBOOLEAN":n=new OV.Property(OV.PropertyType.Boolean,q,"T"===m.NominalValue.value?
!0:!1);break;case "IFCINTEGER":case "IFCCOUNTMEASURE":n=new OV.Property(OV.PropertyType.Integer,q,m.NominalValue.value);break;case "IFCREAL":case "IFCLENGTHMEASURE":case "IFCPOSITIVELENGTHMEASURE":case "IFCAREAMEASURE":case "IFCVOLUMEMEASURE":case "IFCRATIOMEASURE":case "IFCPOSITIVERATIOMEASURE":case "IFCMASSMEASURE":case "IFCMASSPERLENGTHMEASURE":case "IFCPLANEANGLEMEASURE":case "IFCTHERMALTRANSMITTANCEMEASURE":n=new OV.Property(OV.PropertyType.Number,q,m.NominalValue.value);break;default:console.log(m.NominalValue.label)}null!==
n&&l.AddProperty(n)}});0<l.PropertyCount()&&k.AddPropertyGroup(l)}}}(d))}};
OV.ImporterIfc.prototype.GetMaterialIndexByColor=function(a){var b=new OV.Color(parseInt(255*a.x,10),parseInt(255*a.y,10),parseInt(255*a.z,10)),c="Color "+OV.IntegerToHexString(b.r)+OV.IntegerToHexString(b.g)+OV.IntegerToHexString(b.b)+OV.IntegerToHexString(parseInt(255*a.w,10)),d=this.materialNameToIndex[c];void 0===d&&(d=new OV.Material(OV.MaterialType.Phong),d.name=c,d.color=b,d.opacity=a.w,OV.UpdateMaterialTransparency(d),d=this.model.AddMaterial(d),this.materialNameToIndex[c]=d);return d};
OV.ImporterIfc.prototype.GetIFCString=function(a){a=this.DecodeIFCString(a);0===a.length&&(a="-");return a};OV.ImporterIfc.prototype.DecodeIFCString=function(a){for(var b=/\\X2\\(.*?)\\X0\\/uig,c=a,d=b.exec(a);d;){var e=String.fromCharCode(parseInt(d[1],16));c=c.replace(d[0],e);d=b.exec(a)}return c};OV.ExportedFile=function(a){this.name=a;this.content=null};OV.ExportedFile.prototype.GetName=function(){return this.name};OV.ExportedFile.prototype.SetName=function(a){this.name=a};OV.ExportedFile.prototype.GetContent=function(){return this.content};OV.ExportedFile.prototype.SetContent=function(a){this.content=a};OV.ExporterBase=function(){};OV.ExporterBase.prototype.CanExport=function(a,b){return!1};OV.ExporterBase.prototype.Export=function(a,b,c){var d=[];this.ExportContent(a,b,d,function(){c(d)})};
OV.ExporterBase.prototype.ExportContent=function(a,b,c,d){};OV.ExporterBase.prototype.GetExportedMaterialName=function(a){return this.GetExportedName(a,"Material")};OV.ExporterBase.prototype.GetExportedMeshName=function(a){return this.GetExportedName(a,"Mesh")};OV.ExporterBase.prototype.GetExportedName=function(a,b){return 0===a.length?b:a};OV.ExporterObj=function(){OV.ExporterBase.call(this)};$jscomp.inherits(OV.ExporterObj,OV.ExporterBase);OV.ExporterObj.prototype.CanExport=function(a,b){return a===OV.FileFormat.Text&&"obj"===b};
OV.ExporterObj.prototype.ExportContent=function(a,b,c,d){function e(A,E,F,B){if(null!==F&&F.IsValid()){var C=OV.GetFileName(F.name);A.WriteArrayLine([E,C]);-1===B.findIndex(function(G){return G.GetName()===C})&&(A=new OV.ExportedFile(C),A.SetContent(F.buffer),B.push(A))}}var g=new OV.ExportedFile("model.mtl");b=new OV.ExportedFile("model.obj");c.push(g);c.push(b);var f=new OV.TextWriter;f.WriteLine(this.GetHeaderText());for(var h=0;h<a.MaterialCount();h++){var k=a.GetMaterial(h);f.WriteArrayLine(["newmtl",
this.GetExportedMaterialName(k.name)]);f.WriteArrayLine(["Ka",k.ambient.r/255,k.ambient.g/255,k.ambient.b/255]);f.WriteArrayLine(["Kd",k.color.r/255,k.color.g/255,k.color.b/255]);f.WriteArrayLine(["Ks",k.specular.r/255,k.specular.g/255,k.specular.b/255]);f.WriteArrayLine(["Ns",1E3*k.shininess]);f.WriteArrayLine(["d",k.opacity]);e(f,"map_Kd",k.diffuseMap,c);e(f,"map_Ks",k.specularMap,c);e(f,"bump",k.bumpMap,c)}g.SetContent(f.GetText());c=new OV.TextWriter;c.WriteLine(this.GetHeaderText());c.WriteArrayLine(["mtllib",
g.GetName()]);h=f=g=0;k=null;for(var l=0;l<a.MeshCount();l++){var m=a.GetMesh(l);c.WriteArrayLine(["g",this.GetExportedMeshName(m.GetName())]);for(var n=0;n<m.VertexCount();n++){var q=m.GetVertex(n);c.WriteArrayLine(["v",q.x,q.y,q.z])}for(n=0;n<m.NormalCount();n++)q=m.GetNormal(n),c.WriteArrayLine(["vn",q.x,q.y,q.z]);for(n=0;n<m.TextureUVCount();n++)q=m.GetTextureUV(n),c.WriteArrayLine(["vt",q.x,q.y]);for(n=0;n<m.TriangleCount();n++){q=m.GetTriangle(n);var p=q.v0+g+1,t=q.v1+g+1,r=q.v2+g+1,u=q.n0+
f+1,v=q.n1+f+1,w=q.n2+f+1;if(null!==q.mat){var y=a.GetMaterial(q.mat);y=this.GetExportedMaterialName(y.name);y!==k&&(c.WriteArrayLine(["usemtl",y]),k=y)}var x=y="",z="";q.HasTextureUVs()&&(y=q.u0+h+1,x=q.u1+h+1,z=q.u2+h+1);c.WriteArrayLine(["f",[p,y,u].join("/"),[t,x,v].join("/"),[r,z,w].join("/")])}g+=m.VertexCount();f+=m.NormalCount();h+=m.TextureUVCount()}b.SetContent(c.GetText());d()};OV.ExporterObj.prototype.GetHeaderText=function(){return"# exported by https://3dviewer.net"};OV.ExporterStl=function(){OV.ExporterBase.call(this)};$jscomp.inherits(OV.ExporterStl,OV.ExporterBase);OV.ExporterStl.prototype.CanExport=function(a,b){return(a===OV.FileFormat.Text||a===OV.FileFormat.Binary)&&"stl"===b};OV.ExporterStl.prototype.ExportContent=function(a,b,c,d){b===OV.FileFormat.Text?this.ExportText(a,c):this.ExportBinary(a,c);d()};
OV.ExporterStl.prototype.ExportText=function(a,b){var c=new OV.ExportedFile("model.stl");b.push(c);var d=new OV.TextWriter;d.WriteLine("solid Model");OV.EnumerateTrianglesWithNormals(a,function(e,g,f,h){d.WriteArrayLine(["facet","normal",h.x,h.y,h.z]);d.Indent(1);d.WriteLine("outer loop");d.Indent(1);d.WriteArrayLine(["vertex",e.x,e.y,e.z]);d.WriteArrayLine(["vertex",g.x,g.y,g.z]);d.WriteArrayLine(["vertex",f.x,f.y,f.z]);d.Indent(-1);d.WriteLine("endloop");d.Indent(-1);d.WriteLine("endfacet")});d.WriteLine("endsolid Model");
c.SetContent(d.GetText())};
OV.ExporterStl.prototype.ExportBinary=function(a,b){var c=new OV.ExportedFile("model.stl");b.push(c);b=a.TriangleCount();for(var d=new OV.BinaryWriter(84+50*b,!0),e=0;80>e;e++)d.WriteUnsignedCharacter8(0);d.WriteUnsignedInteger32(b);OV.EnumerateTrianglesWithNormals(a,function(g,f,h,k){d.WriteFloat32(k.x);d.WriteFloat32(k.y);d.WriteFloat32(k.z);d.WriteFloat32(g.x);d.WriteFloat32(g.y);d.WriteFloat32(g.z);d.WriteFloat32(f.x);d.WriteFloat32(f.y);d.WriteFloat32(f.z);d.WriteFloat32(h.x);d.WriteFloat32(h.y);
d.WriteFloat32(h.z);d.WriteUnsignedInteger16(0)});c.SetContent(d.GetBuffer())};OV.ExporterPly=function(){OV.ExporterBase.call(this)};$jscomp.inherits(OV.ExporterPly,OV.ExporterBase);OV.ExporterPly.prototype.CanExport=function(a,b){return(a===OV.FileFormat.Text||a===OV.FileFormat.Binary)&&"ply"===b};OV.ExporterPly.prototype.ExportContent=function(a,b,c,d){b===OV.FileFormat.Text?this.ExportText(a,c):this.ExportBinary(a,c);d()};
OV.ExporterPly.prototype.ExportText=function(a,b){var c=new OV.ExportedFile("model.ply");b.push(c);var d=new OV.TextWriter;b=a.VertexCount();var e=a.TriangleCount();b=this.GetHeaderText("ascii",b,e);d.Write(b);OV.EnumerateModelVerticesAndTriangles(a,{onVertex:function(g,f,h){d.WriteArrayLine([g,f,h])},onTriangle:function(g,f,h){d.WriteArrayLine([3,g,f,h])}});c.SetContent(d.GetText())};
OV.ExporterPly.prototype.ExportBinary=function(a,b){var c=new OV.ExportedFile("model.ply");b.push(c);var d=a.VertexCount(),e=a.TriangleCount();b=this.GetHeaderText("binary_little_endian",d,e);var g=new OV.BinaryWriter(b.length+12*d+13*e,!0);for(d=0;d<b.length;d++)g.WriteUnsignedCharacter8(b.charCodeAt(d));OV.EnumerateModelVerticesAndTriangles(a,{onVertex:function(f,h,k){g.WriteFloat32(f);g.WriteFloat32(h);g.WriteFloat32(k)},onTriangle:function(f,h,k){g.WriteUnsignedCharacter8(3);g.WriteInteger32(f);
g.WriteInteger32(h);g.WriteInteger32(k)}});c.SetContent(g.GetBuffer())};OV.ExporterPly.prototype.GetHeaderText=function(a,b,c){var d=new OV.TextWriter;d.WriteLine("ply");d.WriteLine("format "+a+" 1.0");d.WriteLine("element vertex "+b);d.WriteLine("property float x");d.WriteLine("property float y");d.WriteLine("property float z");d.WriteLine("element face "+c);d.WriteLine("property list uchar int vertex_index");d.WriteLine("end_header");return d.GetText()};OV.ExporterOff=function(){OV.ExporterBase.call(this)};$jscomp.inherits(OV.ExporterOff,OV.ExporterBase);OV.ExporterOff.prototype.CanExport=function(a,b){return a===OV.FileFormat.Text&&"off"===b};
OV.ExporterOff.prototype.ExportContent=function(a,b,c,d){b=new OV.ExportedFile("model.off");c.push(b);var e=new OV.TextWriter;e.WriteLine("OFF");e.WriteArrayLine([a.VertexCount(),a.TriangleCount(),0]);OV.EnumerateModelVerticesAndTriangles(a,{onVertex:function(g,f,h){e.WriteArrayLine([g,f,h])},onTriangle:function(g,f,h){e.WriteArrayLine([3,g,f,h])}});b.SetContent(e.GetText());d()};OV.ExporterGltf=function(){OV.ExporterBase.call(this);this.components={index:{type:5125,size:4},number:{type:5126,size:4}}};$jscomp.inherits(OV.ExporterGltf,OV.ExporterBase);OV.ExporterGltf.prototype.CanExport=function(a,b){return a===OV.FileFormat.Text&&"gltf"===b||a===OV.FileFormat.Binary&&"glb"===b};OV.ExporterGltf.prototype.ExportContent=function(a,b,c,d){b===OV.FileFormat.Text?this.ExportAsciiContent(a,c):b===OV.FileFormat.Binary&&this.ExportBinaryContent(a,c);d()};
OV.ExporterGltf.prototype.ExportAsciiContent=function(a,b){var c=new OV.ExportedFile("model.gltf"),d=new OV.ExportedFile("model.bin");b.push(c);b.push(d);var e=this.GetMeshData(a),g=this.GetMainBuffer(e),f=this.GetMainJson(e);f.buffers.push({uri:d.GetName(),byteLength:g.byteLength});var h=[];this.ExportMaterials(a,f,function(k){var l=OV.GetFileName(k.name),m=h[l];void 0===m&&(m=new OV.ExportedFile(l),m.SetContent(k.buffer),b.push(m),m=f.textures.length,h[l]=m,f.images.push({uri:l}),f.textures.push({source:m}));
return m});c.SetContent(JSON.stringify(f,null,4));d.SetContent(g)};
OV.ExporterGltf.prototype.ExportBinaryContent=function(a,b){function c(r){var u=r%4;return 0===u?r:r+(4-u)}function d(r,u,v){for(var w=0;w<v;w++)r.WriteUnsignedCharacter8(u)}var e=new OV.ExportedFile("model.glb");b.push(e);var g=this.GetMeshData(a);b=this.GetMainBuffer(g);var f=this.GetMainJson(g),h=[],k=b.byteLength,l=[];this.ExportMaterials(a,f,function(r){var u=OV.GetFileName(r.name),v=OV.GetFileExtension(r.name),w=l[u];if(void 0===w){var y=f.bufferViews.length;w=f.textures.length;l[u]=w;r=r.buffer;
h.push(r);f.bufferViews.push({buffer:0,byteOffset:k,byteLength:r.byteLength});k+=r.byteLength;f.images.push({bufferView:y,mimeType:"image/"+v});f.textures.push({source:w})}return w});a=b.byteLength;for(g=0;g<h.length;g++)a+=h[g].byteLength;g=c(a);f.buffers.push({byteLength:g});var m=JSON.stringify(f),n=OV.Utf8StringToArrayBuffer(m),q=n.byteLength,p=c(q),t=20+p+8+g;m=new OV.BinaryWriter(t,!0);m.WriteUnsignedInteger32(1179937895);m.WriteUnsignedInteger32(2);m.WriteUnsignedInteger32(t);m.WriteUnsignedInteger32(p);
m.WriteUnsignedInteger32(1313821514);m.WriteArrayBuffer(n);d(m,32,p-q);m.WriteUnsignedInteger32(g);m.WriteUnsignedInteger32(5130562);m.WriteArrayBuffer(b);for(b=0;b<h.length;b++)m.WriteArrayBuffer(h[b]);d(m,0,g-a);e.SetContent(m.GetBuffer())};OV.ExporterGltf.prototype.GetMeshData=function(a){for(var b=[],c=0;c<a.MeshCount();c++){var d=a.GetMesh(c),e=OV.ConvertMeshToMeshBuffer(d);b.push({name:d.GetName(),buffer:e,offsets:[],sizes:[]})}return b};
OV.ExporterGltf.prototype.GetMainBuffer=function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c].buffer.GetByteLength(this.components.index.size,this.components.number.size);b=new OV.BinaryWriter(b,!0);for(c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.buffer.PrimitiveCount();e++){for(var g=d.buffer.GetPrimitive(e),f=b.GetPosition(),h=0;h<g.indices.length;h++)b.WriteUnsignedInteger32(g.indices[h]);for(h=0;h<g.vertices.length;h++)b.WriteFloat32(g.vertices[h]);for(h=0;h<g.normals.length;h++)b.WriteFloat32(g.normals[h]);
for(h=0;h<g.uvs.length;h++){var k=g.uvs[h];1===h%2&&(k*=-1);b.WriteFloat32(k)}d.offsets.push(f);d.sizes.push(b.GetPosition()-f)}return b.GetBuffer()};
OV.ExporterGltf.prototype.GetMainJson=function(a){var b=function(t,r){this.mainJson=t;this.byteOffset=r};b.prototype.AddBufferView=function(t){this.mainJson.bufferViews.push({buffer:0,byteOffset:this.byteOffset,byteLength:t});this.byteOffset+=t};for(var c={asset:{version:"2.0",generator:"https://3dviewer.net"},scene:0,scenes:[{nodes:[]}],nodes:[],materials:[],meshes:[],buffers:[],bufferViews:[],accessors:[]},d=0;d<a.length;d++){var e=a[d];c.scenes[0].nodes.push(d);c.nodes.push({mesh:d});for(var g=
{name:this.GetExportedMeshName(e.name),primitives:[]},f=e.buffer.primitives,h=0;h<f.length;h++){var k=f[h],l=c.bufferViews.length,m=new b(c,e.offsets[h]);m.AddBufferView(k.indices.length*this.components.index.size);m.AddBufferView(k.vertices.length*this.components.number.size);m.AddBufferView(k.normals.length*this.components.number.size);var n=c.accessors.length,q={attributes:{POSITION:n+1,NORMAL:n+2},indices:n,mode:4,material:k.material},p=k.GetBounds();c.accessors.push({bufferView:l,byteOffset:0,
componentType:this.components.index.type,count:k.indices.length,type:"SCALAR"});c.accessors.push({bufferView:l+1,byteOffset:0,componentType:this.components.number.type,count:k.vertices.length/3,min:p.min,max:p.max,type:"VEC3"});c.accessors.push({bufferView:l+2,byteOffset:0,componentType:this.components.number.type,count:k.normals.length/3,type:"VEC3"});0<k.uvs.length&&(m.AddBufferView(k.uvs.length*this.components.number.size),c.accessors.push({bufferView:l+3,byteOffset:0,componentType:this.components.number.type,
count:k.uvs.length/2,type:"VEC2"}),q.attributes.TEXCOORD_0=n+3);g.primitives.push(q)}c.meshes.push(g)}return c};
OV.ExporterGltf.prototype.ExportMaterials=function(a,b,c){function d(f,h,k,l){function m(p,t){return[OV.SRGBToLinear(p.r/255),OV.SRGBToLinear(p.g/255),OV.SRGBToLinear(p.b/255),t]}function n(p,t,r){if(null===t||!t.IsValid())return null;void 0===p.images&&(p.images=[]);void 0===p.textures&&(p.textures=[]);r={index:r(t)};t.HasTransformation()&&(void 0===p.extensionsUsed&&(p.extensionsUsed=[]),-1===p.extensionsUsed.indexOf("KHR_texture_transform")&&p.extensionsUsed.push("KHR_texture_transform"),r.extensions=
{KHR_texture_transform:{offset:[t.offset.x,-t.offset.y],scale:[t.scale.x,t.scale.y],rotation:-t.rotation}});return r}f={name:f.GetExportedMaterialName(k.name),pbrMetallicRoughness:{baseColorFactor:m(k.color,k.opacity)},emissiveFactor:function(p){return[OV.SRGBToLinear(p.r/255),OV.SRGBToLinear(p.g/255),OV.SRGBToLinear(p.b/255)]}(k.emissive),doubleSided:!0,alphaMode:"OPAQUE"};k.transparent&&(f.alphaMode="BLEND");var q=n(h,k.diffuseMap,l);null!==q&&(k.multiplyDiffuseMap||(f.pbrMetallicRoughness.baseColorFactor=
m(new OV.Color(255,255,255),k.opacity)),f.pbrMetallicRoughness.baseColorTexture=q);q=n(h,k.metalnessMap,l);null!==q?f.pbrMetallicRoughness.metallicRoughnessTexture=q:(f.pbrMetallicRoughness.metallicFactor=k.metalness,f.pbrMetallicRoughness.roughnessFactor=k.roughness);q=n(h,k.normalMap,l);null!==q&&(f.normalTexture=q);k=n(h,k.emissiveMap,l);null!==k&&(f.emissiveTexture=k);h.materials.push(f)}for(var e=0;e<a.MaterialCount();e++){var g=a.GetMaterial(e);d(this,b,g,c)}};OV.Exporter3dm=function(){OV.ExporterBase.call(this);this.rhino=null};$jscomp.inherits(OV.Exporter3dm,OV.ExporterBase);OV.Exporter3dm.prototype.CanExport=function(a,b){return a===OV.FileFormat.Binary&&"3dm"===b};OV.Exporter3dm.prototype.ExportContent=function(a,b,c,d){var e=this;null===this.rhino?OV.LoadExternalLibrary("rhino3dm.min.js").then(function(){rhino3dm().then(function(g){e.rhino=g;e.ExportRhinoContent(a,c,d)})}).catch(function(){d()}):this.ExportRhinoContent(a,c,d)};
OV.Exporter3dm.prototype.ExportRhinoContent=function(a,b,c){function d(q){return{r:q.r,g:q.g,b:q.b,a:255}}var e=new OV.ExportedFile("model.3dm");b.push(e);b=new this.rhino.File3dm;for(var g=0;g<a.MeshCount();g++)for(var f=a.GetMesh(g),h=OV.ConvertMeshToMeshBuffer(f),k=0;k<h.PrimitiveCount();k++){var l=h.GetPrimitive(k),m={data:{attributes:{position:{itemSize:3,type:"Float32Array",array:l.vertices},normal:{itemSize:3,type:"Float32Array",array:l.normals}},index:{type:"Uint16Array",array:l.indices}}};
l=a.GetMaterial(l.material);var n=new this.rhino.Material;n.name=this.GetExportedMaterialName(l.name);n.ambientColor=d(l.ambient);n.diffuseColor=d(l.color);n.specularColor=d(l.specular);n.transparency=1-l.opacity;l=b.materials().count();b.materials().add(n);m=new this.rhino.Mesh.createFromThreejsJSON(m);n=new this.rhino.ObjectAttributes;n.name=this.GetExportedMeshName(f.GetName());n.materialSource=this.rhino.ObjectMaterialSource.MaterialFromObject;n.materialIndex=l;b.objects().add(m,n)}a=new this.rhino.File3dmWriteOptions;
a.version=6;a=b.toByteArray(a);e.SetContent(a);c()};OV.Exporter=function(){this.exporters=[new OV.ExporterObj,new OV.ExporterStl,new OV.ExporterPly,new OV.ExporterOff,new OV.ExporterGltf]};OV.Exporter.prototype.AddExporter=function(a){this.exporters.push(a)};OV.Exporter.prototype.Export=function(a,b,c,d){for(var e=null,g=0;g<this.exporters.length;g++){var f=this.exporters[g];if(f.CanExport(b,c)){e=f;break}}if(null===e)d.onError();else e.Export(a,b,function(h){if(0===h.length)d.onError();else d.onSuccess(h)})};OV.HasHighpDriverIssue=function(){var a=document.createElement("canvas");document.body.appendChild(a);var b=new THREE.WebGLRenderer({canvas:a,antialias:!0});b.setClearColor("#ffffff",1);b.setSize(10,10);var c=new THREE.Scene,d=new THREE.AmbientLight(8947848);c.add(d);d=new THREE.DirectionalLight(8947848);d.position.set(0,0,1);c.add(d);d=new THREE.PerspectiveCamera(45,1,.1,1E3);d.position.set(0,0,1);d.up.set(0,1,0);d.lookAt(new THREE.Vector3(0,0,0));c.add(d);var e=new THREE.PlaneGeometry(1,1);e=new THREE.Mesh(e,
new THREE.MeshPhongMaterial({color:13369344}));c.add(e);b.render(c,d);b=b.getContext();c=new Uint8Array(4);b.readPixels(5,5,1,1,b.RGBA,b.UNSIGNED_BYTE,c);document.body.removeChild(a);return 50>c[0]&&50>c[1]&&50>c[2]?!0:!1};OV.ModelToThreeConversionParams=function(){this.forceMediumpForMaterials=!1};OV.ModelToThreeConversionOutput=function(){this.defaultMaterial=null};
OV.ConvertModelToThreeMeshes=function(a,b,c,d){function e(m,n,q,p){function t(v,w,y){null!==w&&w.IsValid()&&(new THREE.TextureLoader).load(w.url,function(x){x.wrapS=THREE.RepeatWrapping;x.wrapT=THREE.RepeatWrapping;x.rotation=w.rotation;x.offset.x=w.offset.x;x.offset.y=w.offset.y;x.repeat.x=w.scale.x;x.repeat.y=w.scale.y;v.needsUpdate=!0;y(x)})}var r=m.GetMaterial(n);m=new THREE.Color(r.color.r/255,r.color.g/255,r.color.b/255);n=new THREE.Color(r.emissive.r/255,r.emissive.g/255,r.emissive.b/255);
m={color:m,emissive:n,opacity:r.opacity,transparent:r.transparent,alphaTest:r.alphaTest,side:THREE.DoubleSide};q.forceMediumpForMaterials&&(m.precision="mediump");var u=null;r.type===OV.MaterialType.Phong?(u=new THREE.MeshPhongMaterial(m),q=new THREE.Color(r.specular.r/255,r.specular.g/255,r.specular.b/255),OV.IsEqual(r.shininess,0)&&q.setRGB(0,0,0),u.specular=q,u.shininess=100*r.shininess,t(u,r.specularMap,function(v){u.specularMap=v;d.onTextureLoaded()})):r.type===OV.MaterialType.Physical&&(u=new THREE.MeshStandardMaterial(m),
u.metalness=r.metalness,u.roughness=r.roughness,t(u,r.metalnessMap,function(v){u.metalness=1;u.roughness=1;u.metalnessMap=v;u.roughnessMap=v;d.onTextureLoaded()}));t(u,r.diffuseMap,function(v){r.multiplyDiffuseMap||u.color.setRGB(1,1,1);u.map=v;d.onTextureLoaded()});t(u,r.bumpMap,function(v){u.bumpMap=v;d.onTextureLoaded()});t(u,r.normalMap,function(v){u.normalMap=v;d.onTextureLoaded()});t(u,r.emissiveMap,function(v){u.emissiveMap=v;d.onTextureLoaded()});r.isDefault&&(p.defaultMaterial=u);return u}
function g(m,n,q){var p=m.GetMesh(n),t=p.TriangleCount();if(0===t)return null;var r=[];for(m=0;m<t;m++)r.push(m);r.sort(function(H,I){H=p.GetTriangle(H);I=p.GetTriangle(I);return H.mat-I.mat});var u=new THREE.BufferGeometry,v=[];m=[];var w={},y=[],x=[],z=[],A=[];A.push({start:0,end:-1});for(var E=0<p.TextureUVCount(),F=0;F<r.length;F++){var B=p.GetTriangle(r[F]),C=p.GetVertex(B.v0),G=p.GetVertex(B.v1),D=p.GetVertex(B.v2);y.push(C.x,C.y,C.z,G.x,G.y,G.z,D.x,D.y,D.z);C=p.GetNormal(B.n0);G=p.GetNormal(B.n1);
D=p.GetNormal(B.n2);x.push(C.x,C.y,C.z,G.x,G.y,G.z,D.x,D.y,D.z);B.HasTextureUVs()?(C=p.GetTextureUV(B.u0),G=p.GetTextureUV(B.u1),D=p.GetTextureUV(B.u2),z.push(C.x,C.y,G.x,G.y,D.x,D.y)):E&&z.push(0,0,0,0,0,0);B=B.mat;C=w[B];void 0===C&&(C=v.length,w[B]=C,v.push(q[B]),m.push(B),0<F&&(A[A.length-1].end=F-1,A.push({start:A[A.length-1].end+1,end:-1})))}A[A.length-1].end=t-1;u.setAttribute("position",new THREE.Float32BufferAttribute(y,3));u.setAttribute("normal",new THREE.Float32BufferAttribute(x,3));0!==
z.length&&u.setAttribute("uv",new THREE.Float32BufferAttribute(z,2));for(q=0;q<A.length;q++)t=A[q],u.addGroup(3*t.start,3*(t.end-t.start+1),q);q=new THREE.Mesh(u,v);q.userData={originalMeshIndex:n,originalMaterials:m,threeMaterials:null};return q}for(var f=[],h=0;h<a.MaterialCount();h++){var k=e(a,h,b,c);f.push(k)}var l=[];(new OV.TaskRunner).RunBatch(a.MeshCount(),100,{runTask:function(m,n,q){for(;m<=n;m++)if(0<a.GetMesh(m).TriangleCount()){var p=g(a,m,f);l.push(p)}q()},onReady:function(){d.onModelLoaded(l)}})};OV.ThreeModelLoader=function(){this.importer=new OV.Importer;this.callbacks=null;this.inProgress=!1;this.defaultMaterial=null;this.hasHighpDriverIssue=OV.HasHighpDriverIssue()};OV.ThreeModelLoader.prototype.Init=function(a){this.callbacks=a};OV.ThreeModelLoader.prototype.LoadFromUrlList=function(a,b){var c=this;this.inProgress||(this.inProgress=!0,this.callbacks.onLoadStart(),this.importer.LoadFilesFromUrls(a,function(){c.OnFilesLoaded(b)}))};
OV.ThreeModelLoader.prototype.LoadFromFileList=function(a,b){var c=this;this.inProgress||(this.inProgress=!0,this.callbacks.onLoadStart(),this.importer.LoadFilesFromFileObjects(a,function(){c.OnFilesLoaded(b)}))};OV.ThreeModelLoader.prototype.OnFilesLoaded=function(a){var b=this;this.callbacks.onImportStart();OV.RunTaskAsync(function(){b.importer.Import(a,{onSuccess:function(c){b.OnModelImported(c)},onError:function(c){b.callbacks.onLoadError(c);b.inProgress=!1}})})};
OV.ThreeModelLoader.prototype.OnModelImported=function(a){var b=this;this.callbacks.onVisualizationStart();var c=new OV.ModelToThreeConversionParams;c.forceMediumpForMaterials=this.hasHighpDriverIssue;var d=new OV.ModelToThreeConversionOutput;OV.ConvertModelToThreeMeshes(a.model,c,d,{onTextureLoaded:function(){b.callbacks.onTextureLoaded()},onModelLoaded:function(e){b.defaultMaterial=d.defaultMaterial;b.callbacks.onModelFinished(a,e);b.inProgress=!1}})};OV.ThreeModelLoader.prototype.GetImporter=function(){return this.importer};
OV.ThreeModelLoader.prototype.ReplaceDefaultMaterialColor=function(a){null!==this.defaultMaterial&&(this.defaultMaterial.color=new THREE.Color(a.r/255,a.g/255,a.b/255))};OV.ParameterConverter={IntegerToString:function(a){return a.toString()},StringToInteger:function(a){return parseInt(a,10)},NumberToString:function(a){return a.toPrecision(5)},StringToNumber:function(a){return parseFloat(a)},ModelUrlsToString:function(a){return null===a?null:a.join(",")},StringToModelUrls:function(a){return null===a||0===a.length?null:a.split(",")},CameraToString:function(a){return null===a?null:[this.NumberToString(a.eye.x),this.NumberToString(a.eye.y),this.NumberToString(a.eye.z),
this.NumberToString(a.center.x),this.NumberToString(a.center.y),this.NumberToString(a.center.z),this.NumberToString(a.up.x),this.NumberToString(a.up.y),this.NumberToString(a.up.z)].join()},StringToCamera:function(a){if(null===a||0===a.length)return null;a=a.split(",");return 9!==a.length?null:new OV.Camera(new OV.Coord3D(this.StringToNumber(a[0]),this.StringToNumber(a[1]),this.StringToNumber(a[2])),new OV.Coord3D(this.StringToNumber(a[3]),this.StringToNumber(a[4]),this.StringToNumber(a[5])),new OV.Coord3D(this.StringToNumber(a[6]),
this.StringToNumber(a[7]),this.StringToNumber(a[8])))},ColorToString:function(a){return null===a?null:[this.IntegerToString(a.r),this.IntegerToString(a.g),this.IntegerToString(a.b)].join()},StringToColor:function(a){if(null===a||0===a.length)return null;a=a.split(",");return 3!==a.length?null:new OV.Color(this.StringToInteger(a[0]),this.StringToInteger(a[1]),this.StringToInteger(a[2]))}};OV.ParameterListBuilder=function(a){this.separator=a;this.paramList=""};
OV.ParameterListBuilder.prototype.AddModelUrls=function(a){this.AddUrlPart("model",OV.ParameterConverter.ModelUrlsToString(a));return this};OV.ParameterListBuilder.prototype.AddCamera=function(a){this.AddUrlPart("camera",OV.ParameterConverter.CameraToString(a));return this};OV.ParameterListBuilder.prototype.AddBackground=function(a){this.AddUrlPart("backgroundcolor",OV.ParameterConverter.ColorToString(a));return this};
OV.ParameterListBuilder.prototype.AddColor=function(a){this.AddUrlPart("defaultcolor",OV.ParameterConverter.ColorToString(a));return this};OV.ParameterListBuilder.prototype.AddUrlPart=function(a,b){null!==a&&null!==b&&(0<this.paramList.length&&(this.paramList+=this.separator),this.paramList+=a+"="+b)};OV.ParameterListBuilder.prototype.GetParameterList=function(){return this.paramList};OV.ParameterListParser=function(a,b){this.separator=b;this.paramList=a};
OV.ParameterListParser.prototype.GetModelUrls=function(){if(-1===this.paramList.indexOf("="))return this.paramList.split(",");var a=this.GetKeywordParams("model");return OV.ParameterConverter.StringToModelUrls(a)};OV.ParameterListParser.prototype.GetCamera=function(){var a=this.GetKeywordParams("camera");return OV.ParameterConverter.StringToCamera(a)};OV.ParameterListParser.prototype.GetBackgroundColor=function(){var a=this.GetKeywordParams("backgroundcolor");return OV.ParameterConverter.StringToColor(a)};
OV.ParameterListParser.prototype.GetDefaultColor=function(){var a=this.GetKeywordParams("defaultcolor");return OV.ParameterConverter.StringToColor(a)};OV.ParameterListParser.prototype.GetKeywordParams=function(a){if(null===this.paramList||0===this.paramList.length)return null;a+="=";for(var b=this.paramList.split(this.separator),c=0;c<b.length;c++){var d=b[c];if(d.startsWith(a))return d.substr(a.length)}return null};OV.CreateUrlBuilder=function(){return new OV.ParameterListBuilder("$")};
OV.CreateUrlParser=function(a){return new OV.ParameterListParser(a,"$")};OV.CreateModelUrlParameters=function(a){var b=OV.CreateUrlBuilder();b.AddModelUrls(a);return b.GetParameterList()};OV.GetInnerDimensions=function(a,b,c){function d(e){return Math.round(parseFloat(e))}a=getComputedStyle(a);b=b-d(a.borderLeftWidth)-d(a.borderRightWidth)-d(a.marginLeft)-d(a.marginRight)-d(a.paddingLeft)-d(a.paddingRight);c=c-d(a.borderTopWidth)-d(a.borderBottomWidth)-d(a.marginTop)-d(a.marginBottom)-d(a.paddingTop)-d(a.paddingBottom);return{width:b,height:c}};OV.GetClientCoordinates=function(a,b,c){a.getBoundingClientRect&&(a=a.getBoundingClientRect(),b-=a.left,c-=a.top);window.pageXOffset&&window.pageYOffset&&(b+=window.pageXOffset,c+=window.pageYOffset);return new OV.Coord2D(b,c)};OV.Camera=function(a,b,c){this.eye=a;this.center=b;this.up=c};OV.Camera.prototype.Clone=function(){return new OV.Camera(this.eye.Clone(),this.center.Clone(),this.up.Clone())};
OV.MouseInteraction=function(){this.prev=new OV.Coord2D(0,0);this.curr=new OV.Coord2D(0,0);this.diff=new OV.Coord2D(0,0);this.buttons=[]};OV.MouseInteraction.prototype.Down=function(a,b){this.buttons.push(b.which);this.curr=this.GetCurrent(a,b);this.prev=this.curr.Clone()};OV.MouseInteraction.prototype.Move=function(a,b){this.curr=this.GetCurrent(a,b);this.diff=OV.SubCoord2D(this.curr,this.prev);this.prev=this.curr.Clone()};
OV.MouseInteraction.prototype.Up=function(a,b){var c=this.buttons.indexOf(b.which);-1!==c&&this.buttons.splice(c,1);this.curr=this.GetCurrent(a,b)};OV.MouseInteraction.prototype.Leave=function(a,b){this.buttons=[];this.curr=this.GetCurrent(a,b)};OV.MouseInteraction.prototype.IsButtonDown=function(){return 0<this.buttons.length};OV.MouseInteraction.prototype.GetButton=function(){var a=this.buttons.length;return 0===a?0:this.buttons[a-1]};OV.MouseInteraction.prototype.GetMoveDiff=function(){return this.diff};
OV.MouseInteraction.prototype.GetCurrent=function(a,b){return OV.GetClientCoordinates(a,b.clientX,b.clientY)};OV.TouchInteraction=function(){this.prevPos=new OV.Coord2D(0,0);this.currPos=new OV.Coord2D(0,0);this.diffPos=new OV.Coord2D(0,0);this.fingers=this.diffDist=this.currDist=this.prevDist=0};
OV.TouchInteraction.prototype.Start=function(a,b){0!==b.touches.length&&(this.fingers=b.touches.length,this.currPos=this.GetCurrent(a,b),this.prevPos=this.currPos.Clone(),this.prevDist=this.currDist=this.GetTouchDistance(a,b))};
OV.TouchInteraction.prototype.Move=function(a,b){0!==b.touches.length&&(this.currPos=this.GetCurrent(a,b),this.diffPos=OV.SubCoord2D(this.currPos,this.prevPos),this.prevPos=this.currPos.Clone(),this.currDist=this.GetTouchDistance(a,b),this.diffDist=this.currDist-this.prevDist,this.prevDist=this.currDist)};OV.TouchInteraction.prototype.End=function(a,b){0!==b.touches.length&&(this.fingers=0,this.currPos=this.GetCurrent(a,b),this.currDist=this.GetTouchDistance(a,b))};
OV.TouchInteraction.prototype.IsFingerDown=function(){return 0!==this.fingers};OV.TouchInteraction.prototype.GetFingerCount=function(){return this.fingers};OV.TouchInteraction.prototype.GetMoveDiff=function(){return this.diffPos};OV.TouchInteraction.prototype.GetDistanceDiff=function(){return this.diffDist};OV.TouchInteraction.prototype.GetCurrent=function(a,b){var c=null;0!==b.touches.length&&(b=b.touches[0],c=OV.GetClientCoordinates(a,b.pageX,b.pageY));return c};
OV.TouchInteraction.prototype.GetTouchDistance=function(a,b){if(2!==b.touches.length)return 0;var c=b.touches[0];b=b.touches[1];return OV.CoordDistance2D(OV.GetClientCoordinates(a,c.pageX,c.pageY),OV.GetClientCoordinates(a,b.pageX,b.pageY))};OV.ClickDetector=function(){this.isClick=!1;this.button=0};OV.ClickDetector.prototype.Down=function(a){this.isClick=!0;this.button=a.which};OV.ClickDetector.prototype.Move=function(){this.isClick=!1};
OV.ClickDetector.prototype.Up=function(a){this.isClick&&a.which!==this.button&&(this.isClick=!1)};OV.ClickDetector.prototype.Leave=function(){this.isClick=!1;this.button=0};OV.ClickDetector.prototype.IsClick=function(){return this.isClick};
OV.Navigation=function(a,b){this.canvas=a;this.camera=b;this.orbitCenter=this.camera.center.Clone();this.fixUpVector=!0;this.mouse=new OV.MouseInteraction;this.touch=new OV.TouchInteraction;this.clickDetector=new OV.ClickDetector;this.onContext=this.onClick=this.onUpdate=null;this.canvas.addEventListener&&(this.canvas.addEventListener("mousedown",this.OnMouseDown.bind(this)),this.canvas.addEventListener("wheel",this.OnMouseWheel.bind(this)),this.canvas.addEventListener("touchstart",this.OnTouchStart.bind(this)),
this.canvas.addEventListener("touchmove",this.OnTouchMove.bind(this)),this.canvas.addEventListener("touchend",this.OnTouchEnd.bind(this)),this.canvas.addEventListener("contextmenu",this.OnContextMenu.bind(this)));document.addEventListener&&(document.addEventListener("mousemove",this.OnMouseMove.bind(this)),document.addEventListener("mouseup",this.OnMouseUp.bind(this)),document.addEventListener("mouseleave",this.OnMouseLeave.bind(this)))};
OV.Navigation.prototype.SetUpdateHandler=function(a){this.onUpdate=a};OV.Navigation.prototype.SetClickHandler=function(a){this.onClick=a};OV.Navigation.prototype.SetContextMenuHandler=function(a){this.onContext=a};OV.Navigation.prototype.IsFixUpVector=function(){return this.fixUpVector};OV.Navigation.prototype.SetFixUpVector=function(a){this.fixUpVector=a};OV.Navigation.prototype.GetCamera=function(){return this.camera};OV.Navigation.prototype.SetCamera=function(a){this.camera=a};
OV.Navigation.prototype.MoveCamera=function(a,b){function c(f,h,k,l){f.camera.eye=h.eye[l];f.camera.center=h.center[l];f.camera.up=h.up[l];f.Update();l<k-1&&requestAnimationFrame(function(){c(f,h,k,l+1)})}var d=this;if(null!==a)if(0===b)this.SetCamera(a);else if(!(OV.CoordIsEqual3D(this.camera.eye,a.eye)&&OV.CoordIsEqual3D(this.camera.center,a.center)&&OV.CoordIsEqual3D(this.camera.up,a.up))){var e=OV.ParabolicTweenFunction,g={eye:OV.TweenCoord3D(this.camera.eye,a.eye,b,e),center:OV.TweenCoord3D(this.camera.center,
a.center,b,e),up:OV.TweenCoord3D(this.camera.up,a.up,b,e)};requestAnimationFrame(function(){c(d,g,b,0)});this.Update()}};OV.Navigation.prototype.FitToSphere=function(a,b,c){OV.IsZero(b)||(this.camera=this.GetFitToSphereCamera(a,b,c),this.orbitCenter=this.camera.center.Clone(),this.Update())};
OV.Navigation.prototype.GetFitToSphereCamera=function(a,b,c){if(OV.IsZero(b))return null;var d=this.camera.Clone(),e=OV.SubCoord3D(d.center,a);d.eye=OV.SubCoord3D(d.eye,e);d.center=a.Clone();a=OV.SubCoord3D(d.eye,d.center).Normalize();c/=2;this.canvas.width<this.canvas.height&&(c=c*this.canvas.width/this.canvas.height);b/=Math.sin(c*OV.DegRad);d.eye=d.center.Clone().Offset(a,b);this.orbitCenter=d.center.Clone();return d};
OV.Navigation.prototype.OnMouseDown=function(a){a.preventDefault();this.mouse.Down(this.canvas,a);this.clickDetector.Down(a)};OV.Navigation.prototype.OnMouseMove=function(a){a.preventDefault();this.mouse.Move(this.canvas,a);this.clickDetector.Move();if(this.mouse.IsButtonDown()){a=this.mouse.GetMoveDiff();var b=this.mouse.GetButton();if(1===b)this.Orbit(.5*a.x,.5*a.y);else if(2===b||3===b)b=.001*OV.CoordDistance3D(this.camera.eye,this.camera.center),this.Pan(a.x*b,a.y*b);this.Update()}};
OV.Navigation.prototype.OnMouseUp=function(a){a.preventDefault();this.mouse.Up(this.canvas,a);this.clickDetector.Up(a);this.clickDetector.IsClick()&&this.Click(a.which,a.ctrlKey||a.metaKey,a.clientX,a.clientY)};OV.Navigation.prototype.OnMouseLeave=function(a){a.preventDefault();this.mouse.Leave(this.canvas,a);this.clickDetector.Leave()};OV.Navigation.prototype.OnTouchStart=function(a){a.preventDefault();this.touch.Start(this.canvas,a)};
OV.Navigation.prototype.OnTouchMove=function(a){a.preventDefault();this.touch.Move(this.canvas,a);if(this.touch.IsFingerDown()){a=this.touch.GetMoveDiff();var b=this.touch.GetDistanceDiff(),c=this.touch.GetFingerCount();1===c?this.Orbit(.5*a.x,.5*a.y):2===c&&(this.Zoom(.005*b),b=.001*OV.CoordDistance3D(this.camera.eye,this.camera.center),this.Pan(a.x*b,a.y*b));this.Update()}};OV.Navigation.prototype.OnTouchEnd=function(a){a.preventDefault();this.touch.End(this.canvas,a)};
OV.Navigation.prototype.OnMouseWheel=function(a){a.preventDefault();var b=.1;0>-(a||window.event).deltaY/40&&(b*=-1);this.Zoom(b);this.Update()};OV.Navigation.prototype.OnContextMenu=function(a){a.preventDefault();this.clickDetector.Up(a);this.clickDetector.IsClick()&&this.Context(a.clientX,a.clientY)};
OV.Navigation.prototype.Orbit=function(a,b){a*=OV.DegRad;b*=OV.DegRad;var c=OV.SubCoord3D(this.camera.center,this.camera.eye).Normalize(),d=OV.CrossVector3D(c,this.camera.up).Normalize(),e=!OV.CoordIsEqual3D(this.orbitCenter,this.camera.center);this.fixUpVector?(c=OV.VectorAngle3D(c,this.camera.up)+b,OV.IsGreater(c,0)&&OV.IsLower(c,Math.PI)&&(this.camera.eye.Rotate(d,-b,this.orbitCenter),e&&this.camera.center.Rotate(d,-b,this.orbitCenter)),this.camera.eye.Rotate(this.camera.up,-a,this.orbitCenter),
e&&this.camera.center.Rotate(this.camera.up,-a,this.orbitCenter)):(c=OV.CrossVector3D(d,c).Normalize(),this.camera.eye.Rotate(d,-b,this.orbitCenter),this.camera.eye.Rotate(c,-a,this.orbitCenter),e&&(this.camera.center.Rotate(d,-b,this.orbitCenter),this.camera.center.Rotate(c,-a,this.orbitCenter)),this.camera.up=c)};
OV.Navigation.prototype.Pan=function(a,b){var c=OV.SubCoord3D(this.camera.center,this.camera.eye).Normalize(),d=OV.CrossVector3D(c,this.camera.up).Normalize();c=OV.CrossVector3D(d,c).Normalize();this.camera.eye.Offset(d,-a);this.camera.center.Offset(d,-a);this.camera.eye.Offset(c,b);this.camera.center.Offset(c,b)};OV.Navigation.prototype.Zoom=function(a){var b=OV.SubCoord3D(this.camera.center,this.camera.eye),c=b.Length();this.camera.eye.Offset(b,c*a)};OV.Navigation.prototype.Update=function(){if(this.onUpdate)this.onUpdate()};
OV.Navigation.prototype.Click=function(a,b,c,d){this.onClick&&(c=OV.GetClientCoordinates(this.canvas,c,d),this.onClick(a,b,c))};OV.Navigation.prototype.Context=function(a,b){if(this.onContext){var c={x:a,y:b};a=OV.GetClientCoordinates(this.canvas,a,b);this.onContext(c,a)}};OV.GetDefaultCamera=function(a){return a===OV.Direction.X?new OV.Camera(new OV.Coord3D(2,-3,1.5),new OV.Coord3D(0,0,0),new OV.Coord3D(1,0,0)):a===OV.Direction.Y?new OV.Camera(new OV.Coord3D(-1.5,2,3),new OV.Coord3D(0,0,0),new OV.Coord3D(0,1,0)):a===OV.Direction.Z?new OV.Camera(new OV.Coord3D(-1.5,-3,2),new OV.Coord3D(0,0,0),new OV.Coord3D(0,0,1)):null};OV.UpVector=function(){this.direction=OV.Direction.Z;this.isFixed=!0;this.isFlipped=!1};
OV.UpVector.prototype.SetDirection=function(a,b){this.direction=a;this.isFlipped=!1;a=OV.GetDefaultCamera(this.direction);a=OV.SubCoord3D(a.eye,a.center);var c=OV.CoordDistance3D(b.center,b.eye);a=b.center.Clone().Offset(a,c);b=b.Clone();this.direction===OV.Direction.X&&(b.up=new OV.Coord3D(1,0,0),b.eye=a);this.direction===OV.Direction.Y?(b.up=new OV.Coord3D(0,1,0),b.eye=a):this.direction===OV.Direction.Z&&(b.up=new OV.Coord3D(0,0,1),b.eye=a);return b};
OV.UpVector.prototype.SetFixed=function(a,b){return(this.isFixed=a)?this.SetDirection(this.direction,b):null};OV.UpVector.prototype.Flip=function(a){this.isFlipped=!this.isFlipped;a=a.Clone();a.up.MultiplyScalar(-1);return a};OV.ViewerGeometry=function(a){this.scene=a;this.modelMeshes=[]};OV.ViewerGeometry.prototype.AddModelMeshes=function(a){for(var b=0;b<a.length;b++){var c=a[b];this.modelMeshes.push(c);this.scene.add(c)}};OV.ViewerGeometry.prototype.GetModelMeshes=function(){return this.modelMeshes};
OV.ViewerGeometry.prototype.ClearModelMeshes=function(){for(var a=0;a<this.modelMeshes.length;a++){var b=this.modelMeshes[a];b.geometry.dispose();this.scene.remove(b)}this.modelMeshes=[]};OV.ViewerGeometry.prototype.EnumerateModelMeshes=function(a){for(var b=0;b<this.modelMeshes.length;b++)a(this.modelMeshes[b])};
OV.ViewerGeometry.prototype.GetModelMeshUnderMouse=function(a,b,c,d){var e=new THREE.Raycaster,g=new THREE.Vector2;g.x=a.x/c*2-1;g.y=2*-(a.y/d)+1;e.setFromCamera(g,b);a=e.intersectObjects(this.modelMeshes);for(b=0;b<a.length;b++)if(c=a[b],"Mesh"===c.object.type&&c.object.visible)return c.object;return null};OV.Viewer=function(){this.upVector=this.navigation=this.light=this.camera=this.geometry=this.scene=this.renderer=this.canvas=null;this.settings={animationSteps:40}};
OV.Viewer.prototype.Init=function(a){this.canvas=a;this.canvas.id="viewer";this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,antialias:!0});window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.setClearColor("#ffffff",1);this.renderer.setSize(this.canvas.width,this.canvas.height);this.scene=new THREE.Scene;this.geometry=new OV.ViewerGeometry(this.scene);this.InitCamera();this.InitLights();this.Render()};OV.Viewer.prototype.SetClickHandler=function(a){this.navigation.SetClickHandler(a)};
OV.Viewer.prototype.SetContextMenuHandler=function(a){this.navigation.SetContextMenuHandler(a)};OV.Viewer.prototype.SetBackgroundColor=function(a){a="#"+OV.ColorToHexString(a);this.renderer.setClearColor(a,1);this.Render()};OV.Viewer.prototype.SetEnvironmentMap=function(a){var b=this,c=new THREE.CubeTextureLoader;this.scene.environment=c.load(a,function(){b.Render()})};OV.Viewer.prototype.GetCamera=function(){return this.navigation.GetCamera()};
OV.Viewer.prototype.SetCamera=function(a){this.navigation.SetCamera(a);this.Render()};OV.Viewer.prototype.Resize=function(a,b){a=OV.GetInnerDimensions(this.canvas,a,b);this.ResizeRenderer(a.width,a.height)};OV.Viewer.prototype.ResizeRenderer=function(a,b){window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio);this.camera.aspect=a/b;this.camera.updateProjectionMatrix();this.renderer.setSize(a,b);this.Render()};
OV.Viewer.prototype.FitSphereToWindow=function(a,b){if(null!==a){var c=new OV.Coord3D(a.center.x,a.center.y,a.center.z);a=a.radius;var d=this.camera.fov;b?(b=this.navigation.GetFitToSphereCamera(c,a,d),this.navigation.MoveCamera(b,this.settings.animationSteps)):this.navigation.FitToSphere(c,a,d)}};
OV.Viewer.prototype.AdjustClippingPlanesToSphere=function(a){null!==a&&(10>a.radius?(this.camera.near=.01,this.camera.far=100):100>a.radius?(this.camera.near=.1,this.camera.far=1E3):1E3>a.radius?(this.camera.near=10,this.camera.far=1E4):(this.camera.near=100,this.camera.far=1E6),this.camera.updateProjectionMatrix(),this.Render())};OV.Viewer.prototype.IsFixUpVector=function(){return this.navigation.IsFixUpVector()};
OV.Viewer.prototype.SetFixUpVector=function(a){var b=this.navigation.GetCamera();b=this.upVector.SetFixed(a,b);this.navigation.SetFixUpVector(a);null!==b&&this.navigation.MoveCamera(b,this.settings.animationSteps);this.Render()};OV.Viewer.prototype.SetUpVector=function(a,b){var c=this.navigation.GetCamera();a=this.upVector.SetDirection(a,c);this.navigation.MoveCamera(a,b?this.settings.animationSteps:0);this.Render()};
OV.Viewer.prototype.FlipUpVector=function(){var a=this.navigation.GetCamera();a=this.upVector.Flip(a);this.navigation.MoveCamera(a,0);this.Render()};OV.Viewer.prototype.Render=function(){var a=this.navigation.GetCamera();this.camera.position.set(a.eye.x,a.eye.y,a.eye.z);this.camera.up.set(a.up.x,a.up.y,a.up.z);this.camera.lookAt(new THREE.Vector3(a.center.x,a.center.y,a.center.z));a=OV.SubCoord3D(a.eye,a.center);this.light.position.set(a.x,a.y,a.z);this.renderer.render(this.scene,this.camera)};
OV.Viewer.prototype.AddMeshes=function(a){this.geometry.AddModelMeshes(a);this.Render()};OV.Viewer.prototype.Clear=function(){this.geometry.ClearModelMeshes();this.Render()};OV.Viewer.prototype.SetMeshesVisibility=function(a){this.geometry.EnumerateModelMeshes(function(b){var c=a(b.userData);b.visible!==c&&(b.visible=c)});this.Render()};
OV.Viewer.prototype.SetMeshesHighlight=function(a,b){this.geometry.EnumerateModelMeshes(function(c){if(b(c.userData)){if(null===c.userData.threeMaterials){for(var d=c.userData.threeMaterials=c.material,e=[],g=0;g<d.length;g++)e.push(a);c.material=e}}else null!==c.userData.threeMaterials&&(c.material=c.userData.threeMaterials,c.userData.threeMaterials=null)});this.Render()};
OV.Viewer.prototype.GetMeshUserDataUnderMouse=function(a){var b=this.canvas.width,c=this.canvas.height;window.devicePixelRatio&&(b/=window.devicePixelRatio,c/=window.devicePixelRatio);a=this.geometry.GetModelMeshUnderMouse(a,this.camera,b,c);return null===a?null:a.userData};OV.Viewer.prototype.GetBoundingBox=function(a){var b=!1,c=new THREE.Box3;this.geometry.EnumerateModelMeshes(function(d){a(d.userData)&&(c.union((new THREE.Box3).setFromObject(d)),b=!0)});return b?c:null};
OV.Viewer.prototype.GetBoundingSphere=function(a){a=this.GetBoundingBox(a);if(null===a)return null;var b=new THREE.Sphere;a.getBoundingSphere(b);return b};OV.Viewer.prototype.EnumerateMeshesUserData=function(a){this.geometry.EnumerateModelMeshes(function(b){a(b.userData)})};
OV.Viewer.prototype.InitCamera=function(){var a=this;this.camera=new THREE.PerspectiveCamera(45,this.canvas.width/this.canvas.height,.1,1E3);this.scene.add(this.camera);var b=this.renderer.domElement,c=OV.GetDefaultCamera(OV.Direction.Z);this.navigation=new OV.Navigation(b,c);this.navigation.SetUpdateHandler(function(){a.Render()});this.upVector=new OV.UpVector};
OV.Viewer.prototype.InitLights=function(){var a=new THREE.AmbientLight(8947848);this.scene.add(a);this.light=new THREE.DirectionalLight(8947848);this.scene.add(this.light)};OV.Viewer.prototype.GetImageSize=function(){var a=new THREE.Vector2;this.renderer.getSize(a);return{width:parseInt(a.x,10),height:parseInt(a.y,10)}};
OV.Viewer.prototype.GetImageAsDataUrl=function(a,b){var c=this.GetImageSize();window.devicePixelRatio&&(a/=window.devicePixelRatio,b/=window.devicePixelRatio);this.ResizeRenderer(a,b);this.Render();b=this.renderer.domElement.toDataURL();this.ResizeRenderer(c.width,c.height);return b};OV.Init3DViewerElement=function(a,b,c){c||(c={});var d=document.createElement("canvas");a.appendChild(d);var e=new OV.Viewer;e.Init(d);e.Resize(a.clientWidth,a.clientHeight);var g=new OV.ThreeModelLoader,f=null;g.Init({onLoadStart:function(){d.style.display="none";f=document.createElement("div");a.appendChild(f);f.innerHTML="Loading model..."},onImportStart:function(){f.innerHTML="Importing model..."},onVisualizationStart:function(){f.innerHTML="Visualizing model..."},onModelFinished:function(k,l){a.removeChild(f);
d.style.display="inherit";e.AddMeshes(l);l=e.GetBoundingSphere(function(m){return!0});e.AdjustClippingPlanesToSphere(l);c.camera?e.SetCamera(c.camera):e.SetUpVector(k.upVector,!1);e.FitSphereToWindow(l,!1)},onTextureLoaded:function(){e.Render()},onLoadError:function(k){var l="Unknown error";k.code===OV.ImportErrorCode.NoImportableFile?l="No importable file found":k.code===OV.ImportErrorCode.ImportFailed&&(l="Failed to import model.");null!==k.message&&(l+=" ("+k.message+")");f.innerHTML=l}});if(null===
b||0===b.length)return null;c.backgroundColor&&e.SetBackgroundColor(c.backgroundColor);c.environmentMap&&e.SetEnvironmentMap(c.environmentMap);var h=new OV.ImportSettings;c.defaultColor&&(h.defaultColor=c.defaultColor);g.LoadFromUrlList(b,h);return{element:a,viewer:e}};
OV.Init3DViewerElements=function(a){function b(f){var h=null,k=f.getAttribute("camera");k&&(h=OV.ParameterConverter.StringToCamera(k));k=null;var l=f.getAttribute("backgroundcolor");l&&(k=OV.ParameterConverter.StringToColor(l));l=null;var m=f.getAttribute("defaultcolor");m&&(l=OV.ParameterConverter.StringToColor(m));m=null;var n=f.getAttribute("environmentmap");n&&(n=n.split(","),6===n.length&&(m=n));n=null;var q=f.getAttribute("model");q&&(n=OV.ParameterConverter.StringToModelUrls(q));return OV.Init3DViewerElement(f,
n,{camera:h,backgroundColor:k,defaultColor:l,environmentMap:m})}for(var c=[],d=document.getElementsByClassName("online_3d_viewer"),e=0;e<d.length;e++){var g=b(d[e]);c.push(g)}void 0!==a&&null!==a&&a(c);window.addEventListener("resize",function(){for(var f=0;f<c.length;f++){var h=c[f];h.viewer.Resize(h.element.clientWidth,h.element.clientHeight)}})};
